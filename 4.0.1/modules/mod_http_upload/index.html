<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../favicon.ico">
  
  <title>mod_http_upload - MongooseIM</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  <link href="../../custom.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "mod_http_upload";
    var mkdocs_page_input_path = "modules/mod_http_upload.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> MongooseIM</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">User guide</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../user-guide/Get-to-know-MongooseIM/">ABCs of MongooseIM</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../user-guide/MongooseIM-High-level-Architecture/">High-level Architecture</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../user-guide/Features-and-supported-standards/">Features and supported standards</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../user-guide/Getting-started/">Getting started</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../user-guide/release_config/">Release/Installation configuration</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../user-guide/Bootstrap-Scripts/">Bootstrap scripts</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../user-guide/client-certificate/">Client certificate authentication</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Tutorials</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../user-guide/How-to-build/">How to Build MongooseIM from source code</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../user-guide/push-notifications/Push-notifications/">How to Set up Push Notifications</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../user-guide/push-notifications/Push-notifications-client-side/">How to Set up Push Notifications on the client side</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../user-guide/push-notifications/With-MongoosePush/">How to Set up MongoosePush</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../user-guide/ICE_tutorial/">How to Set up MongooseICE</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../user-guide/iOS_tutorial/">How to Build an iOS messaging app</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../user-guide/Jingle-SIP-setup/">How to Set up Jingle/SIP</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Migration Guide</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../migrations/3.1.1_3.2.0/">3.1.1 to 3.2.0</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../migrations/3.3.0_3.4.0/">3.3.0 to 3.4.0</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../migrations/3.5.0_3.6.0/">3.5.0 to 3.6.0</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../migrations/3.6.0_3.7.0/">3.6.0 to 3.7.0</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../migrations/3.7.0_4.0.0/">3.7.0 to 4.0.0</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../migrations/4.0.0_4.0.1/">4.0.0 to 4.0.1</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../migrations/jid-from-mam-muc-script/">MAM MUC migration helper</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Platform</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Contributions/">Contributions to ecosystem</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../Differentiators/">Differentiators</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../History/">History</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Configuration</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Advanced-configuration/">Configuration files</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/general/">Options: General</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/listen/">Options: Listen</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/auth/">Options: Auth</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/outgoing-connections/">Options: Outgoing connections</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/Services/">Options: Services</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/Modules/">Options: Extension Modules</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/shaper/">Options: Shaper</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/acl/">Options: Acl</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/access/">Options: Access</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/s2s/">Options: S2S</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/host_config/">Options: Host config</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/release-options/">Release options</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../Erlang-cookie-security/">Erlang Cookie Security</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/TLS-hardening/">TLS hardening</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/database-backends-configuration/">Database backends configuration</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Authentication methods</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../authentication-methods/rdbms/">RDBMS</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../authentication-methods/external/">External</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../authentication-methods/anonymous/">Anonymous</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../authentication-methods/ldap/">LDAP</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../authentication-methods/jwt/">JWT</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../authentication-methods/riak/">Riak</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../authentication-methods/http/">HTTP</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../authentication-methods/pki/">PKI</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../authentication-methods/dummy/">Dummy</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">MongooseIM open XMPP extensions</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../open-extensions/muc_light/">MUC light</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../open-extensions/token-reconnection/">Token-based reconnection</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">REST API</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../rest-api/Client-frontend/">Client/frontend</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../rest-api/Metrics-backend/">Metrics backend</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../rest-api/Administration-backend/">Administration backend</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Operation and maintenance</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/gdpr-considerations/">GDPR considerations</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/Cluster-management-considerations/">Cluster management considerations</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/Cluster-configuration-and-node-management/">Cluster configuration and node management</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/Logging-%26-monitoring/">Logging & monitoring</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/Logging/">Logging configuration</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/Logging-fields/">Logging fields</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/Reloading-configuration-on-a-running-system/">Reloading configuration on a running system</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/Mongoose-metrics/">Metrics</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/System-Metrics-Privacy-Policy/">System Metrics Privacy Policy</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/tls-distribution/">Distribution over TLS</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/known-issues/">Known issues</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Developer's guide</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/Testing-MongooseIM/">Testing MongooseIM</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/logging/">Logging</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/Hooks-and-handlers/">Hooks and Handlers</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/hooks_description/">Hooks description</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/message_routing/">Stanza routing</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/accumulators/">Accumulators</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/flat_options/">Flat options format</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/Moving-to-single-app-project-structure/">Moving to single app project structure</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/mod_amp_developers_guide/">mod_amp development</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/mod_muc_light_developers_guide/">mod_muc_light developers doc</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/SCRAM-serialization/">SCRAM serialization format</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/xep_tool/">xep-tool usage</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/OpenSSL-and-FIPS/">FIPS mode</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/Basic-iq-handler/">Basic IQ Handler</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/mongoose_wpool/">mongoose_wpool</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Module index</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../mod_adhoc/">mod_adhoc</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_amp/">mod_amp</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_auth_token/">mod_auth_token</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_blocking/">mod_blocking</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_bosh/">mod_bosh</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_caps/">mod_caps</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_carboncopy/">mod_carboncopy</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_commands/">mod_commands</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_csi/">mod_csi</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_inbox/">mod_inbox</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_disco/">mod_disco</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_global_distrib/">mod_global_distrib</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">mod_event_pusher</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../mod_event_pusher/">mod_event_pusher</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../mod_event_pusher_http/">HTTP backend</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../mod_event_pusher_push/">Push backend</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../mod_event_pusher_sns/">SNS backend</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../mod_event_pusher_rabbit/">RabbitMQ backend</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_extdisco/">mod_extdisco</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">mod_http_upload</a>
    <ul class="current">
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_jingle_sip/">mod_jingle_sip</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_keystore/">mod_keystore</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_last/">mod_last</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_mam/">mod_mam</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_muc/">mod_muc</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_muc_commands/">mod_muc_commands</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_muc_log/">mod_muc_log</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_muc_light/">mod_muc_light</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_muc_light_commands/">mod_muc_light_commands</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_offline/">mod_offline</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_offline_stub/">mod_offline_stub</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_ping/">mod_ping</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_privacy/">mod_privacy</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_private/">mod_private</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_pubsub/">mod_pubsub</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_push_service_mongoosepush/">mod_push_service_mongoosepush</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_register/">mod_register</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_roster/">mod_roster</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_shared_roster_ldap/">mod_shared_roster_ldap</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_sic/">mod_sic</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_stream_management/">mod_stream_management</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_time/">mod_time</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_vcard/">mod_vcard</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_version/">mod_version</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">MongooseIM</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Module index &raquo;</li>
        
      
    
    <li>mod_http_upload</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h3 id="module-description">Module Description</h3>
<p>This module implements <a href="https://xmpp.org/extensions/xep-0363.html">XEP-0363: HTTP File Upload</a>. 
It enables a service that on user request creates an upload "slot". 
A slot is a pair of URLs, one of which can be used with a <code>PUT</code> method to upload a user's file, the other with a <code>GET</code> method to retrieve such file.</p>
<p>Currently, the module supports only the <a href="https://aws.amazon.com/s3/">S3</a> backend using <a href="https://docs.aws.amazon.com/AmazonS3/latest/API/sigv4-query-string-auth.html">AWS Signature Version 4</a>.</p>
<h3 id="options">Options</h3>
<h4 id="modulesmod_http_uploadiqdisctype"><code>modules.mod_http_upload.iqdisc.type</code></h4>
<ul>
<li><strong>Syntax:</strong> string, one of <code>"one_queue"</code>, <code>"no_queue"</code>, <code>"queues"</code>, <code>"parallel"</code></li>
<li><strong>Default:</strong> <code>"one_queue"</code></li>
</ul>
<p>Strategy to handle incoming stanzas. For details, please refer to
<a href="../../advanced-configuration/Modules/#iq-processing-policies">IQ processing policies</a>.</p>
<h4 id="modulesmod_http_uploadhost"><code>modules.mod_http_upload.host</code></h4>
<ul>
<li><strong>Syntax:</strong> string</li>
<li><strong>Default:</strong> <code>"upload.@HOST@"</code></li>
<li><strong>Example:</strong> <code>host = "upload.@HOST@"</code></li>
</ul>
<p>Subdomain for the upload service to reside under. <code>@HOST@</code> is replaced with each served domain.</p>
<h4 id="modulesmod_http_uploadbackend"><code>modules.mod_http_upload.backend</code></h4>
<ul>
<li><strong>Syntax:</strong> non-empty string</li>
<li><strong>Default:</strong> <code>"s3"</code></li>
<li><strong>Example:</strong> <code>backend = "s3"</code></li>
</ul>
<p>Backend to use for generating slots. Currently only <code>"s3"</code> can be used.</p>
<h4 id="modulesmod_http_uploadexpiration_time"><code>modules.mod_http_upload.expiration_time</code></h4>
<ul>
<li><strong>Syntax:</strong> non-negative integer</li>
<li><strong>Default:</strong> <code>60</code></li>
<li><strong>Example:</strong> <code>expiration_time = 120</code></li>
</ul>
<p>Duration (in seconds) after which the generated <code>PUT</code> URL will become invalid.</p>
<h4 id="modulesmod_http_uploadtoken_bytes"><code>modules.mod_http_upload.token_bytes</code></h4>
<ul>
<li><strong>Syntax:</strong> positive integer</li>
<li><strong>Default:</strong> <code>32</code></li>
<li><strong>Example:</strong> <code>token_bytes = 32</code></li>
</ul>
<p>Number of random bytes of a token that will be used in a generated URL. 
The text representation of the token will be twice as long as the number of bytes, e.g. for the default value the token in the URL will be 64 characters long.</p>
<h4 id="modulesmod_http_uploadmax_file_size"><code>modules.mod_http_upload.max_file_size</code></h4>
<ul>
<li><strong>Syntax:</strong> non-negative integer</li>
<li><strong>Default:</strong> not set - no size limit</li>
<li><strong>Example:</strong> <code>max_file_size = 10485760</code></li>
</ul>
<p>Maximum file size (in bytes) accepted by the module. Disabled if set to <code>"undefined"</code>.</p>
<h4 id="modulesmod_http_uploads3"><code>modules.mod_http_upload.s3</code></h4>
<ul>
<li><strong>Syntax:</strong> Array of TOML tables. See description.</li>
<li><strong>Default:</strong> see description</li>
<li><strong>Example:</strong> see description</li>
</ul>
<p>Options specific to <a href="https://aws.amazon.com/s3/">S3</a> backend.</p>
<h4 id="s3-backend-options"><a href="https://aws.amazon.com/s3/">S3</a> backend options</h4>
<h5 id="s3bucket_url"><code>s3.bucket_url</code></h5>
<ul>
<li><strong>Syntax:</strong> non-empty string</li>
<li><strong>Default:</strong> none, this option is mandatory</li>
<li><strong>Example:</strong> <code>s3.bucket_url = "https://s3-eu-west-1.amazonaws.com/mybucket"</code></li>
</ul>
<p>A complete URL pointing at the used bucket. The URL may be in <a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/VirtualHosting.html">virtual host form</a>, and for AWS it needs to point to a specific regional endpoint for the bucket. The scheme, port and path specified in the URL will be used to create <code>PUT</code> URLs for slots, e.g. specifying a value of <code>"https://s3-eu-west-1.amazonaws.com/mybucket/custom/prefix"</code> will result in <code>PUT</code> URLs of form <code>"https://s3-eu-west-1.amazonaws.com/mybucket/custom/prefix/&lt;RANDOM_TOKEN&gt;/&lt;FILENAME&gt;?&lt;AUTHENTICATION_PARAMETERS&gt;"</code>.</p>
<h5 id="s3add_acl"><code>s3.add_acl</code></h5>
<ul>
<li><strong>Syntax:</strong> boolean</li>
<li><strong>Default:</strong> <code>false</code></li>
<li><strong>Example:</strong> <code>s3.add_acl = true</code></li>
</ul>
<p>If <code>true</code>, adds <code>x-amz-acl: public-read</code> header to the PUT URL.
This allows users to read the uploaded files even if the bucket is private. The same header must be added to the PUT request.</p>
<h5 id="s3region"><code>s3.region</code></h5>
<ul>
<li><strong>Syntax:</strong> string</li>
<li><strong>Default:</strong> <code>""</code></li>
<li><strong>Example:</strong> <code>s3.region = "https://s3-eu-west-1.amazonaws.com/mybucket"</code></li>
</ul>
<p>The <a href="https://docs.aws.amazon.com/general/latest/gr/rande.html?shortFooter=true#s3_region">AWS region</a> to use for requests.</p>
<h5 id="s3access_key_id"><code>s3.access_key_id</code></h5>
<ul>
<li><strong>Syntax:</strong> string</li>
<li><strong>Default:</strong> <code>""</code></li>
<li><strong>Example:</strong> <code>s3.access_key_id = "AKIAIOSFODNN7EXAMPLE"</code></li>
</ul>
<p><a href="https://docs.aws.amazon.com/general/latest/gr/aws-sec-cred-types.html?shortFooter=true#access-keys-and-secret-access-keys">ID of the access key</a> to use for authorization.</p>
<h5 id="s3secret_access_key"><code>s3.secret_access_key</code></h5>
<ul>
<li><strong>Syntax:</strong> string</li>
<li><strong>Default:</strong> <code>""</code></li>
<li><strong>Example:</strong> <code>s3.secret_access_key = "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"</code></li>
</ul>
<p><a href="https://docs.aws.amazon.com/general/latest/gr/aws-sec-cred-types.html?shortFooter=true#access-keys-and-secret-access-keys">Secret access key</a> to use for authorization.</p>
<h3 id="example-configuration">Example configuration</h3>
<pre><code class="language-toml">[modules.mod_http_upload]
  host = &quot;upload.@HOST@&quot;
  backend = &quot;s3&quot;
  expiration_time = 120
  s3.bucket_url = &quot;https://s3-eu-west-1.amazonaws.com/mybucket&quot;
  s3.region = &quot;eu-west-1&quot;
  s3.add_acl = true     
  s3.access_key_id = &quot;AKIAIOSFODNN7EXAMPLE&quot;
  s3.secret_access_key = &quot;wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY&quot;
</code></pre>
<h3 id="testing-s3-configuration">Testing <a href="https://aws.amazon.com/s3/">S3</a> configuration</h3>
<p>Since there is no direct connection between MongooseIM and an <a href="https://aws.amazon.com/s3/">S3</a> bucket,
it is not possible to verify the provided <a href="https://aws.amazon.com/s3/">S3</a> credentials during startup.
However, the testing can be done manually. MongooseIM provides a dedicated
<code>mongooseimctl http_upload</code> command for the manual URLs generation, it accepts
the following parameters:</p>
<ul>
<li><strong>Host</strong> - XMPP host name.</li>
<li><strong>FileName</strong> - The name of the file.</li>
<li><strong>FileSize</strong> - The size of the file (positive integer).</li>
<li><strong>ContentType</strong> - <a href="https://www.rfc-editor.org/rfc/rfc7231.html#section-3.1.1.5">Content-Type</a>, optional parameter. If not provided, must be an empty string <code>""</code>.</li>
<li><strong>ExpirationTime</strong> - Duration (in seconds, positive integer) after which the generated <code>PUT</code> URL will become invalid. This parameter shadows the <strong>expiration_time</strong> configuration.</li>
</ul>
<p>The generated URLs can be used to upload/download a file using the <code>curl</code> utility:</p>
<pre><code class="language-bash"># Create some text file
echo qwerty &gt; tmp.txt

# Get the size of the file
filesize=&quot;$(wc -c tmp.txt | awk '{print $1}')&quot;

# Set the content type
content_type=&quot;text/plain&quot;

# Generate upload/download URLs
urls=&quot;$(./mongooseimctl http_upload localhost test.txt &quot;$filesize&quot; &quot;$content_type&quot; 600)&quot;
put_url=&quot;$(echo &quot;$urls&quot; | awk '/PutURL:/ {print $2}')&quot;
get_url=&quot;$(echo &quot;$urls&quot; | awk '/GetURL:/ {print $2}')&quot;

# Try to upload a file. Note that if 'add_acl' option is
# enabled, then you must also add 'x-amz-acl' header:
#    -H &quot;x-amz-acl: public-read&quot;
curl -v -T &quot;./tmp.txt&quot; -H &quot;Content-Type: $content_type&quot; &quot;$put_url&quot;

# Try to download a file
curl -i &quot;$get_url&quot;
</code></pre>
<h3 id="using-s3-backend-with-minio">Using S3 backend with <a href="https://min.io">min.io</a></h3>
<p><a href="https://min.io">min.io</a> doesn't support <a href="https://docs.minio.io/docs/minio-server-limits-per-tenant.html">ObjectACL</a>, so enabling <code>add_acl</code>
makes no sense. The <a href="https://docs.min.io/docs/minio-client-complete-guide#policy">bucket policies</a> must be used instead,
it is enough to set the bucket policy to <code>download</code>.</p>
<p>Please note that there is no error if you keep <code>add_acl</code> enabled. <a href="https://min.io">min.io</a> just
ignores the <code>x-amz-acl</code> header. This might be useful to simplify the migration from <a href="https://aws.amazon.com/s3/">S3</a>
to <a href="https://min.io">min.io</a></p>
<h3 id="metrics">Metrics</h3>
<p>If you'd like to learn more about metrics in MongooseIM, please visit <a href="../../operation-and-maintenance/Mongoose-metrics/">MongooseIM metrics</a> page.</p>
<table>
<thead>
<tr>
<th>Backend action</th>
<th>Description (when it gets incremented)</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>create_slot</code></td>
<td>An upload slot is allocated.</td>
</tr>
</tbody>
</table>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../mod_jingle_sip/" class="btn btn-neutral float-right" title="mod_jingle_sip">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../mod_extdisco/" class="btn btn-neutral" title="mod_extdisco"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../mod_extdisco/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../mod_jingle_sip/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
