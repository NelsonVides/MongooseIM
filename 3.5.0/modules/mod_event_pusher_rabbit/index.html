<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../favicon.ico">
  
  <title>RabbitMQ backend - MongooseIM</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  <link href="../../custom.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "RabbitMQ backend";
    var mkdocs_page_input_path = "modules/mod_event_pusher_rabbit.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> MongooseIM</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">User guide</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../user-guide/Get-to-know-MongooseIM/">ABCs of MongooseIM</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../user-guide/MongooseIM-High-level-Architecture/">High-level Architecture</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../user-guide/Features-and-supported-standards/">Features and supported standards</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../user-guide/Getting-started/">Getting started</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../user-guide/release_config/">Release/Installation configuration</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Tutorials</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../user-guide/How-to-build/">How to Build MongooseIM from source code</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../user-guide/Push-notifications/">How to Set up MongoosePush</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../user-guide/ICE_tutorial/">How to Set up MongooseICE</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../user-guide/iOS_tutorial/">How to Build an iOS messaging app</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../user-guide/Jingle-SIP-setup/">How to Set up Jingle/SIP</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Migration Guide</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../migrations/3.1.1_3.2.0/">3.1.1 to 3.2.0</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../migrations/3.3.0_3.4.0/">3.3.0 to 3.4.0</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../migrations/jid-from-mam-muc-script/">MAM MUC migration helper</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Platform</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Contributions/">Contributions to ecosystem</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../Differentiators/">Differentiators</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../History/">History</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Configuration</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Basic-configuration/">Basic Configuration</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../Erlang-cookie-security/">Erlang Cookie Security</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../Advanced-configuration/">Advanced Configuration</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/TLS-hardening/">TLS hardening</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/database-backends-configuration/">Database backends configuration</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/outgoing-connections/">Outgoing connections</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/Modules/">Extension Modules</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/Listener-modules/">Listener Modules</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/acl/">ACL</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/Services/">Services</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Authentication methods</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../authentication-methods/client-certificate/">Client Certificate</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Authentication backends</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../authentication-backends/External-authentication-module/">External Authentication Module</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../authentication-backends/HTTP-authentication-module/">HTTP Authentication Module</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../authentication-backends/JWT-authentication-module/">JWT Authentication Module</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../authentication-backends/LDAP-authentication-module/">LDAP Authentication Module</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../authentication-backends/PKI-authentication-module/">PKI Authentication Module</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">MongooseIM open XMPP extensions</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../open-extensions/muc_light/">MUC light</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../open-extensions/token-reconnection/">Token-based reconnection</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">REST API</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../rest-api/Client-frontend/">Client/frontend</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../rest-api/Metrics-backend/">Metrics backend</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../rest-api/Administration-backend/">Administration backend</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Operation and maintenance</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/gdpr-considerations/">GDPR considerations</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/Cluster-management-considerations/">Cluster management considerations</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/Cluster-configuration-and-node-management/">Cluster configuration and node management</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/Logging-%26-monitoring/">Logging & monitoring</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/Reloading-configuration-on-a-running-system/">Reloading configuration on a running system</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/Mongoose-metrics/">Metrics</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/tls-distribution/">Distribution over TLS</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/known-issues/">Known issues</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Developer's guide</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/Testing-MongooseIM/">Testing MongooseIM</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/logging/">Logging</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/Hooks-and-handlers/">Hooks and Handlers</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/hooks_description/">Hooks description</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/message_routing/">Stanza routing</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/accumulators/">Accumulators</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/flat_options/">Flat options format</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/Moving-to-single-app-project-structure/">Moving to single app project structure</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/mod_amp_developers_guide/">mod_amp development</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/mod_muc_light_developers_guide/">mod_muc_light developers doc</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/SCRAM-serialization/">SCRAM serialization format</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/xep_tool/">xep-tool usage</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/OpenSSL-and-FIPS/">FIPS mode</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/Basic-iq-handler/">Basic IQ Handler</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/mongoose_wpool/">mongoose_wpool</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Module index</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../mod_adhoc/">mod_adhoc</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_amp/">mod_amp</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_auth_token/">mod_auth_token</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_blocking/">mod_blocking</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_bosh/">mod_bosh</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_caps/">mod_caps</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_carboncopy/">mod_carboncopy</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_commands/">mod_commands</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_csi/">mod_csi</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_inbox/">mod_inbox</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_disco/">mod_disco</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_global_distrib/">mod_global_distrib</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="#">mod_event_pusher</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../mod_event_pusher/">mod_event_pusher</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../mod_event_pusher_http/">HTTP backend</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../mod_event_pusher_push/">Push backend</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../mod_event_pusher_sns/">SNS backend</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="./">RabbitMQ backend</a>
    <ul class="current">
    </ul>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_http_upload/">mod_http_upload</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_jingle_sip/">mod_jingle_sip</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_keystore/">mod_keystore</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_last/">mod_last</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_mam/">mod_mam</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_muc/">mod_muc</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_muc_commands/">mod_muc_commands</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_muc_log/">mod_muc_log</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_muc_light/">mod_muc_light</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_muc_light_commands/">mod_muc_light_commands</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_offline/">mod_offline</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_offline_stub/">mod_offline_stub</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_ping/">mod_ping</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_privacy/">mod_privacy</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_private/">mod_private</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_pubsub/">mod_pubsub</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_push_service_mongoosepush/">mod_push_service_mongoosepush</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_register/">mod_register</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_revproxy/">mod_revproxy</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_roster/">mod_roster</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_shared_roster_ldap/">mod_shared_roster_ldap</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_sic/">mod_sic</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_stream_management/">mod_stream_management</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_time/">mod_time</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_vcard/">mod_vcard</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_version/">mod_version</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">MongooseIM</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>mod_event_pusher &raquo;</li>
        
      
        
          <li>Module index &raquo;</li>
        
      
    
    <li>RabbitMQ backend</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h3 id="current-status">Current status</h3>
<p><strong>This module is still in an experimental phase.</strong></p>
<h3 id="module-description">Module Description</h3>
<p>This module is a backend of <a href="../mod_event_pusher/">mod_event_pusher</a> that enables support for the
RabbitMQ integration. Currently there are 5 available notifications:</p>
<ul>
<li><strong>user presence changed</strong> - Carries the user id (full jid by default) and
a boolean field corresponding to the current user online status.</li>
<li><strong>private message sent/received</strong> - Carries the user ids (both sender and
receiver) along with the message body.</li>
<li><strong>group message sent/received</strong> - Carries the user id and the room id
(full jids by default) along with the message body.</li>
</ul>
<p>All these notifications are sent as JSON strings to RabbitMQ exchanges. Type
of exchanges can be chosen as desired. Each type of the notifications is sent
to its dedicated exchange. There are three exchanges created on startup of the
module, for presences, private messages and group chat messages related events.</p>
<p>Messages are published to a RabbitMQ server with routing key being set to a user
bare jid (<code>user@domain</code>) and configurable topic e.g <code>alice@localhost.private_message_sent</code>.</p>
<p>The module requires <code>rabbit</code> pool of AMQP connections to be configured in order
to make the module work. It's well advised to read through
<a href="../../advanced-configuration/outgoing-connections/"><em>Advanced configuration/Outgoing connections</em></a>
section before enabling the module.</p>
<h3 id="options">Options</h3>
<ul>
<li><strong>presence_exchange</strong> - Defines presence exchange options, such as:</li>
<li><code>name</code> - (string, default: <code>&lt;&lt;"presence"&gt;&gt;</code>) - Defines RabbitMQ presence exchange name;</li>
<li><code>type</code> (string, default: <code>&lt;&lt;"topic"&gt;&gt;</code>) - Defines RabbitMQ presence exchange type;</li>
<li><strong>chat_msg_exchange</strong> - Defines chat message exchange options, such as:</li>
<li><code>name</code> - (string, default: <code>&lt;&lt;"chat_msg"&gt;&gt;</code>) - Defines RabbitMQ chat message exchange name;</li>
<li><code>type</code> (string, default: <code>&lt;&lt;"topic"&gt;&gt;</code>) - Defines RabbitMQ chat message exchange type;</li>
<li><code>sent_topic</code> - (string, default: <code>&lt;&lt;"chat_msg_sent"&gt;&gt;</code>) - Defines RabbitMQ chat message sent topic name;</li>
<li><code>recv_topic</code> - (string, default: <code>&lt;&lt;"chat_msg_recv"&gt;&gt;</code>) - Defines RabbitMQ chat message received topic name;</li>
<li><strong>groupchat_msg_exchange</strong> - Defines group chat message exchange options, such as:</li>
<li><code>name</code> - (string, default: <code>&lt;&lt;"groupchat_msg"&gt;&gt;</code>) - Defines RabbitMQ group chat message exchange name;</li>
<li><code>type</code> (string, default: <code>&lt;&lt;"topic"&gt;&gt;</code>) - Defines RabbitMQ group chat message exchange type;</li>
<li><code>sent_topic</code> (string, default: <code>&lt;&lt;"groupchat_msg_sent"&gt;&gt;</code>) - Defines RabbitMQ group chat message sent topic name;</li>
<li><code>recv_topic</code> (string, default: <code>&lt;&lt;"groupchat_msg_recv"&gt;&gt;</code>) - Defines RabbitMQ group chat message received topic name;</li>
</ul>
<h3 id="example-configuration">Example configuration</h3>
<pre><code class="language-Erlang">{mod_event_pusher, [
    {backends, [
        {rabbit, [
            {presence_exchange, [{name, &lt;&lt;&quot;presence&quot;&gt;&gt;},
                                 {type, &lt;&lt;&quot;topic&quot;&gt;&gt;}]},
            {chat_msg_exchange, [{name, &lt;&lt;&quot;chat_msg&quot;&gt;&gt;},
                                 {sent_topic, &lt;&lt;&quot;chat_msg_sent&quot;&gt;&gt;},
                                 {recv_topic, &lt;&lt;&quot;chat_msg_recv&quot;&gt;&gt;}]},
            {groupchat_msg_exchange, [{name, &lt;&lt;&quot;groupchat_msg&quot;&gt;&gt;},
                                      {sent_topic, &lt;&lt;&quot;groupchat_msg_sent&quot;&gt;&gt;},
                                      {recv_topic, &lt;&lt;&quot;groupchat_msg_recv&quot;&gt;&gt;}]}
        ]}
    ]}
]}
</code></pre>
<h3 id="json-schema-examples">JSON Schema examples</h3>
<p>The different kinds of notifications deliver slightly different messages.
The messages are delivered in a JSON format.</p>
<h4 id="presence-updates">Presence updates</h4>
<p>The JSON format for an online presence update notification is:</p>
<pre><code class="language-JSON">{
    &quot;user_id&quot;: &quot;alice@localhost/res1&quot;,
    &quot;present&quot;: true
}
</code></pre>
<p>For offline presence updates, the <code>present</code> boolean value is set to false:</p>
<pre><code class="language-JSON">{
    &quot;user_id&quot;: &quot;alice@localhost/res1&quot;,
    &quot;present&quot;: false
}
</code></pre>
<h4 id="sentreceived-messages">Sent/received messages</h4>
<p>The JSON format for a private message notification is:</p>
<pre><code class="language-JSON">{
    &quot;to_user_id&quot;: &quot;bob@localhost/res1&quot;,
    &quot;message&quot;: &quot;Hello, Bob&quot;,
    &quot;from_user_id&quot;: &quot;alice@localhost/res1&quot;
}
</code></pre>
<p>The notification is similar for group messages. For example for "sent" events:</p>
<pre><code class="language-JSON">{
    &quot;to_user_id&quot;: &quot;muc_publish@muc.localhost&quot;,
    &quot;message&quot;: &quot;Hi, Everyone!&quot;,
    &quot;from_user_id&quot;: &quot;bob@localhost/res1&quot;
}
</code></pre>
<p>and for "received" events:</p>
<pre><code class="language-JSON">{
    &quot;to_user_id&quot;: &quot;bob@localhost/res1&quot;,
    &quot;message&quot;: &quot;Hi, Everyone!&quot;,
    &quot;from_user_id&quot;: &quot;muc_publish@muc.localhost/alice&quot;
}
</code></pre>
<h3 id="metrics">Metrics</h3>
<p>The module provides some metrics related to RabbitMQ connections and messages
as well. Provided metrics:</p>
<table>
<thead>
<tr>
<th>name</th>
<th>type</th>
<th>description (when it gets incremented/decremented)</th>
</tr>
</thead>
<tbody>
<tr>
<td>[<code>Host</code>, <code>connections_active</code>]</td>
<td>spiral</td>
<td>A connection to a RabbitMQ server is opened(+1)/closed(-1).</td>
</tr>
<tr>
<td>[<code>Host</code>, <code>connections_opened</code>]</td>
<td>spiral</td>
<td>A connection to a RabbitMQ server is opened.</td>
</tr>
<tr>
<td>[<code>Host</code>, <code>connections_closed</code>]</td>
<td>spiral</td>
<td>A connection to a RabbitMQ server is closed.</td>
</tr>
<tr>
<td>[<code>Host</code>, <code>connection_failed</code> ]</td>
<td>spiral</td>
<td>A try to open a connection to a RabbitMQ server failed.</td>
</tr>
<tr>
<td>[<code>Host</code>, <code>messages_published</code>]</td>
<td>spiral</td>
<td>A message to a RabbitMQ server is published.</td>
</tr>
<tr>
<td>[<code>Host</code>, <code>messages_failed</code>]</td>
<td>spiral</td>
<td>A message to a RabbitMQ server is rejected.</td>
</tr>
<tr>
<td>[<code>Host</code>, <code>messages_timeout</code>]</td>
<td>spiral</td>
<td>A message to a RabbitMQ server timed out (weren't confirmed by the server).</td>
</tr>
<tr>
<td>[<code>Host</code>, <code>message_publish_time</code>]</td>
<td>histogram</td>
<td>Amount of time it takes to publish a message to a RabbitMQ server and receive a confirmation. It's measured only for successful messages.</td>
</tr>
<tr>
<td>[<code>Host</code>, <code>message_payload_size</code>]</td>
<td>histogram</td>
<td>Size of a message (in bytes) that was published to a RabbitMQ server (including message properties). It's measured only for successful messages.</td>
</tr>
</tbody>
</table>
<blockquote>
<p>All the above metrics have a prefix which looks as follows:<br />
<code>&lt;xmpp_host&gt;.backends.mod_event_pusher_rabbit.&lt;metric_name&gt;</code>.
For example a proper metric name would look like:
<code>localhost.backends.mod_event_pusher_rabbit.connections_active</code></p>
</blockquote>
<h3 id="guarantees">Guarantees</h3>
<p>There are no guarantees. The current implementation uses "best effort" approach
which means that we don't care if a message is delivered to a RabbitMQ server.
If <a href="#publisher-confirms"><code>publisher confirms</code></a> are enabled and a message
couldn't be delivered to the server for some reason (the server sent negative
acknowledgment/didn't sent it at all or there was a channel exception)
the module just updates appropriate metrics and prints some log messages. Notice
that there might be situations when a message silently gets lost.</p>
<h3 id="type-of-exchanges">Type of exchanges</h3>
<p>By default all the exchanges used are of type <code>topic</code>. Using topic exchanges
gives a lot of flexibility when binding queues to such an exchange by using
<code>#</code> and <code>*</code> in binding keys. But flexibility comes at the cost of performance -
imagine a scenario where there are thousands of users and AMQP consumers use
binding keys for particular users which look like <code>user_N@host.#</code>. In such
case RabbitMQ has to go through all the users in order to find out where
a message should be sent to. This operations is proved to be costly. In a load
test with 100k users a delay caused by this operation was substantial (about an
order of magnitude higher than compared to a load test with 60k users).</p>
<p>If performance is a top priority go for <code>direct</code> exchanges. Using this type of
exchanges is proved to work efficiently with 100k users. Keep in mind it gives
up flexibility over performance.</p>
<h3 id="publisher-confirms">Publisher confirms</h3>
<p>By default publisher confirmations are disabled. However, one-to-one
confirmations can be enabled (see
<a href="../../advanced-configuration/outgoing-connections/#rabbitmq-connection-setup"><em>RabbitMQ connection setup</em></a>
section). When a worker sends a message to a RabbitMQ server it waits for a
confirmation from the server before it starts to process next message. This
approach allows to introduce backpressure on a RabbitMQ server connection cause
the server can reject/not confirm messages when it's overloaded. On the other
hand it can cause performance degradation.</p>
<h3 id="worker-selection-strategy">Worker selection strategy</h3>
<p>The module uses <code>mongoose_wpool</code> for managing worker processes  and <code>best_worker</code>
strategy, for choosing a worker, is in use by default. Different strategies
imply different behaviors of the system.</p>
<h4 id="event-messages-queuing">Event messages queuing</h4>
<p>When <code>available_worker</code> strategy is in use all the event messages are queued in
single worker pool manager process state. When different strategy is set e.g
<code>best_worker</code> those messages are placed in worker processes inboxes. Worker
selection strategy can be set in <code>rabbit</code> pool configuration.</p>
<h4 id="event-messages-ordering">Event messages ordering</h4>
<p>None of worker selection strategies ensures that user events will be delivered to
a RabbitMQ server properly ordered in time.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../mod_http_upload/" class="btn btn-neutral float-right" title="mod_http_upload">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../mod_event_pusher_sns/" class="btn btn-neutral" title="SNS backend"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../mod_event_pusher_sns/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../mod_http_upload/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
