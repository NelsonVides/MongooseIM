<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../favicon.ico">
  
  <title>How to Set up MongooseICE - MongooseIM</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  <link href="../../custom.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "How to Set up MongooseICE";
    var mkdocs_page_input_path = "user-guide/ICE_tutorial.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> MongooseIM</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">User guide</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../Get-to-know-MongooseIM/">ABCs of MongooseIM</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../MongooseIM-High-level-Architecture/">High-level Architecture</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Features-and-supported-standards/">Features and supported standards</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Getting-started/">Getting started</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../release_config/">Release/Installation configuration</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Tutorials</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../How-to-build/">How to Build MongooseIM from source code</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Push-notifications/">How to Set up MongoosePush</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">How to Set up MongooseICE</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#who-is-this-document-for">Who is this document for?</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#what-is-the-end-result-of-this-tutorial">What is the end result of this tutorial?</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#what-do-i-need-to-begin">What do I need to begin?</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#general-architecture-of-the-environment-built-with-this-tutorial">General architecture of the environment built with this tutorial</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#ice-notes">ICE notes</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#setting-up-mongooseim-signalling">Setting up MongooseIM (signalling)</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#configuration">Configuration</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#users">Users</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#setting-up-mongooseice-turnstun-server">Setting up MongooseICE (TURN/STUN server)</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#how-to-get-and-configure">How to get and configure</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#setting-up-mangosta-android">Setting up Mangosta-Android</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#how-to-get-and-install">How to get and install</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#how-to-configure">How to configure</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#setting-up-raspberrypi">Setting up RaspberryPi</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#the-software">The software</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#how-to-get-and-configure_1">How to get and configure</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#the-end-result">The end result</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#playing-the-video">Playing the video</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../iOS_tutorial/">How to Build an iOS messaging app</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Jingle-SIP-setup/">How to Set up Jingle/SIP</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Migration Guide</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../migrations/3.1.1_3.2.0/">3.1.1 to 3.2.0</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../migrations/3.3.0_3.4.0/">3.3.0 to 3.4.0</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../migrations/jid-from-mam-muc-script/">MAM MUC migration helper</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Platform</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Contributions/">Contributions to ecosystem</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../Differentiators/">Differentiators</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../History/">History</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Configuration</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Basic-configuration/">Basic Configuration</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../Erlang-cookie-security/">Erlang Cookie Security</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../Advanced-configuration/">Advanced Configuration</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/TLS-hardening/">TLS hardening</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/database-backends-configuration/">Database backends configuration</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/outgoing-connections/">Outgoing connections</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/Modules/">Extension Modules</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/Listener-modules/">Listener Modules</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/acl/">ACL</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/Services/">Services</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Authentication methods</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../authentication-methods/client-certificate/">Client Certificate</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Authentication backends</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../authentication-backends/External-authentication-module/">External Authentication Module</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../authentication-backends/HTTP-authentication-module/">HTTP Authentication Module</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../authentication-backends/JWT-authentication-module/">JWT Authentication Module</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../authentication-backends/LDAP-authentication-module/">LDAP Authentication Module</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../authentication-backends/PKI-authentication-module/">PKI Authentication Module</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">MongooseIM open XMPP extensions</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../open-extensions/muc_light/">MUC light</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../open-extensions/token-reconnection/">Token-based reconnection</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">REST API</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../rest-api/Client-frontend/">Client/frontend</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../rest-api/Metrics-backend/">Metrics backend</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../rest-api/Administration-backend/">Administration backend</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Operation and maintenance</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/gdpr-considerations/">GDPR considerations</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/Cluster-management-considerations/">Cluster management considerations</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/Cluster-configuration-and-node-management/">Cluster configuration and node management</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/Logging-%26-monitoring/">Logging & monitoring</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/Reloading-configuration-on-a-running-system/">Reloading configuration on a running system</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/Mongoose-metrics/">Metrics</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/tls-distribution/">Distribution over TLS</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/known-issues/">Known issues</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Developer's guide</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/Testing-MongooseIM/">Testing MongooseIM</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/logging/">Logging</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/Hooks-and-handlers/">Hooks and Handlers</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/hooks_description/">Hooks description</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/message_routing/">Stanza routing</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/accumulators/">Accumulators</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/flat_options/">Flat options format</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/Moving-to-single-app-project-structure/">Moving to single app project structure</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/mod_amp_developers_guide/">mod_amp development</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/mod_muc_light_developers_guide/">mod_muc_light developers doc</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/SCRAM-serialization/">SCRAM serialization format</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/xep_tool/">xep-tool usage</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/OpenSSL-and-FIPS/">FIPS mode</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/Basic-iq-handler/">Basic IQ Handler</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/mongoose_wpool/">mongoose_wpool</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Module index</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_adhoc/">mod_adhoc</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_amp/">mod_amp</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_auth_token/">mod_auth_token</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_blocking/">mod_blocking</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_bosh/">mod_bosh</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_caps/">mod_caps</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_carboncopy/">mod_carboncopy</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_commands/">mod_commands</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_csi/">mod_csi</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_inbox/">mod_inbox</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_disco/">mod_disco</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_global_distrib/">mod_global_distrib</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">mod_event_pusher</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../modules/mod_event_pusher/">mod_event_pusher</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../modules/mod_event_pusher_http/">HTTP backend</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../modules/mod_event_pusher_push/">Push backend</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../modules/mod_event_pusher_sns/">SNS backend</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../modules/mod_event_pusher_rabbit/">RabbitMQ backend</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_http_upload/">mod_http_upload</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_jingle_sip/">mod_jingle_sip</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_keystore/">mod_keystore</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_last/">mod_last</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_mam/">mod_mam</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_muc/">mod_muc</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_muc_commands/">mod_muc_commands</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_muc_log/">mod_muc_log</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_muc_light/">mod_muc_light</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_muc_light_commands/">mod_muc_light_commands</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_offline/">mod_offline</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_offline_stub/">mod_offline_stub</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_ping/">mod_ping</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_privacy/">mod_privacy</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_private/">mod_private</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_pubsub/">mod_pubsub</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_push_service_mongoosepush/">mod_push_service_mongoosepush</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_register/">mod_register</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_revproxy/">mod_revproxy</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_roster/">mod_roster</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_shared_roster_ldap/">mod_shared_roster_ldap</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_sic/">mod_sic</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_stream_management/">mod_stream_management</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_time/">mod_time</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_vcard/">mod_vcard</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_version/">mod_version</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">MongooseIM</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Tutorials &raquo;</li>
        
      
    
    <li>How to Set up MongooseICE</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="how-to-set-up-mongooseice-iceturnstun-server">How to set up MongooseICE (ICE/TURN/STUN server)</h2>
<h3 id="introduction">Introduction</h3>
<h4 id="who-is-this-document-for">Who is this document for?</h4>
<p>This tutorial presents our TURN/STUN server in action.
You get to see how to set up and configure MongooseICE and examine a system utilising its many talents.</p>
<p>Are you in need of an application requiring NAT traversal? Want to see how a TURN and STUN server would handle it? Or maybe you just like to tinker with interesting technologies and experience setting them up first hand?</p>
<p>If that's the case, this tutorial is for you.</p>
<h4 id="what-is-the-end-result-of-this-tutorial">What is the end result of this tutorial?</h4>
<p>At the end of the tutorial you will have a working environment with two peers, one sending a live video to another.
The peer-to-peer communication will not be obstructed by any NATs that may occur in the background.
The live video stream is only an example here - there are many possible use cases for peer-to-peer communication with NAT traversal.
We chose to build an example application that shows video streaming, because it's vivid, catchy and fun.</p>
<h4 id="what-do-i-need-to-begin">What do I need to begin?</h4>
<p>Before you begin you have to prepare an environment for setting up the components used in this tutorial.
Here's a list of things you'll need:
* One Android phone (or at least an Android emulator).
The video player in this tutorial is available only as an Android application.
* RaspberryPi or any other device that is able to <a href="https://elixir-lang.org/install.html">run Elixir code</a>. Oh, and also has <a href="https://ffmpeg.org">ffmpeg</a> installed.
We are going to use use RaspberryPi 3, to give this tutorial a hint of IoT.
* At least one machine with a public IPv4 address.
It is necessary, because both <a href="https://github.com/esl/MongooseIM">MongooseIM</a> and <a href="https://github.com/esl/MongooseICE">MongooseICE</a> servers need to be accessible by all devices that are used in this demo system.
You could use a private, local IP address, but then you would need to ensure that your phone and the RaspberryPi are behind some kind of a NAT relative to this IP address.</p>
<blockquote>
<p>Note: the demo will probably work without the NAT, but then there is no point in setting up a TURN server.</p>
</blockquote>
<p>We are going to use 2 VPS (Virtual Private Server) that are located somewhere far far away, both having public IPv4 address. Let's say MongooseICE is bound to <em>1.1.1.1</em>, and MongooseIM to <em>2.2.2.2</em>.</p>
<h4 id="general-architecture-of-the-environment-built-with-this-tutorial">General architecture of the environment built with this tutorial</h4>
<p>This is the architecture of the system we are building:
<img alt="ICE example architecture" src="ice_architecture.png" /></p>
<p>As we know by now, <a href="https://github.com/esl/MongooseIM">MongooseIM</a> is bound to <em>2.2.2.2</em>/<em>myxmpp.com</em> and <a href="https://github.com/esl/MongooseICE">MongooseICE</a> to <em>1.1.1.1</em>.
We also have a RaspberryPi that is connected to a private network (so is behind some NAT) and an Android phone that is connected to an LTE network and also is behind the carrier's NAT.</p>
<h4 id="ice-notes">ICE notes</h4>
<p>The end result of this tutorial not only uses <a href="https://github.com/esl/MongooseICE">MongooseICE</a> and <a href="https://github.com/esl/MongooseIM">MongooseIM</a> servers but also uses custom version of <a href="https://github.com/esl/mangosta-android">Mangosta-Android</a> and [DemoStreamerICE].
Both projects are custom modified and custom made respectively in order to showcase the video streaming using the data relay capabilities provided by <a href="https://github.com/esl/MongooseICE">MongooseICE</a>.
The streaming itself, along with the signalling protocol, were prepared only for the case of this demo and <strong>are not a part of the platform</strong>.
Those components exist only to visualize what can be achieved with <a href="https://github.com/esl/MongooseICE">MongooseICE</a> and what can be built on top of it.</p>
<h3 id="setting-up-mongooseim-signalling">Setting up MongooseIM (signalling)</h3>
<p>The ICE is nothing without signalling. The signalling protocol itself can be designed specifically for the application that is being deployed or can be implemented based on some standards, e.g. <a href="https://xmpp.org/extensions/xep-0166.html">Jingle</a>.
Here, we chose to implement the simplest signalling possible, i.e. sending relay addresses via XMPP messages.
No matter if we decide to go with this approach or with <a href="https://xmpp.org/extensions/xep-0166.html">Jingle</a>, we can use the <a href="https://github.com/esl/MongooseIM">MongooseIM</a> XMPP server as a transport layer for the signalling.
In order to enable signalling we need an instance of <a href="https://github.com/esl/MongooseIM">MongooseIM</a> running with the simplest configuration, since the only thing we need from it is to provide us with means to communicate between two peers.</p>
<h4 id="configuration">Configuration</h4>
<p>You can find MongooseIM installation instructions on <a href="../Getting-started/">this page</a>.
Once you have cloned the repository and compiled the project, you need to modify the <code>mongooseim.cfg</code> config file (you can find this file at <code>$REPO/_build/prod/rel/mongooseim/etc/mongooseim.cfg</code>, where <code>$REPO</code> is a top-level directory of the cloned repo).
You can use <a href="mongooseim.cfg">this</a> configuration file and modify the relevant part:</p>
<pre><code class="language-erlang">%%%% ICE DEMO %%%%
{hosts, [&quot;localhost&quot;, &quot;myxmpp.com&quot;] }.
</code></pre>
<p>This sets the virtual hostname of the XMPP server, so that you can register users in this domain.
After that, you can start MongooseIM with</p>
<pre><code>$REPO/_build/prod/rel/mongooseim/bin/mongooseimctl start
</code></pre>
<h4 id="users">Users</h4>
<p>After we finish setting up <a href="https://github.com/esl/MongooseIM">MongooseIM</a>, we need to register some users.
For this demo we need two users: <em>movie@myxmpp.com</em> and <em>phone@myxmpp.com</em>, for RaspberryPi and the Android phone respectively.
In order to do that, type:</p>
<pre><code class="language-bash">$REPO/_build/prod/rel/mongooseim/bin/mongooseimctl register_identified phone myxmpp.com xmpp_password
$REPO/_build/prod/rel/mongooseim/bin/mongooseimctl register_identified movie myxmpp.com xmpp_password
</code></pre>
<p>on the machine that has <a href="https://github.com/esl/MongooseIM">MongooseIM</a> installed.</p>
<p>As you can see here, we have created those two users, both with the password <em>xmpp_password</em> for simplicity.</p>
<h3 id="setting-up-mongooseice-turnstun-server">Setting up MongooseICE (TURN/STUN server)</h3>
<p>Now, since <a href="https://github.com/esl/MongooseIM">MongooseIM</a> handles the signalling, we need the TURN relay and the STUN server to send peer-to-peer data.
For that we are going to use the star of this tutorial - <a href="https://github.com/esl/MongooseICE">MongooseICE</a>.</p>
<h4 id="how-to-get-and-configure">How to get and configure</h4>
<p>The whole documentation that describes all options and deployment methods, can be found on the <a href="https://github.com/esl/MongooseICE">project's github page</a>.
Let's get to it! (this command assumes that we are on the server for <a href="https://github.com/esl/MongooseICE">MongooseICE</a> and that it has Docker installed):</p>
<pre><code class="language-bash">docker run -it --net=host -e &quot;MONGOOSEICE_UDP_RELAY_IP=1.1.1.1&quot; -e &quot;MONGOOSEICE_STUN_SECRET=secret&quot; -e &quot;MONGOOSEICE_UDP_REALM=myrelay&quot; mongooseim/mongooseice:0.4.0
</code></pre>
<p>This command starts the <a href="https://github.com/esl/MongooseICE">MongooseICE</a> server in the Docker container, attaching its virtual network interface to the network interface of the host machine the Docker deamon is running on.
There are three important configuration options we have to set via environment variables:</p>
<ul>
<li><strong>MONGOOSEICE_UDP_RELAY_IP</strong> - This is the IP address that <a href="https://github.com/esl/MongooseICE">MongooseICE</a> provides data relay on. This should be set to public IPv4 address.</li>
<li><strong>MONGOOSEICE_STUN_SECRET</strong> - This is a secret password that TURN clients need to provide to connect to this server.</li>
<li><strong>MONGOOSEICE_UDP_REALM</strong> - This is just a name for your TURN relay.</li>
</ul>
<p>And that's it! <a href="https://github.com/esl/MongooseICE">MongooseICE</a> is now ready to roll!</p>
<h3 id="setting-up-mangosta-android">Setting up Mangosta-Android</h3>
<h4 id="how-to-get-and-install">How to get and install</h4>
<p>The source code of the video-stream-demo-enabled <a href="https://github.com/esl/mangosta-android">Mangosta-Android</a> can be found on the <a href="https://github.com/esl/mangosta-android/tree/ice_demo_kt">ice_demo_kt</a> branch.
If you want to tinker with it and compile it yourself, you can do that. All you need is <a href="https://developer.android.com/studio/index.html">Android Studio 2.3+</a>.
The compilation is pretty straightforward, so I'm not going to explain it here.
If you are interested in how it works, most of the code is in the <code>inaka.com.mangosta.videostream</code> package.
If you don't want to compile this application from source, you can just install <a href="https://drive.google.com/file/d/0B48g-HBQ5xpxclQ2RnBFMUluRU0/view?usp=sharing">this .apk</a> on your phone and that's it.</p>
<h4 id="how-to-configure">How to configure</h4>
<p>Right after you start <a href="https://github.com/esl/mangosta-android">Mangosta-Android</a> for the first time, you will need to login to your XMPP server.
In order to do that, just enter the JID you have created for the phone (<em>phone@myxmpp.com</em>), the password (<em>xmpp_password</em>) and the server address (<em>2.2.2.2</em> or <em>myxmpp.com</em> if you've set up the domain to actually point to this IP address), and then confirm by clicking "Enter".</p>
<p><img alt="Mangosta login" src="mangosta_login.png" /></p>
<p>After we log in, we can start setting up the connection to the <a href="https://github.com/esl/MongooseICE">MongooseICE</a> server we set up before.
The process is shown on the screenshots below.</p>
<p><img alt="Mangosta ICE settings" src="mangosta_ice_settings.png" /></p>
<p>On the "<em>Configure ICE</em>" screen we have to set 5 fields up:</p>
<ul>
<li><strong>TURN server address</strong> - IPv4 address of our <a href="https://github.com/esl/MongooseICE">MongooseICE</a></li>
<li><strong>TURN Server port</strong> - since we did not set the port while configuring <a href="https://github.com/esl/MongooseICE">MongooseICE</a> it uses a default one - <strong>3478</strong></li>
<li><strong>TURN Realm</strong> - Realm name we have set via <em>MONGOOSEICE_UDP_REALM</em> variable. In our case it's "<em>myrelay</em>".</li>
<li><strong>TURN username</strong> - Current version of <a href="https://github.com/esl/MongooseICE">MongooseICE</a> ignores this, so you may leave it as is.</li>
<li><strong>TURN password</strong> - The password that we have set via <em>MONGOOSEICE_STUN_SECRET</em> variable. In our case it's "<em>secret</em>"</li>
</ul>
<p>And that would be all.
Now you can click "<em>TEST CONNECTION</em>" to, well..., test the connection.
If everything works, you can "<em>SAVE</em>" the settings.
Now your <a href="https://github.com/esl/mangosta-android">Mangosta-Android</a> is ready to play streamed video, but we still need the source...</p>
<h3 id="setting-up-raspberrypi">Setting up RaspberryPi</h3>
<p>Let's configure the video source now.
In our case it will be a RaspberryPi with <a href="https://elixir-lang.org/install.html">Elixir</a> and <a href="https://ffmpeg.org">ffmpeg</a> installed running <a href="https://github.com/esl/ice_demo">our ICE demo application</a>.</p>
<h4 id="the-software">The software</h4>
<p>For this demo we provide a simple XMPP client that also is able to send live video stream using <a href="https://ffmpeg.org">ffmpeg</a> whenever other peer asks for it via XMPP.
This client is written in <a href="https://elixir-lang.org/install.html">Elixir</a>, so we can run it from source quite easily.</p>
<h4 id="how-to-get-and-configure_1">How to get and configure</h4>
<p>You can get the client's sources <a href="https://github.com/esl/ice_demo">here</a>.
For now we only need to run it, so let's get to it (on our RaspberryPi):</p>
<pre><code class="language-bash">git clone https://github.com/esl/ice_demo.git
cd ice_demo
mix deps.get
iex -S mix
</code></pre>
<p>After a while we should get into Elixir shell.
In order to enable the streamer, we need to start it, providing some configuration options (in the Elixir shell):</p>
<pre><code class="language-elixir">opts = [
jid: &quot;movie@myxmpp.com&quot;,
password: &quot;xmpp_password&quot;,
host: &quot;myxmpp.com&quot;,
turn_addr: &quot;1.1.1.1:3784&quot;
turn_username: &quot;username&quot;,
turn_secret: &quot;secret&quot;,
video_file: &quot;/home/pi/sintel.h264&quot;
]
ICEDemo.start_movie(opts)
</code></pre>
<p>The first 3 options are all about connecting to the XMPP server - we use "<em>movie@myxmpp.com</em>" user that we created earlier.
Next 3 options are about connecting to the <a href="https://github.com/esl/MongooseICE">MongooseICE</a> server.
Those are similar to ones we set in <a href="https://github.com/esl/mangosta-android">Mangosta-Android</a>.
The last one points to the video file that will be streamed on request.
This file has to be raw, H.264-encoded, video-only file.
If you are not sure how to get one, you can just use <a href="https://drive.google.com/file/d/0B48g-HBQ5xpxeVlUSks2bVRlLTQ/view?usp=sharing">this one</a> (pre-rendered <a href="https://durian.blender.org/">Sintel, OpenBlender project</a>).
With this configuration, our RaspberryPi is ready to stream!</p>
<h3 id="the-end-result">The end result</h3>
<h4 id="playing-the-video">Playing the video</h4>
<p>Now we finally can get out phone and start streaming the video!
In order to do that, we have to click the "<em>New video stream</em>" button as shown on the screenshots below, enter the JID of the RaspberryPi and confirm with the "<em>Stream!</em>" button.</p>
<p><img alt="Mangosta start streaming" src="mangosta_start_stream.png" /></p>
<p>Hopefully, now you can see the video on your own mobile device.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../iOS_tutorial/" class="btn btn-neutral float-right" title="How to Build an iOS messaging app">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../Push-notifications/" class="btn btn-neutral" title="How to Set up MongoosePush"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../Push-notifications/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../iOS_tutorial/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
