
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../../favicon.ico">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.8">
    
    
      
        <title>How to Build an iOS messaging app - MongooseIM</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.cb6bc1d0.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.39b8e14a.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../css/custom.css">
    
      <link rel="stylesheet" href="../../css/version-select.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#build-a-complete-ios-messaging-app-using-xmppframework" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="MongooseIM" class="md-header-nav__button md-logo" aria-label="MongooseIM">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            MongooseIM
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              How to Build an iOS messaging app
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="MongooseIM" class="md-nav__button md-logo" aria-label="MongooseIM">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    MongooseIM
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" >
      
      <label class="md-nav__link" for="nav-2">
        User guide
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="User guide" data-md-level="1">
        <label class="md-nav__title" for="nav-2">
          <span class="md-nav__icon md-icon"></span>
          User guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../ABCs-of-MongooseIM/" class="md-nav__link">
        ABCs of MongooseIM
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../MongooseIM-High-level-Architecture/" class="md-nav__link">
        High-level Architecture
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Features-and-supported-standards/" class="md-nav__link">
        Features and supported standards
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Getting-started/" class="md-nav__link">
        Getting started
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../release_config/" class="md-nav__link">
        Release/Installation configuration
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Bootstrap-Scripts/" class="md-nav__link">
        Bootstrap scripts
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../client-certificate/" class="md-nav__link">
        Client certificate authentication
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
      
      <label class="md-nav__link" for="nav-3">
        Tutorials
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Tutorials" data-md-level="1">
        <label class="md-nav__title" for="nav-3">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../How-to-build/" class="md-nav__link">
        How to Build MongooseIM from source code
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../push-notifications/Push-notifications/" class="md-nav__link">
        How to Set up Push Notifications
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../push-notifications/Push-notifications-client-side/" class="md-nav__link">
        How to Set up Push Notifications on the client side
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../push-notifications/MongoosePush-setup/" class="md-nav__link">
        How to Set up MongoosePush
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../ICE_tutorial/" class="md-nav__link">
        How to Set up MongooseICE
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          How to Build an iOS messaging app
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        How to Build an iOS messaging app
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#yaxt-yet-another-xmpp-tutorial" class="md-nav__link">
    YAXT??! Yet another XMPP tutorial?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#whats-xmpp" class="md-nav__link">
    What’s XMPP?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-do-we-need-xmpp-why-not-just-rest" class="md-nav__link">
    Why do we need XMPP? Why not just REST?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#whats-the-basic-stuff-i-need-to-know-to-get-started" class="md-nav__link">
    What’s the basic stuff I need to know to get started?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#whats-a-jid" class="md-nav__link">
    What’s a JID?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#whats-a-stanza" class="md-nav__link">
    What’s a Stanza?
  </a>
  
    <nav class="md-nav" aria-label="What’s a Stanza?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#message" class="md-nav__link">
    &lt;message/&gt;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presence" class="md-nav__link">
    &lt;presence/&gt;
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#whats-a-stream" class="md-nav__link">
    What’s a Stream?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#are-we-ok-so-far" class="md-nav__link">
    Are we ok so far?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#first-steps-installing-the-xmppframework-library" class="md-nav__link">
    First steps: installing the XMPPFramework library
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#starting-to-build-our-instant-messaging-app" class="md-nav__link">
    Starting to build our Instant Messaging app
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-a-log-in" class="md-nav__link">
    Getting a Log In
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#logging" class="md-nav__link">
    Logging!
  </a>
  
    <nav class="md-nav" aria-label="Logging!">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuring-cocoalumberjack" class="md-nav__link">
    Configuring CocoaLumberjack
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-time" class="md-nav__link">
    Test Time!
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Jingle-SIP-setup/" class="md-nav__link">
        How to Set up Jingle/SIP
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" >
      
      <label class="md-nav__link" for="nav-4">
        Migration Guide
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Migration Guide" data-md-level="1">
        <label class="md-nav__title" for="nav-4">
          <span class="md-nav__icon md-icon"></span>
          Migration Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../migrations/3.1.1_3.2.0/" class="md-nav__link">
        3.1.1 to 3.2.0
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../migrations/3.3.0_3.4.0/" class="md-nav__link">
        3.3.0 to 3.4.0
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../migrations/3.5.0_3.6.0/" class="md-nav__link">
        3.5.0 to 3.6.0
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../migrations/3.6.0_3.7.0/" class="md-nav__link">
        3.6.0 to 3.7.0
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../migrations/3.7.0_4.0.0/" class="md-nav__link">
        3.7.0 to 4.0.0
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../migrations/4.0.0_4.0.1/" class="md-nav__link">
        4.0.0 to 4.0.1
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../migrations/4.0.1_4.1.0/" class="md-nav__link">
        4.0.1 to 4.1.0
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../migrations/jid-from-mam-muc-script/" class="md-nav__link">
        MAM MUC migration helper
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" >
      
      <label class="md-nav__link" for="nav-5">
        Platform
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Platform" data-md-level="1">
        <label class="md-nav__title" for="nav-5">
          <span class="md-nav__icon md-icon"></span>
          Platform
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Contributions/" class="md-nav__link">
        Contributions to ecosystem
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Differentiators/" class="md-nav__link">
        Differentiators
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../History/" class="md-nav__link">
        History
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" >
      
      <label class="md-nav__link" for="nav-6">
        Configuration
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Configuration" data-md-level="1">
        <label class="md-nav__title" for="nav-6">
          <span class="md-nav__icon md-icon"></span>
          Configuration
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced-configuration/configuration-files/" class="md-nav__link">
        Configuration files
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced-configuration/general/" class="md-nav__link">
        Options: General
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced-configuration/listen/" class="md-nav__link">
        Options: Listen
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced-configuration/auth/" class="md-nav__link">
        Options: Auth
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced-configuration/outgoing-connections/" class="md-nav__link">
        Options: Outgoing connections
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced-configuration/Services/" class="md-nav__link">
        Options: Services
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced-configuration/Modules/" class="md-nav__link">
        Options: Extension Modules
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced-configuration/shaper/" class="md-nav__link">
        Options: Shaper
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced-configuration/acl/" class="md-nav__link">
        Options: Acl
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced-configuration/access/" class="md-nav__link">
        Options: Access
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced-configuration/s2s/" class="md-nav__link">
        Options: S2S
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced-configuration/host_config/" class="md-nav__link">
        Options: Host config
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced-configuration/release-options/" class="md-nav__link">
        Release options
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced-configuration/Erlang-cookie-security/" class="md-nav__link">
        Erlang Cookie Security
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced-configuration/TLS-hardening/" class="md-nav__link">
        TLS hardening
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced-configuration/database-backends-configuration/" class="md-nav__link">
        Database backends configuration
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" >
      
      <label class="md-nav__link" for="nav-7">
        Authentication methods
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Authentication methods" data-md-level="1">
        <label class="md-nav__title" for="nav-7">
          <span class="md-nav__icon md-icon"></span>
          Authentication methods
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication-methods/rdbms/" class="md-nav__link">
        RDBMS
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication-methods/external/" class="md-nav__link">
        External
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication-methods/anonymous/" class="md-nav__link">
        Anonymous
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication-methods/ldap/" class="md-nav__link">
        LDAP
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication-methods/jwt/" class="md-nav__link">
        JWT
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication-methods/riak/" class="md-nav__link">
        Riak
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication-methods/http/" class="md-nav__link">
        HTTP
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication-methods/pki/" class="md-nav__link">
        PKI
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication-methods/dummy/" class="md-nav__link">
        Dummy
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8" >
      
      <label class="md-nav__link" for="nav-8">
        MongooseIM open XMPP extensions
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="MongooseIM open XMPP extensions" data-md-level="1">
        <label class="md-nav__title" for="nav-8">
          <span class="md-nav__icon md-icon"></span>
          MongooseIM open XMPP extensions
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../open-extensions/muc_light/" class="md-nav__link">
        MUC light
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../open-extensions/token-reconnection/" class="md-nav__link">
        Token-based reconnection
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9" >
      
      <label class="md-nav__link" for="nav-9">
        REST API
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="REST API" data-md-level="1">
        <label class="md-nav__title" for="nav-9">
          <span class="md-nav__icon md-icon"></span>
          REST API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../rest-api/Client-frontend/" class="md-nav__link">
        Client/frontend
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../rest-api/Metrics-backend/" class="md-nav__link">
        Metrics backend
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../rest-api/Administration-backend/" class="md-nav__link">
        Administration backend
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10" >
      
      <label class="md-nav__link" for="nav-10">
        Operation and maintenance
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Operation and maintenance" data-md-level="1">
        <label class="md-nav__title" for="nav-10">
          <span class="md-nav__icon md-icon"></span>
          Operation and maintenance
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operation-and-maintenance/gdpr-considerations/" class="md-nav__link">
        GDPR considerations
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operation-and-maintenance/Cluster-management-considerations/" class="md-nav__link">
        Cluster management considerations
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operation-and-maintenance/Cluster-configuration-and-node-management/" class="md-nav__link">
        Cluster configuration and node management
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operation-and-maintenance/Logging-%26-monitoring/" class="md-nav__link">
        Logging & monitoring
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operation-and-maintenance/Logging/" class="md-nav__link">
        Logging configuration
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operation-and-maintenance/Humio/" class="md-nav__link">
        Logging with Humio
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operation-and-maintenance/Logging-fields/" class="md-nav__link">
        Logging fields
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operation-and-maintenance/Rolling-upgrade/" class="md-nav__link">
        Rolling upgrade
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operation-and-maintenance/Cluster-restart/" class="md-nav__link">
        Cluster restart
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operation-and-maintenance/MongooseIM-metrics/" class="md-nav__link">
        Metrics
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operation-and-maintenance/System-Metrics-Privacy-Policy/" class="md-nav__link">
        System Metrics Privacy Policy
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operation-and-maintenance/tls-distribution/" class="md-nav__link">
        Distribution over TLS
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operation-and-maintenance/known-issues/" class="md-nav__link">
        Known issues
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11" >
      
      <label class="md-nav__link" for="nav-11">
        Developer's guide
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Developer's guide" data-md-level="1">
        <label class="md-nav__title" for="nav-11">
          <span class="md-nav__icon md-icon"></span>
          Developer's guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers-guide/Testing-MongooseIM/" class="md-nav__link">
        Testing MongooseIM
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers-guide/logging/" class="md-nav__link">
        Logging
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers-guide/Hooks-and-handlers/" class="md-nav__link">
        Hooks and Handlers
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers-guide/hooks_description/" class="md-nav__link">
        Hooks description
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers-guide/Stanza-routing/" class="md-nav__link">
        Stanza routing
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers-guide/accumulators/" class="md-nav__link">
        Accumulators
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers-guide/Moving-to-single-app-project-structure/" class="md-nav__link">
        Moving to single app project structure
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers-guide/mod_amp_developers_guide/" class="md-nav__link">
        mod_amp development
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers-guide/mod_muc_light_developers_guide/" class="md-nav__link">
        mod_muc_light developers doc
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers-guide/SCRAM-serialization/" class="md-nav__link">
        SCRAM serialization format
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers-guide/xep_tool/" class="md-nav__link">
        xep-tool usage
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers-guide/OpenSSL-and-FIPS/" class="md-nav__link">
        FIPS mode
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers-guide/Basic-iq-handler/" class="md-nav__link">
        Basic IQ Handler
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers-guide/mongoose_wpool/" class="md-nav__link">
        mongoose_wpool
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-12" type="checkbox" id="nav-12" >
      
      <label class="md-nav__link" for="nav-12">
        Module index
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Module index" data-md-level="1">
        <label class="md-nav__title" for="nav-12">
          <span class="md-nav__icon md-icon"></span>
          Module index
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_adhoc/" class="md-nav__link">
        mod_adhoc
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_amp/" class="md-nav__link">
        mod_amp
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_auth_token/" class="md-nav__link">
        mod_auth_token
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_blocking/" class="md-nav__link">
        mod_blocking
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_bosh/" class="md-nav__link">
        mod_bosh
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_caps/" class="md-nav__link">
        mod_caps
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_carboncopy/" class="md-nav__link">
        mod_carboncopy
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_commands/" class="md-nav__link">
        mod_commands
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_csi/" class="md-nav__link">
        mod_csi
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_disco/" class="md-nav__link">
        mod_disco
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-12-11" type="checkbox" id="nav-12-11" >
      
      <label class="md-nav__link" for="nav-12-11">
        mod_event_pusher
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="mod_event_pusher" data-md-level="2">
        <label class="md-nav__title" for="nav-12-11">
          <span class="md-nav__icon md-icon"></span>
          mod_event_pusher
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_event_pusher/" class="md-nav__link">
        mod_event_pusher
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_event_pusher_http/" class="md-nav__link">
        HTTP backend
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_event_pusher_push/" class="md-nav__link">
        Push backend
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_event_pusher_sns/" class="md-nav__link">
        SNS backend
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_event_pusher_rabbit/" class="md-nav__link">
        RabbitMQ backend
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_extdisco/" class="md-nav__link">
        mod_extdisco
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_global_distrib/" class="md-nav__link">
        mod_global_distrib
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_http_upload/" class="md-nav__link">
        mod_http_upload
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_inbox/" class="md-nav__link">
        mod_inbox
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_jingle_sip/" class="md-nav__link">
        mod_jingle_sip
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_keystore/" class="md-nav__link">
        mod_keystore
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_last/" class="md-nav__link">
        mod_last
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_mam/" class="md-nav__link">
        mod_mam
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_muc/" class="md-nav__link">
        mod_muc
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_muc_commands/" class="md-nav__link">
        mod_muc_commands
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_muc_log/" class="md-nav__link">
        mod_muc_log
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_muc_light/" class="md-nav__link">
        mod_muc_light
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_muc_light_commands/" class="md-nav__link">
        mod_muc_light_commands
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_offline/" class="md-nav__link">
        mod_offline
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_offline_stub/" class="md-nav__link">
        mod_offline_stub
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_ping/" class="md-nav__link">
        mod_ping
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_privacy/" class="md-nav__link">
        mod_privacy
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_private/" class="md-nav__link">
        mod_private
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_pubsub/" class="md-nav__link">
        mod_pubsub
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_push_service_mongoosepush/" class="md-nav__link">
        mod_push_service_mongoosepush
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_register/" class="md-nav__link">
        mod_register
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_roster/" class="md-nav__link">
        mod_roster
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_shared_roster_ldap/" class="md-nav__link">
        mod_shared_roster_ldap
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_sic/" class="md-nav__link">
        mod_sic
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_stream_management/" class="md-nav__link">
        mod_stream_management
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_time/" class="md-nav__link">
        mod_time
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_vcard/" class="md-nav__link">
        mod_vcard
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/mod_version/" class="md-nav__link">
        mod_version
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#yaxt-yet-another-xmpp-tutorial" class="md-nav__link">
    YAXT??! Yet another XMPP tutorial?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#whats-xmpp" class="md-nav__link">
    What’s XMPP?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-do-we-need-xmpp-why-not-just-rest" class="md-nav__link">
    Why do we need XMPP? Why not just REST?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#whats-the-basic-stuff-i-need-to-know-to-get-started" class="md-nav__link">
    What’s the basic stuff I need to know to get started?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#whats-a-jid" class="md-nav__link">
    What’s a JID?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#whats-a-stanza" class="md-nav__link">
    What’s a Stanza?
  </a>
  
    <nav class="md-nav" aria-label="What’s a Stanza?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#message" class="md-nav__link">
    &lt;message/&gt;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presence" class="md-nav__link">
    &lt;presence/&gt;
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#whats-a-stream" class="md-nav__link">
    What’s a Stream?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#are-we-ok-so-far" class="md-nav__link">
    Are we ok so far?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#first-steps-installing-the-xmppframework-library" class="md-nav__link">
    First steps: installing the XMPPFramework library
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#starting-to-build-our-instant-messaging-app" class="md-nav__link">
    Starting to build our Instant Messaging app
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-a-log-in" class="md-nav__link">
    Getting a Log In
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#logging" class="md-nav__link">
    Logging!
  </a>
  
    <nav class="md-nav" aria-label="Logging!">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuring-cocoalumberjack" class="md-nav__link">
    Configuring CocoaLumberjack
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-time" class="md-nav__link">
    Test Time!
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="build-a-complete-ios-messaging-app-using-xmppframework">Build a complete iOS messaging app using XMPPFramework</h1>
<p>Read our blog posts:</p>
<ul>
<li><a href="https://www.erlang-solutions.com/blog/build-a-complete-ios-messaging-app-using-xmppframework-tutorial-part-1.html">Build a complete iOS messaging app using XMPPFramework - Tutorial Part 1</a></li>
<li><a href="https://www.erlang-solutions.com/blog/build-a-complete-ios-messaging-app-using-xmppframework-part-2.html">Build a complete iOS messaging app using XMPPFramework - Part 2</a></li>
</ul>
<h2 id="yaxt-yet-another-xmpp-tutorial">YAXT??! Yet another XMPP tutorial?</h2>
<p>Well, this is going to be another tutorial, but I’m going to try to make it a little bit different.
This is an XMPP tutorial from an iOS developer’s perspective.
I’ll try to answer all the questions I had when I started working in this area.
This journey is going to go from no XMPP knowldege at all
to having a fully functional instant messaging iOS appusing this cool protocol.
We are going to be using the super awesome (yet overwhelming at the beginning…) <a href="https://github.com/robbiehanson/XMPPFramework">XMPPFramework</a> library,
and the idea is also to also mix in some iOS concepts that you are going to need for your app.</p>
<h2 id="whats-xmpp">What’s XMPP?</h2>
<p>From <a href="https://en.wikipedia.org/wiki/XMPP">Wikipedia</a>:
Extensible Messaging and Presence Protocol (XMPP) is a communications protocol for message-oriented middleware based on XML.</p>
<p>This basically means XMPP is a protocol for exchanging stuff.
What kind of stuff? Messages and presences.
We all know what messages are, but what about presences?
A presence is just a way of sharing a “status”, that’s it.
You can be ‘online’, 'offline’, 'having lunch’, or whatever you want.
Also there’s another important word: Extensible meaning it can grow.
It started as an instant messaging protocol
and it has grown into multiple fields for example IoT (Internet of Things).
And last, but not least:
every piece of information we are going to exchange under this protocol is going to be XML.
I can heard you complaining but…
Come on, it’s not that bad!</p>
<h2 id="why-do-we-need-xmpp-why-not-just-rest">Why do we need XMPP? Why not just REST?</h2>
<p>Well what other options do we have?
On the one hand, a custom solution means building everything from scratch, that takes time.
On the other hand, we have XMPP, a super tested technology broadly used by millions of people every day,
so we can say that’s an advantage over a custom approach.</p>
<p>Everytime I talk about XMPP, someone asks me 'Why not just REST?’.
Well, there is a misconception here.
REST is not a protocol, it’s just a way of architecting a networked application;
it’s just a standarized way of doing something (that I love btw).
So let’s change the question to something that makes more sense:
“Why not just build a custom REST chat application?”.
The first thing that comes to my mind is what I already explained in the previous paragraph,
but there is something else.
How do I know when someone has sent me a message?
For XMPP this is trivial:
we have an open connection all the time so,
as soon as a message arrives to the server,
it will send us the message.
We have a full-duplex.
On the other hand, the only solution with REST is polling.
We will need to ask the server for new messages from time to time to see if there is something new for us.
That sucks.
So, we will have to add a mechanism that allows us to receive the messages as soon as they are created,
like SSE or WebSockets.</p>
<p>There is one more XMPP advantage over a custom REST chat application.
REST uses HTTP, an application level protocol that is built on top of a transport level protocol: TCP.
So everytime you want to use your REST solution,
you will need HTTP,
a protocol that is not always available everywhere (maybe you need to embed this in a cheap piece of hardware?).
Besides, we have XMPP built on top of TCP that’s going to be always available.</p>
<h2 id="whats-the-basic-stuff-i-need-to-know-to-get-started">What’s the basic stuff I need to know to get started?</h2>
<p>Well, you know a lot already but let’s make a list. Lists are always good:</p>
<ul>
<li>XMPP is built on top of TCP. It keeps an open connection all the time.</li>
<li>Client/Server architecture. Messages always go through a server.</li>
<li>Everything we send and receive is going to be XML and it’s called Stanza.</li>
<li>We have three different types of stanzas: iq, message and presence.</li>
<li>Every individual on the XMPP network is univocally identified by a JID (Jabber ID).</li>
<li>All the stanzas are cointained in a Stream. Let’s imagine the Stream as a white canvas where you and the server write the stanzas.</li>
<li>Stream, iq, message and presence are the core of XMPP. You can find everything perfectly detailed in RFC6120
XMPP can be extended to accomplish different stuff. Each extension is called XEP (XMPP Extension Protocol).</li>
</ul>
<h2 id="whats-a-jid">What’s a JID?</h2>
<p>Jabber ID (JID) is how we univocally identify each individual in XMPP.
It is the address to where we are going to send our stanzas.</p>
<p>This is how a JID looks like:</p>
<p><img alt="This is how a JID looks like" src="../content_jid.png" /></p>
<ul>
<li><strong>localpart</strong>: This is your username.</li>
<li><strong>domainpart</strong>: Server name where the <strong>localpart</strong> resides.</li>
<li><strong>resourcepart</strong>: This is optional, and it identifies a particular client for the user. For example: I can be logged in with <code>andres@erlang-solutions.com</code> on my iPhone, on my Android and on my mac at the same time… So all these will be the same <strong>localpart</strong> + <strong>domainpart</strong> but different <strong>resourcepart</strong></li>
</ul>
<p>I’m sure you have already noticed how similar the JID looks to a standard email address.
This is because you can connect multiple servers together and the messages are rooted to the right user in the right server,
just as email works.
Pretty cool, right?</p>
<p>Sometimes you will see we have a JID with just the domain part.
Why?!
Because it’s also possible to send stanzas to a service instead of a user.
A service?
What’s a service?!
Services are different pieces of an XMPP server that offer you some special functionality,
but don’t worry about this right now, just remember: you can have JIDs without a localpart.</p>
<h2 id="whats-a-stanza">What’s a Stanza?</h2>
<p>Stanza is the name of the XML pieces that we are going to be sending and receiving.
The defined stanzas are: <code>&lt;message/&gt;</code>, <code>&lt;presence/&gt;</code> and <code>&lt;iq/&gt;</code>.</p>
<h3 id="message"><code>&lt;message/&gt;</code></h3>
<p>This is a basic <code>&lt;message/&gt;</code> stanza.
Everytime you want to send a message to someone (a JID), you will have to send this stanza:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nt">&lt;message</span> <span class="na">from=</span><span class="s">&#39;andres@erlang-solutions.com/iphone&#39;</span> <span class="na">to=</span><span class="s">&#39;juana@erlang-solutions.com&#39;</span> <span class="na">type=</span><span class="s">&#39;chat&#39;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;body&gt;</span>Hey there!<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/message&gt;</span>
 ```

### `<span class="nt">&lt;iq/&gt;</span>`

It stands for Info/Query.
It’s a query-action mechanism, you send an `iq` and you will get a response to that query.
You can pair the `iq-query` with the `iq-response` using the stanza id.

For example, we send an `iq` to the server to do something
(don’t pay attention to what we want to do… you just need to know there is an `iq` stanza and how the mechanism works):

```xml
<span class="nt">&lt;iq</span> <span class="na">to=</span><span class="s">&#39;erlang-solutions.com&#39;</span> <span class="na">type=</span><span class="s">&#39;get&#39;</span> <span class="na">id=</span><span class="s">&#39;1&#39;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;query</span> <span class="na">xmlns=</span><span class="s">&#39;http://jabber.org/protocol/disco#items&#39;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/iq&gt;</span>
</code></pre></div>
</td></tr></table>
<p>And we get back another <code>iq</code> with the same id with the result of the previous query:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nt">&lt;iq</span> <span class="na">from=</span><span class="s">&#39;erlang-solutions.com&#39;</span> <span class="na">to=</span><span class="s">&#39;ramabit@erlang-solutions.com/Andress-MacBook-Air&#39;</span> <span class="na">id=</span><span class="s">&#39;1&#39;</span> <span class="na">type=</span><span class="s">&#39;result&#39;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;query</span> <span class="na">xmlns=</span><span class="s">&#39;http://jabber.org/protocol/disco#items&#39;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;item</span> <span class="na">jid=</span><span class="s">&#39;muc.erlang-solutions.com&#39;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;item</span> <span class="na">jid=</span><span class="s">&#39;muclight.erlang-solutions.com&#39;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;item</span> <span class="na">jid=</span><span class="s">&#39;pubsub.erlang-solutions.com&#39;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/query&gt;</span>
<span class="nt">&lt;/iq&gt;</span>
</code></pre></div>
</td></tr></table>
<h3 id="presence"><code>&lt;presence/&gt;</code></h3>
<p>Used to exchange presence information, as you could have imagined.
Usually presences are sent from the client to the server and broadcasted by it.
The most basic, yet valid presence, to indicate to the server that a user is avaiable is:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nt">&lt;presence/&gt;</span>
</code></pre></div>
</td></tr></table>
<p>After a sucessfull connection,
you are not going to receive any <code>&lt;message/&gt;</code> until you make yourself available sending the previous presence.</p>
<p>If you want to make yourself unavailable, you just have to send:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nt">&lt;presence</span> <span class="na">type=</span><span class="s">&quot;unavailable&quot;</span><span class="nt">&gt;&lt;/presence&gt;</span>
</code></pre></div>
</td></tr></table>
<p>If we want to make the presences more useful, we can send something like this:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nt">&lt;presence&gt;</span>
      <span class="nt">&lt;status&gt;</span>On vacation<span class="nt">&lt;/status&gt;</span>
<span class="nt">&lt;/presence&gt;</span>
</code></pre></div>
</td></tr></table>
<h2 id="whats-a-stream">What’s a Stream?</h2>
<p>Before answering this, let’s refresh our mind.
What’s a Unix socket?
From Wikipedia: A socket is a special file used for inter-process communication.
These allows communication between two processes.
So a socket is a file that can be written by two processes
(in the same computer or in different computers in the same network).
So the client is going to write to this file and server too.</p>
<p>Ok, but how is a socket related to a Stream?
Well, we are going to be connected to a server using a socket,
therefore we are going to have a 'shared file’ between the client and the server.
This shared file is a white canvas where we are going to start writting our XML stanzas.
The first thing we are going to write to this file is an opening <code>&lt;stream&gt;</code> tag! 
And there you go… that’s our stream.</p>
<p>Perfect, I understand what a stream is, but I still don’t understand how to send a message to the server.
Well, the only thing we need to do to send a message is writting a <message/> stanza in our shared file.
But what happens when the server wants to send me a message?
Simple: it will write the message in the 'shared file’.</p>
<h2 id="are-we-ok-so-far">Are we ok so far?</h2>
<p>I’m sure at this point you have questions like:</p>
<ul>
<li>“What?! An active TCP connection open all the time? I’m used to REST! How am I going to do that?!” </li>
<li>Easy, you don’t have to care about that any more! That’s why we are going to use the library, and it will take care of that.</li>
<li>“You said nothing about how to connect to the server!”</li>
<li>Believe me, you don’t have to care about this either. If we start adding all this info, we are going to get crazy. Trust me, I’ve been there.</li>
<li>“What about encrypted messages? We need security! How are we going to handle this?”</li>
<li>Again, you don’t have to care about this at this point. Baby steps!</li>
</ul>
<p>You just need to be able to answer:
“What’s XMPP?”,
“How do you send a message?”,
“How do you change your status in XMPP?”,
“How do you ask something to the server?”,
“What’s a Stream?”.
If you can answer all that, you are WAY better than me when I started.</p>
<h2 id="first-steps-installing-the-xmppframework-library">First steps: installing the XMPPFramework library</h2>
<p>Let’s create a brand new Xcode project and install the library.
In this tutorial we are going to be using <code>Swift 3</code>.
The easiest way to integrate XMPPFramework to the project is using <a href="https://cocoapods.org/">CocoaPods</a>.</p>
<p>Let’s create our <code>Podfile</code> using the <code>pod init</code> command in the folder where our <code>.xcodeproj</code> lives.
There are thousands of forks but the maintained one is the original: <code>robbiehanson/XMPPFramework</code>.</p>
<p>So let’s add the <code>pod</code> to our <code>Podfile</code> and remember to uncomment the <code>use_frameworks!</code>.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>use_frameworks!

target &#39;CrazyMessages&#39; do
    pod &#39;XMPPFramework&#39;, :git=&gt; &#39;git@github.com:robbiehanson/XMPPFramework.git&#39;, :branch =&gt; &#39;master&#39;
end
</code></pre></div>
</td></tr></table>
<p>Then <code>pod install</code> and <code>CocoaPods</code> is going to do its magic and create a <code>.xcworkspace</code> with the library integrated.
Now we just need to <code>import XMPPFramework</code> in the files we want to use the library and that’s it.</p>
<h2 id="starting-to-build-our-instant-messaging-app">Starting to build our Instant Messaging app</h2>
<p>The most important thing in an XMPP application is the stream,
that’s where we are going to “write” our stanzas, so we need an object that is going to hold it.
We are going to create an <code>XMPPController</code> class with an <code>XMPPStream</code>:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kd">import</span> <span class="nc">Foundation</span>
<span class="kd">import</span> <span class="nc">XMPPFramework</span>

<span class="kd">class</span> <span class="nc">XMPPController</span><span class="p">:</span> <span class="bp">NSObject</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">xmppStream</span><span class="p">:</span> <span class="n">XMPPStream</span>

    <span class="kd">init</span><span class="p">()</span> <span class="p">{</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">xmppStream</span> <span class="p">=</span> <span class="n">XMPPStream</span><span class="p">()</span>  
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div>
</td></tr></table>
<p>We are dealing with a highly asynchronous library here.
For every action we are going to have a response some time in the future.
To handle this <code>XMPPFramework</code> defines the <code>XMPPStreamDelegate</code>.
So implementing that delegate is going to help us answer lots of different questions like:
“How do I know when XMPP has successfully connected?”,
“How do I know if I’m correctly authenticated?”,
“How do I know if I received a message?”.
<code>XMPPStreamDelegate</code> is your friend!</p>
<p>So we have our <code>XMPPController</code> and our <code>XMPPStream</code>,
what do we need to do now?
Configure our stream with the <code>hostName</code>, <code>port</code> and <code>ourJID</code>.
To provide all this info to the controller
we are going to make some changes to the <code>init</code> to be able to receive all these parameters:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kd">enum</span> <span class="nc">XMPPControllerError</span><span class="p">:</span> <span class="n">Error</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">wrongUserJID</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">XMPPController</span><span class="p">:</span> <span class="bp">NSObject</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">xmppStream</span><span class="p">:</span> <span class="n">XMPPStream</span>

    <span class="kd">let</span> <span class="nv">hostName</span><span class="p">:</span> <span class="nb">String</span>
    <span class="kd">let</span> <span class="nv">userJID</span><span class="p">:</span> <span class="n">XMPPJID</span>
    <span class="kd">let</span> <span class="nv">hostPort</span><span class="p">:</span> <span class="nb">UInt16</span>
    <span class="kd">let</span> <span class="nv">password</span><span class="p">:</span> <span class="nb">String</span>

    <span class="kd">init</span><span class="p">(</span><span class="n">hostName</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="n">userJIDString</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="n">hostPort</span><span class="p">:</span> <span class="nb">UInt16</span> <span class="p">=</span> <span class="mi">5222</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="kr">throws</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="kd">let</span> <span class="nv">userJID</span> <span class="p">=</span> <span class="n">XMPPJID</span><span class="p">(</span><span class="n">string</span><span class="p">:</span> <span class="n">userJIDString</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="n">XMPPControllerError</span><span class="p">.</span><span class="n">wrongUserJID</span>
        <span class="p">}</span>

        <span class="kc">self</span><span class="p">.</span><span class="n">hostName</span> <span class="p">=</span> <span class="n">hostName</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">userJID</span> <span class="p">=</span> <span class="n">userJID</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">hostPort</span> <span class="p">=</span> <span class="n">hostPort</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">password</span> <span class="p">=</span> <span class="n">password</span>

        <span class="c1">// Stream Configuration</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">xmppStream</span> <span class="p">=</span> <span class="n">XMPPStream</span><span class="p">()</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">xmppStream</span><span class="p">.</span><span class="n">hostName</span> <span class="p">=</span> <span class="n">hostName</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">xmppStream</span><span class="p">.</span><span class="n">hostPort</span> <span class="p">=</span> <span class="n">hostPort</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">xmppStream</span><span class="p">.</span><span class="n">startTLSPolicy</span> <span class="p">=</span> <span class="n">XMPPStreamStartTLSPolicy</span><span class="p">.</span><span class="n">allowed</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">xmppStream</span><span class="p">.</span><span class="n">myJID</span> <span class="p">=</span> <span class="n">userJID</span>

        <span class="kc">super</span><span class="p">.</span><span class="kd">init</span><span class="p">()</span>

        <span class="kc">self</span><span class="p">.</span><span class="n">xmppStream</span><span class="p">.</span><span class="n">addDelegate</span><span class="p">(</span><span class="kc">self</span><span class="p">,</span> <span class="n">delegateQueue</span><span class="p">:</span> <span class="n">DispatchQueue</span><span class="p">.</span><span class="n">main</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
<p>Our next step is going to actually connect to a server and authenticate using our <code>userJID</code> and <code>password</code>,
so we are adding a <code>connect</code> method to our <code>XMPPController</code>.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kd">func</span> <span class="nf">connect</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="o">!</span><span class="kc">self</span><span class="p">.</span><span class="n">xmppStream</span><span class="p">.</span><span class="n">isDisconnected</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span>
    <span class="p">}</span>

   <span class="k">try</span><span class="p">!</span> <span class="kc">self</span><span class="p">.</span><span class="n">xmppStream</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="n">withTimeout</span><span class="p">:</span> <span class="n">XMPPStreamTimeoutNone</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
<p>But how do we know we have successfully connected to the server?
As I said earlier, we need to check for a suitable delegate method from <code>XMPPStreamDelegate</code>.
After we connect to the server we need to authenticate so we are going to do the following:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kd">extension</span> <span class="nc">XMPPController</span><span class="p">:</span> <span class="n">XMPPStreamDelegate</span> <span class="p">{</span>

    <span class="kd">func</span> <span class="nf">xmppStreamDidConnect</span><span class="p">(</span><span class="kc">_</span> <span class="n">stream</span><span class="p">:</span> <span class="n">XMPPStream</span><span class="p">!)</span> <span class="p">{</span>
        <span class="bp">print</span><span class="p">(</span><span class="s">&quot;Stream: Connected&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">!</span> <span class="n">stream</span><span class="p">.</span><span class="n">authenticate</span><span class="p">(</span><span class="n">withPassword</span><span class="p">:</span> <span class="kc">self</span><span class="p">.</span><span class="n">password</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">xmppStreamDidAuthenticate</span><span class="p">(</span><span class="kc">_</span> <span class="n">sender</span><span class="p">:</span> <span class="n">XMPPStream</span><span class="p">!)</span> <span class="p">{</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">xmppStream</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">XMPPPresence</span><span class="p">())</span>
        <span class="bp">print</span><span class="p">(</span><span class="s">&quot;Stream: Authenticated&quot;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
<p>We need to test this.
Let’s just create an instance of <code>XMPPController</code> in the <code>AppDelegate</code> to test how it works:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">try</span><span class="p">!</span> <span class="kc">self</span><span class="p">.</span><span class="n">xmppController</span> <span class="p">=</span> <span class="n">XMPPController</span><span class="p">(</span><span class="n">hostName</span><span class="p">:</span> <span class="s">&quot;host.com&quot;</span><span class="p">,</span>
                                     <span class="n">userJIDString</span><span class="p">:</span> <span class="s">&quot;user@host.com&quot;</span><span class="p">,</span>
                                          <span class="n">password</span><span class="p">:</span> <span class="s">&quot;password&quot;</span><span class="p">)</span>
<span class="kc">self</span><span class="p">.</span><span class="n">xmppController</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<p>If everything goes fine we should see two messages in the logs but of course that’s not happening,
we missed something.
We never told to our <code>xmppStream</code> who was the delegate object!
We need to add the following line after the <code>super.init()</code></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kc">self</span><span class="p">.</span><span class="n">xmppStream</span><span class="p">.</span><span class="n">addDelegate</span><span class="p">(</span><span class="kc">self</span><span class="p">,</span> <span class="n">delegateQueue</span><span class="p">:</span> <span class="n">DispatchQueue</span><span class="p">.</span><span class="n">main</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<p>If we run the app again:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">Stream</span><span class="p">:</span> <span class="n">Connected</span>
<span class="n">Stream</span><span class="p">:</span> <span class="n">Authenticated</span>
</code></pre></div>
</td></tr></table>
<p>Success! We have our own <code>XMPPController</code> with a fully functional and authenticated stream!</p>
<p>Something that may catch your attention is how we are setting our delegate, we are not doing:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kc">self</span><span class="p">.</span><span class="n">xmppStream</span><span class="p">.</span><span class="n">delegate</span> <span class="p">=</span> <span class="kc">self</span>
</code></pre></div>
</td></tr></table>
<p>Why not?
Because we can “broadcast” the events to multiple delegates,
we can have 10 different objects implementing those methods.
Also we can tell what’s the thread where we want to receive that call,
in the previous example we want it in the main thread.</p>
<h2 id="getting-a-log-in">Getting a Log In</h2>
<p>Our app is super ugly, let’s put on some makeup!
We have nothing but an <code>XMPPController</code> and a hardcoded call in the <code>AppDelegate</code>.
I’m going to create a <code>ViewController</code> that is going to be presented modally as soon as the app starts,
that <code>ViewController</code> will have the neccesary fields/info to log in to the server.</p>
<p>I’m going to create a <code>LogInViewControllerDelegate</code> that is going to tell to our <code>ViewController</code>
that the <code>Log in</code> button was pressed and that’s it.
In that delegate implementation we are going to create our <code>XMPPController</code>, add the <code>ViewControlleras</code> delegate of the <code>XMPPStream</code> and connect!</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kd">extension</span> <span class="nc">ViewController</span><span class="p">:</span> <span class="n">LogInViewControllerDelegate</span> <span class="p">{</span>

    <span class="kd">func</span> <span class="nf">didTouchLogIn</span><span class="p">(</span><span class="n">sender</span><span class="p">:</span> <span class="n">LogInViewController</span><span class="p">,</span> <span class="n">userJID</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="n">userPassword</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="n">server</span><span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">logInViewController</span> <span class="p">=</span> <span class="n">sender</span>

        <span class="k">do</span> <span class="p">{</span>
            <span class="k">try</span> <span class="kc">self</span><span class="p">.</span><span class="n">xmppController</span> <span class="p">=</span> <span class="n">XMPPController</span><span class="p">(</span><span class="n">hostName</span><span class="p">:</span> <span class="n">server</span><span class="p">,</span>
                                                     <span class="n">userJIDString</span><span class="p">:</span> <span class="n">userJID</span><span class="p">,</span>
                                                     <span class="n">password</span><span class="p">:</span> <span class="n">userPassword</span><span class="p">)</span>
            <span class="kc">self</span><span class="p">.</span><span class="n">xmppController</span><span class="p">.</span><span class="n">xmppStream</span><span class="p">.</span><span class="n">addDelegate</span><span class="p">(</span><span class="kc">self</span><span class="p">,</span> <span class="n">delegateQueue</span><span class="p">:</span> <span class="n">DispatchQueue</span><span class="p">.</span><span class="n">main</span><span class="p">)</span>
            <span class="kc">self</span><span class="p">.</span><span class="n">xmppController</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
            <span class="n">sender</span><span class="p">.</span><span class="n">showErrorMessage</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="s">&quot;Something went wrong&quot;</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
<p>Why are we adding <code>ViewController</code> as a delegate of <code>XMPPStream</code> if our <code>XMPPController</code> alreay has that delegate implemented?
Because we need to know if this connection and authentication was successfull or notin our <code>ViewController</code>
so we are able to dismiss the <code>LogInViewController</code> or show an error message if something failed.
This is why being able to add multiple delegates is so useful.</p>
<p>So as I said I’m going to make <code>ViewController</code> to comform to the <code>XMPPStreamDelegate</code>:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kd">extension</span> <span class="nc">ViewController</span><span class="p">:</span> <span class="n">XMPPStreamDelegate</span> <span class="p">{</span>

    <span class="kd">func</span> <span class="nf">xmppStreamDidAuthenticate</span><span class="p">(</span><span class="kc">_</span> <span class="n">sender</span><span class="p">:</span> <span class="n">XMPPStream</span><span class="p">!)</span> <span class="p">{</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">logInViewController</span><span class="p">?.</span><span class="n">dismiss</span><span class="p">(</span><span class="n">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="n">completion</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">xmppStream</span><span class="p">(</span><span class="kc">_</span> <span class="n">sender</span><span class="p">:</span> <span class="n">XMPPStream</span><span class="p">!,</span> <span class="n">didNotAuthenticate</span> <span class="n">error</span><span class="p">:</span> <span class="n">DDXMLElement</span><span class="p">!)</span> <span class="p">{</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">logInViewController</span><span class="p">?.</span><span class="n">showErrorMessage</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="s">&quot;Wrong password or username&quot;</span><span class="p">)</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div>
</td></tr></table>
<p>And that’s it! Our app can log in to our server as I’m showing here:</p>
<p><img alt="App connecting and authenticating" src="../content_login.gif" /></p>
<h2 id="logging">Logging!</h2>
<p>We’ve been talking a lot about XMPP, stanzas and streams… but is there a way I can see the stream?
Yes SR! XMPPFramework got us covered!</p>
<p>XMPPFramework ships with <a href="https://github.com/CocoaLumberjack/CocoaLumberjack">CocoaLumberJack</a>,
a pretty well known logging framework.
We just need to configure it, set the logging level we want and that’s it.
Logs are going to start showing up!</p>
<h3 id="configuring-cocoalumberjack">Configuring CocoaLumberjack</h3>
<p>This is a really simple task,
you just need to add to your <code>func application(application: UIApplication, didFinishLaunchingWithOptions ...</code> method the following line (remember to <code>import CocoaLumberjack</code>):</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">DDLog</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">DDTTYLogger</span><span class="p">.</span><span class="n">sharedInstance</span><span class="p">(),</span> <span class="n">with</span><span class="p">:</span> <span class="n">DDLogLevel</span><span class="p">.</span><span class="n">all</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<p>I’m not going to paste here all the connection process log
because it makes no sense to try to understand what’s going on at this stage of our learning.
But I think showing what some stanzas look like is a good idea.
To do this I’m going to be sending messages from <a href="https://adium.im/">Adium</a>.</p>
<p>I’m going to send this <code>&lt;message/&gt;</code>:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nt">&lt;message</span> <span class="na">to=</span><span class="s">&quot;test.user@erlang-solutions.com&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;body&gt;</span>This is a message sent from Adium!<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/message&gt;</span>
</code></pre></div>
</td></tr></table>
<p>Let’s see how it looks like when it reaches our app:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nt">&lt;message</span> <span class="na">xmlns=</span><span class="s">&quot;jabber:client&quot;</span> <span class="na">from=</span><span class="s">&quot;iamadium@erlang-solutions.com/MacBook-Air&quot;</span> <span class="na">to=</span><span class="s">&quot;test.user@erlang-solutions.com&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;body&gt;</span>This is a message sent from Adium!<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/message&gt;</span>
</code></pre></div>
</td></tr></table>
<p>Let’s send a <code>&lt;presence/&gt;</code> from Adium:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nt">&lt;presence&gt;</span>
    <span class="nt">&lt;status&gt;</span>On vacation<span class="nt">&lt;/status&gt;</span>
<span class="nt">&lt;/presence&gt;</span>
</code></pre></div>
</td></tr></table>
<p>We are receiving:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nt">&lt;presence</span> <span class="na">xmlns=</span><span class="s">&quot;jabber:client&quot;</span> <span class="na">from=</span><span class="s">&quot;iamadium@erlang-solutions.com/MacBook-Air&quot;</span> <span class="na">to=</span><span class="s">&quot;test.user@erlang-solutions.com&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;status&gt;</span>On vacation<span class="nt">&lt;/status&gt;</span>
<span class="nt">&lt;/presence&gt;</span>
</code></pre></div>
</td></tr></table>
<p>No doubts at all right? We send something and we receive it on the other end! That’s it!</p>
<h2 id="test-time">Test Time!</h2>
<p>I want to be sure that you are understanding and following everything
and not just copy and pasting from a tutorial (as I usually do 🙊).
So if you are able to answer these questions you are on a good track!</p>
<ul>
<li>Why am I sending a presence after successfully authenticating? What happens if I don’t send it?</li>
<li>What happens if I write a wrong server URL in the Log In form? How do I fix this problem if there is a problem…</li>
<li>How do I detect if suddenly the stream is disconnected from the server? (maybe a network outage?)</li>
<li>How do I detect if the user/password was wrong?</li>
</ul>
<p>If you need help leave a message!</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../ICE_tutorial/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                How to Set up MongooseICE
              </div>
            </div>
          </a>
        
        
          <a href="../Jingle-SIP-setup/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                How to Set up Jingle/SIP
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.18f0862e.min.js"></script>
      <script src="../../assets/javascripts/bundle.994580cf.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.9c0e82ba.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="../../js/version-select.js"></script>
      
    
  </body>
</html>