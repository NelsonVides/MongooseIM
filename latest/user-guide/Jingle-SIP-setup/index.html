
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../../favicon.ico">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.1.6">
    
    
      
        <title>How to Set up Jingle/SIP - MongooseIM</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6910b76c.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.196e0c26.min.css">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../custom.css">
    
      <link rel="stylesheet" href="../../css/version-select.css">
    
    
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#jinglesip-setup-proof-of-concept" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="MongooseIM" class="md-header-nav__button md-logo" aria-label="MongooseIM">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            MongooseIM
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              How to Set up Jingle/SIP
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="MongooseIM" class="md-nav__button md-logo" aria-label="MongooseIM">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    MongooseIM
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" >
    <label class="md-nav__link" for="nav-2">
      User guide
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="User guide" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        User guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../ABCs-of-MongooseIM/" class="md-nav__link">
      ABCs of MongooseIM
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../MongooseIM-High-level-Architecture/" class="md-nav__link">
      High-level Architecture
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Features-and-supported-standards/" class="md-nav__link">
      Features and supported standards
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Getting-started/" class="md-nav__link">
      Getting started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../release_config/" class="md-nav__link">
      Release/Installation configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Bootstrap-Scripts/" class="md-nav__link">
      Bootstrap scripts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../client-certificate/" class="md-nav__link">
      Client certificate authentication
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    <label class="md-nav__link" for="nav-3">
      Tutorials
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Tutorials" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../How-to-build/" class="md-nav__link">
      How to Build MongooseIM from source code
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../push-notifications/Push-notifications/" class="md-nav__link">
      How to Set up Push Notifications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../push-notifications/Push-notifications-client-side/" class="md-nav__link">
      How to Set up Push Notifications on the client side
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../push-notifications/MongoosePush-setup/" class="md-nav__link">
      How to Set up MongoosePush
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ICE_tutorial/" class="md-nav__link">
      How to Set up MongooseICE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../iOS_tutorial/" class="md-nav__link">
      How to Build an iOS messaging app
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        How to Set up Jingle/SIP
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      How to Set up Jingle/SIP
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-routr" class="md-nav__link">
    Configuring Routr
  </a>
  
    <nav class="md-nav" aria-label="Configuring Routr">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-side-note" class="md-nav__link">
    A side note
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-etchosts" class="md-nav__link">
    Configuring /etc/hosts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-mongooseim" class="md-nav__link">
    Configuring MongooseIM
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-users-to-jitsi" class="md-nav__link">
    Adding users to Jitsi
  </a>
  
    <nav class="md-nav" aria-label="Adding users to Jitsi">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adding-a-sip-user" class="md-nav__link">
    Adding a SIP user
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-an-xmpp-user" class="md-nav__link">
    Adding an XMPP user
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-user-to-otalk" class="md-nav__link">
    Adding user to Otalk
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#making-a-call" class="md-nav__link">
    Making a call
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" >
    <label class="md-nav__link" for="nav-4">
      Migration Guide
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Migration Guide" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        Migration Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../migrations/3.1.1_3.2.0/" class="md-nav__link">
      3.1.1 to 3.2.0
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../migrations/3.3.0_3.4.0/" class="md-nav__link">
      3.3.0 to 3.4.0
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../migrations/3.5.0_3.6.0/" class="md-nav__link">
      3.5.0 to 3.6.0
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../migrations/3.6.0_3.7.0/" class="md-nav__link">
      3.6.0 to 3.7.0
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../migrations/3.7.0_4.0.0/" class="md-nav__link">
      3.7.0 to 4.0.0
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../migrations/4.0.0_4.0.1/" class="md-nav__link">
      4.0.0 to 4.0.1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../migrations/jid-from-mam-muc-script/" class="md-nav__link">
      MAM MUC migration helper
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" >
    <label class="md-nav__link" for="nav-5">
      Platform
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Platform" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon"></span>
        Platform
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Contributions/" class="md-nav__link">
      Contributions to ecosystem
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Differentiators/" class="md-nav__link">
      Differentiators
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../History/" class="md-nav__link">
      History
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" >
    <label class="md-nav__link" for="nav-6">
      Configuration
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Configuration" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon"></span>
        Configuration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Advanced-configuration/" class="md-nav__link">
      Configuration files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../advanced-configuration/general/" class="md-nav__link">
      Options: General
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../advanced-configuration/listen/" class="md-nav__link">
      Options: Listen
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../advanced-configuration/auth/" class="md-nav__link">
      Options: Auth
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../advanced-configuration/outgoing-connections/" class="md-nav__link">
      Options: Outgoing connections
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../advanced-configuration/Services/" class="md-nav__link">
      Options: Services
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../advanced-configuration/Modules/" class="md-nav__link">
      Options: Extension Modules
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../advanced-configuration/shaper/" class="md-nav__link">
      Options: Shaper
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../advanced-configuration/acl/" class="md-nav__link">
      Options: Acl
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../advanced-configuration/access/" class="md-nav__link">
      Options: Access
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../advanced-configuration/s2s/" class="md-nav__link">
      Options: S2S
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../advanced-configuration/host_config/" class="md-nav__link">
      Options: Host config
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../advanced-configuration/release-options/" class="md-nav__link">
      Release options
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../advanced-configuration/Erlang-cookie-security/" class="md-nav__link">
      Erlang Cookie Security
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../advanced-configuration/TLS-hardening/" class="md-nav__link">
      TLS hardening
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../advanced-configuration/database-backends-configuration/" class="md-nav__link">
      Database backends configuration
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" >
    <label class="md-nav__link" for="nav-7">
      Authentication methods
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Authentication methods" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon"></span>
        Authentication methods
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../authentication-methods/rdbms/" class="md-nav__link">
      RDBMS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../authentication-methods/external/" class="md-nav__link">
      External
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../authentication-methods/anonymous/" class="md-nav__link">
      Anonymous
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../authentication-methods/ldap/" class="md-nav__link">
      LDAP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../authentication-methods/jwt/" class="md-nav__link">
      JWT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../authentication-methods/riak/" class="md-nav__link">
      Riak
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../authentication-methods/http/" class="md-nav__link">
      HTTP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../authentication-methods/pki/" class="md-nav__link">
      PKI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../authentication-methods/dummy/" class="md-nav__link">
      Dummy
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8" >
    <label class="md-nav__link" for="nav-8">
      MongooseIM open XMPP extensions
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="MongooseIM open XMPP extensions" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        <span class="md-nav__icon md-icon"></span>
        MongooseIM open XMPP extensions
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../open-extensions/muc_light/" class="md-nav__link">
      MUC light
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../open-extensions/token-reconnection/" class="md-nav__link">
      Token-based reconnection
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9" >
    <label class="md-nav__link" for="nav-9">
      REST API
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="REST API" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        <span class="md-nav__icon md-icon"></span>
        REST API
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../rest-api/Client-frontend/" class="md-nav__link">
      Client/frontend
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../rest-api/Metrics-backend/" class="md-nav__link">
      Metrics backend
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../rest-api/Administration-backend/" class="md-nav__link">
      Administration backend
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10" >
    <label class="md-nav__link" for="nav-10">
      Operation and maintenance
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Operation and maintenance" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        <span class="md-nav__icon md-icon"></span>
        Operation and maintenance
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../operation-and-maintenance/gdpr-considerations/" class="md-nav__link">
      GDPR considerations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../operation-and-maintenance/Cluster-management-considerations/" class="md-nav__link">
      Cluster management considerations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../operation-and-maintenance/Cluster-configuration-and-node-management/" class="md-nav__link">
      Cluster configuration and node management
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../operation-and-maintenance/Logging-%26-monitoring/" class="md-nav__link">
      Logging & monitoring
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../operation-and-maintenance/Logging/" class="md-nav__link">
      Logging configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../operation-and-maintenance/Humio/" class="md-nav__link">
      Logging with Humio
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../operation-and-maintenance/Logging-fields/" class="md-nav__link">
      Logging fields
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../operation-and-maintenance/Reloading-configuration-on-a-running-system/" class="md-nav__link">
      Reloading configuration on a running system
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../operation-and-maintenance/MongooseIM-metrics/" class="md-nav__link">
      Metrics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../operation-and-maintenance/System-Metrics-Privacy-Policy/" class="md-nav__link">
      System Metrics Privacy Policy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../operation-and-maintenance/tls-distribution/" class="md-nav__link">
      Distribution over TLS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../operation-and-maintenance/known-issues/" class="md-nav__link">
      Known issues
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11" >
    <label class="md-nav__link" for="nav-11">
      Developer's guide
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Developer's guide" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        <span class="md-nav__icon md-icon"></span>
        Developer's guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../developers-guide/Testing-MongooseIM/" class="md-nav__link">
      Testing MongooseIM
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developers-guide/logging/" class="md-nav__link">
      Logging
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developers-guide/Hooks-and-handlers/" class="md-nav__link">
      Hooks and Handlers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developers-guide/hooks_description/" class="md-nav__link">
      Hooks description
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developers-guide/Stanza-routing/" class="md-nav__link">
      Stanza routing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developers-guide/accumulators/" class="md-nav__link">
      Accumulators
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developers-guide/flat_options/" class="md-nav__link">
      Flat options format
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developers-guide/Moving-to-single-app-project-structure/" class="md-nav__link">
      Moving to single app project structure
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developers-guide/mod_amp_developers_guide/" class="md-nav__link">
      mod_amp development
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developers-guide/mod_muc_light_developers_guide/" class="md-nav__link">
      mod_muc_light developers doc
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developers-guide/SCRAM-serialization/" class="md-nav__link">
      SCRAM serialization format
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developers-guide/xep_tool/" class="md-nav__link">
      xep-tool usage
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developers-guide/OpenSSL-and-FIPS/" class="md-nav__link">
      FIPS mode
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developers-guide/Basic-iq-handler/" class="md-nav__link">
      Basic IQ Handler
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developers-guide/mongoose_wpool/" class="md-nav__link">
      mongoose_wpool
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-12" type="checkbox" id="nav-12" >
    <label class="md-nav__link" for="nav-12">
      Module index
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Module index" data-md-level="1">
      <label class="md-nav__title" for="nav-12">
        <span class="md-nav__icon md-icon"></span>
        Module index
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_adhoc/" class="md-nav__link">
      mod_adhoc
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_amp/" class="md-nav__link">
      mod_amp
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_auth_token/" class="md-nav__link">
      mod_auth_token
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_blocking/" class="md-nav__link">
      mod_blocking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_bosh/" class="md-nav__link">
      mod_bosh
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_caps/" class="md-nav__link">
      mod_caps
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_carboncopy/" class="md-nav__link">
      mod_carboncopy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_commands/" class="md-nav__link">
      mod_commands
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_csi/" class="md-nav__link">
      mod_csi
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_disco/" class="md-nav__link">
      mod_disco
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-12-11" type="checkbox" id="nav-12-11" >
    <label class="md-nav__link" for="nav-12-11">
      mod_event_pusher
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="mod_event_pusher" data-md-level="2">
      <label class="md-nav__title" for="nav-12-11">
        <span class="md-nav__icon md-icon"></span>
        mod_event_pusher
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_event_pusher/" class="md-nav__link">
      mod_event_pusher
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_event_pusher_http/" class="md-nav__link">
      HTTP backend
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_event_pusher_push/" class="md-nav__link">
      Push backend
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_event_pusher_sns/" class="md-nav__link">
      SNS backend
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_event_pusher_rabbit/" class="md-nav__link">
      RabbitMQ backend
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_extdisco/" class="md-nav__link">
      mod_extdisco
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_global_distrib/" class="md-nav__link">
      mod_global_distrib
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_http_upload/" class="md-nav__link">
      mod_http_upload
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_inbox/" class="md-nav__link">
      mod_inbox
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_jingle_sip/" class="md-nav__link">
      mod_jingle_sip
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_keystore/" class="md-nav__link">
      mod_keystore
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_last/" class="md-nav__link">
      mod_last
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_mam/" class="md-nav__link">
      mod_mam
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_muc/" class="md-nav__link">
      mod_muc
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_muc_commands/" class="md-nav__link">
      mod_muc_commands
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_muc_log/" class="md-nav__link">
      mod_muc_log
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_muc_light/" class="md-nav__link">
      mod_muc_light
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_muc_light_commands/" class="md-nav__link">
      mod_muc_light_commands
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_offline/" class="md-nav__link">
      mod_offline
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_offline_stub/" class="md-nav__link">
      mod_offline_stub
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_ping/" class="md-nav__link">
      mod_ping
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_privacy/" class="md-nav__link">
      mod_privacy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_private/" class="md-nav__link">
      mod_private
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_pubsub/" class="md-nav__link">
      mod_pubsub
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_push_service_mongoosepush/" class="md-nav__link">
      mod_push_service_mongoosepush
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_register/" class="md-nav__link">
      mod_register
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_roster/" class="md-nav__link">
      mod_roster
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_shared_roster_ldap/" class="md-nav__link">
      mod_shared_roster_ldap
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_sic/" class="md-nav__link">
      mod_sic
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_stream_management/" class="md-nav__link">
      mod_stream_management
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_time/" class="md-nav__link">
      mod_time
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_vcard/" class="md-nav__link">
      mod_vcard
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/mod_version/" class="md-nav__link">
      mod_version
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-routr" class="md-nav__link">
    Configuring Routr
  </a>
  
    <nav class="md-nav" aria-label="Configuring Routr">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-side-note" class="md-nav__link">
    A side note
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-etchosts" class="md-nav__link">
    Configuring /etc/hosts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-mongooseim" class="md-nav__link">
    Configuring MongooseIM
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-users-to-jitsi" class="md-nav__link">
    Adding users to Jitsi
  </a>
  
    <nav class="md-nav" aria-label="Adding users to Jitsi">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adding-a-sip-user" class="md-nav__link">
    Adding a SIP user
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-an-xmpp-user" class="md-nav__link">
    Adding an XMPP user
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-user-to-otalk" class="md-nav__link">
    Adding user to Otalk
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#making-a-call" class="md-nav__link">
    Making a call
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="jinglesip-setup-proof-of-concept">Jingle/SIP setup proof of concept</h1>
<p>This tutorial will show you how to configure MongooseIM, Routr (a SIP server) and client applications to demonstrate how the Jingle/SIP integration works.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>We are going to use the following open source software:</p>
<ul>
<li>
<p>MongooseIM - <a href="https://github.com/esl/MongooseIM">https://github.com/esl/MongooseIM</a></p>
<ul>
<li>see <a href="../How-to-build/">How-to-build</a> for details on building.
  It's important to remember to run the configuration script with <code>with-jingle-sip</code> flag set:
  <code>tools/configure with-jingle-sip</code>.
  Without this, third party dependencies required by the Jingle/SIP translator will not be included in the release.</li>
</ul>
</li>
<li>
<p>Routr (SIP server) - <a href="https://routr.io">https://routr.io</a></p>
<ul>
<li>I recommend downloading binaries for your system from <a href="https://routr.io/docs/introduction/installation/#custom">official source</a>.</li>
</ul>
</li>
<li>Jitsi (XMPP and SIP client application) - <a href="https://desktop.jitsi.org/">https://desktop.jitsi.org</a></li>
<li>Otalk - web based XMPP client - <a href="https://github.com/otalk/otalk-im-client">https://github.com/otalk/otalk-im-client</a><ul>
<li>Folow the instructions on <a href="https://github.com/otalk/otalk-im-client#installing">otalk-im-client#installing</a> to run it</li>
</ul>
</li>
</ul>
<p>We will use 2 users <code>xmpp.user@xmpp.example</code> and <code>sip.user@sip.example</code>.</p>
<h2 id="configuring-routr">Configuring Routr</h2>
<p>First the domain <code>sip.example</code> needs to be added to domains served by Routr.
To do it, paste the following content to config/domains.yml in the directory where Routr was:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span> <span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1beta1</span>
  <span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Domain</span>
  <span class="nt">metadata</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SIP domain</span>
  <span class="nt">spec</span><span class="p">:</span>
    <span class="nt">context</span><span class="p">:</span>
      <span class="nt">domainUri</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sip.example</span>
</code></pre></div>
</td></tr></table>
<p>Then the <code>sip.user@sip.example</code> needs to be added to <code>config/agents.yml</code> like below:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span> <span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1beta1</span>
  <span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Agent</span>
  <span class="nt">metadata</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SIP User</span>
  <span class="nt">spec</span><span class="p">:</span>
    <span class="nt">credentials</span><span class="p">:</span>
      <span class="nt">username</span><span class="p">:</span> <span class="s">&#39;sip.user&#39;</span>
      <span class="nt">secret</span><span class="p">:</span> <span class="s">&#39;1234&#39;</span>
    <span class="nt">domains</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">sip.example</span><span class="p p-Indicator">]</span>
</code></pre></div>
</td></tr></table>
<p>Now Routr can be started with</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>./routr
</code></pre></div>
</td></tr></table>
<p>If all goes well we'll see the following output:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>[INFO ] Starting Routr
[INFO ] Listening  on 10.152.1.27:5060 [udp]
[INFO ] Listening  on 10.152.1.27:5060 [tcp]
[INFO ] Starting Location service
[INFO ] Starting Registry service
[INFO ] Starting Restful service (port: 4567, apiPath: &#39;/api/v1beta1&#39;)
</code></pre></div>
</td></tr></table>
<p>It is important to remember the IP address as it'll be used in next point.</p>
<h3 id="a-side-note">A side note</h3>
<p>In Routr's logs you may see messages like</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>[WARN ] Unable to register with Gateway -&gt; sip.provider.net. (Verify your network status)
</code></pre></div>
</td></tr></table>
<p>or</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>[ERROR] java.lang.RuntimeException: javax.sip.header.TooManyHopsException: has already reached 0!
</code></pre></div>
</td></tr></table>
<p>They can be ignored for the purpose of the tutorial.</p>
<h2 id="configuring-etchosts">Configuring /etc/hosts</h2>
<p>In my case the IP reported by Routr was <code>10.152.1.27</code>.
Now we need to use this to update <code>/etc/hosts</code> file like below:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>10.152.1.27     sip.example xmpp.example
</code></pre></div>
</td></tr></table>
<h2 id="configuring-mongooseim">Configuring MongooseIM</h2>
<p>At this point I assume that MongooseIM was built with <code>make rel</code>, that it is running and the current working directory is <code>_build/prod/rel/mongooseim</code>.
Similar to Routr, MongooseIM also needs to know which hosts to server.
Please replace the default host defined in <code>etc/mongooseim.toml</code>; the line:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">[general]</span>
  <span class="n">hosts</span> <span class="o">=</span> <span class="k">[&quot;localhost&quot;]</span>
</code></pre></div>
</td></tr></table>
<p>should be changed to:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">[general]</span>
  <span class="n">hosts</span> <span class="o">=</span> <span class="k">[&quot;xmpp.example&quot;, &quot;sip.example&quot;]</span>
</code></pre></div>
</td></tr></table>
<p>Now we need to enable <code>mod_jingle_sip</code>, please add the following line in modules list (somewhere around line 740 in the same file)</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">[modules.mod_jingle_sip]</span>
  <span class="n">proxy_host</span> <span class="o">=</span> <span class="s">&quot;sip.example&quot;</span>
</code></pre></div>
</td></tr></table>
<p>More details on MongooseIM configuration you can find in <a href="../../Advanced-configuration/">Configuration</a>
and in <a href="../../advanced-configuration/Modules/">Modules configuration</a></p>
<p>Now we are registering both users in MongooseIM by calling the following commands:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>bin/mongooseimctl register_identified xmpp.user xmpp.example test_pass
bin/mongooseimctl register_identified sip.user sip.example test_pass
</code></pre></div>
</td></tr></table>
<p>Yes, we need to have the <code>sip.user@sip.example</code> registered in MongooseIM.
This is needed because a Jingle call can be initiated by a regular XMPP client only when the app knows the other user's full JID.
The easiest way to achieve that is to exchange presence information between these 2 users.
This can happen automatically if 2 xmpp users have each other in the roster.</p>
<p>The roster can be set by us with the following commands:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>bin/mongooseimctl add_rosteritem sip.user sip.example xmpp.user xmpp.example xmpp.user none both
bin/mongooseimctl add_rosteritem xmpp.user xmpp.example sip.user sip.example sip.user none both
</code></pre></div>
</td></tr></table>
<h2 id="adding-users-to-jitsi">Adding users to Jitsi</h2>
<p>Now the <code>sip.user@sip.example</code> has to be added to Jitsi app.
When the app is opened for the first time it will display a window to configure the user.
Later users can be configured from the <code>Preferences</code> page.</p>
<h3 id="adding-a-sip-user">Adding a SIP user</h3>
<p>In order to add a user who connects to the SIP server we need to choose the <code>SIP</code> protocol from the available <code>networks</code> in Jitsi.
In the <code>SIP id</code> field we put <code>sip.user@sip.example</code> and in the <code>Password</code> field we put <code>1234</code> as in the <code>agents.yml</code> file.
Now we need to switch to <code>Advanced</code> options and go to the <code>Connection</code> tab.
Here we need to unselect the <code>Configure proxy automatically</code> and put the IP of our <code>Routr</code> server, port number <code>5060</code> and <code>TCP</code> as the preferred transport.</p>
<p><img alt="SIP setup in Jitsi" src="../jingle-sip/jitsi-sip-config.png" /></p>
<h3 id="adding-an-xmpp-user">Adding an XMPP user</h3>
<p>Now we have to add <code>sip.user@sip.example</code> to Jitsi's XMPP network in order to connect this user to MongooseIM over XMPP.
It's very similar to adding a user to Jitsi's SIP network, the only difference is the password,
for the XMPP conection it's <code>test_pass</code> as set when registering the user in MongooseIM.
Here we also need to go to the <code>Advanced</code> window and the <code>Connection</code> tab in order to put the IP addres (the same as before) in the <code>Connect Server</code> field.
Remember to check the <code>Override server default options</code> box.</p>
<p>To connect <code>sip.user@sip.exmple</code> to MongooseIM over XMPP is to cheat Jingle a bit, so that the client app for user <code>sip.xmpp@xmpp.example</code> can start the Jingle call.
When Jitsi connects this user, it will likely display a warning about the server's certificate.
This is because by default MongooseIM is configured with a freshly generated, self-signed certificate.
We can click <code>Continue anyway</code> button in order to proceed.</p>
<h2 id="adding-user-to-otalk">Adding user to Otalk</h2>
<p>Please follow the instructions on <a href="https://github.com/otalk/otalk-im-client#installing">https://github.com/otalk/otalk-im-client#installing</a> in order to compile and run the app.
If all goes well, you should see the following message printed in the console:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>demo.stanza.io running at: http://localhost:8000
</code></pre></div>
</td></tr></table>
<p>This means that the app is hosted on <code>http://localhost:8000</code>.</p>
<blockquote>
<p>At this point I also recommend opening <a href="wss://localhost:5285/ws-xmpp">wss://localhost:5285/ws-xmpp</a> in the same browser.
This endpoint works correctly only for WebSocket connections but most probably you will be prompted about the certificate.
This is again due to the self-signed certificate.
We need to add an exception for this certificate in order to successfully connect from Otalk.</p>
</blockquote>
<p>Now let's open <a href="http://localhost:8000">http://localhost:8000</a> where the Otalk app is hosted.
In the <code>Log in</code> section put <code>xmpp.user@xmpp.example</code> in the <code>JID</code> field and <code>test_pass</code> in the <code>Password</code> filed.
The default WebSocket endpoint in the <code>WebSocket or BOSH URL</code> field needs to be changed to:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>wss://localhost:5285/ws-xmpp
</code></pre></div>
</td></tr></table>
<p>Mind the <code>wss</code> protocol, Otalk will not connect the user over WebSockets if for example <code>https</code> is put in the field.</p>
<p><img alt="Otalk login page" src="../jingle-sip/otalk-log-in.png" /></p>
<p>Now we can hit the <code>Go!</code> button and the <code>xmpp.user@xmpp.example</code> will connect to MongooseIM.</p>
<h2 id="making-a-call">Making a call</h2>
<p>On the left side we can see that the user already has <code>sip.user@sip.example</code> in the roster and there should be a green dot indicating that the user is online.
When we click on the contact, the <code>Call</code> button should appear allowing us to initiate the call.</p>
<p>In Jitsi, the following window should pop up:
<img alt="Jitsi call window" src="../jingle-sip/jitsi-call.png" /></p>
<p>Behind the scene the following SIP request was send from MongooseIM to Routr.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>INVITE sip:sip.user@sip.example:5060 SIP/2.0
Via: SIP/2.0/TCP localhost:5600;rport;branch=z9hG4bK1HMB3o-3mbahM
From: xmpp.user &lt;sip:xmpp.user@xmpp.example&gt;;tag=aVEBue
To: sip.user &lt;sip:sip.user@sip.example&gt;
Call-ID: ae602f16-d57d-4452-b83e-36e54bb6d325
CSeq: 159913767 INVITE
Max-Forwards: 70
Content-Length: 2243
Contact: &lt;sip:xmpp.user@localhost:5600;ob;transport=tcp&gt;;+sip.instance=&quot;&lt;urn:uuid:f45950f1-70cd-229d-6c2b-8c85903ce14e&gt;&quot;
Content-Type: application/sdp
Supported: outbound,100rel,path
Allow: PRACK,INVITE,ACK,CANCEL,BYE,OPTIONS,INFO,UPDATE,SUBSCRIBE,NOTIFY,REFER,MESSAGE

v=0
o=- 1531401304 1531401304 IN IP4 127.0.0.1
s=nksip
c=IN IP4 127.0.0.1
t=0 0
a=group:BUNDLE sdparta_0 sdparta_1
m=audio 1436 UDP/TLS/RTP/SAVPF 109 9 0 8 101
a=sendrecv
a=mid:sdparta_0
a=setup:actpass
a=fingerprint:sha-256 44:84:41:8F:B7:A3:B7:37:BA:00:26:5E:B1:D6:AB:D0:56:56:CF:53:F2:05:DB:99:DE:D4:1C:63:A4:68:58:EA
a=ice-pwd:49ad0f02b4f5181c9af3c4006575e071
a=ice-ufrag:a3cc96e2
a=rtcp-mux
a=extmap:3 urn:ietf:params:rtp-hdrext:sdes:mid
a=extmap:2/recvonly urn:ietf:params:rtp-hdrext:csrc-audio-level
a=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level
a=rtpmap:109 opus/48000/2
a=fmtp:109 useinbandfec=1;stereo=1;maxplaybackrate=48000
a=rtpmap:9 G722/8000
a=rtpmap:0 PCMU/8000
a=rtpmap:8 PCMA/8000
a=rtpmap:101 telephone-event/8000
a=fmtp:101 0-15
a=ssrc:1698222108 cname:{ce7fa171-069e-db4f-ba41-cfa4455c1033}
a=ssrc:1698222108 msid:{788b64bb-c4fc-b644-89b0-89f69c78f8b0} {2ba61f91-abca-3e48-84b7-85b57e8fdfb5}
m=video 1031 UDP/TLS/RTP/SAVPF 120 121 126 97
a=sendrecv
a=mid:sdparta_1
a=setup:actpass
a=fingerprint:sha-256 44:84:41:8F:B7:A3:B7:37:BA:00:26:5E:B1:D6:AB:D0:56:56:CF:53:F2:05:DB:99:DE:D4:1C:63:A4:68:58:EA
a=ice-pwd:49ad0f02b4f5181c9af3c4006575e071
a=ice-ufrag:a3cc96e2
a=rtcp-mux
a=extmap:5 urn:ietf:params:rtp-hdrext:toffset
a=extmap:4 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time
a=extmap:3 urn:ietf:params:rtp-hdrext:sdes:mid
a=rtpmap:120 VP8/90000
a=fmtp:120 max-fr=60;max-fs=12288
a=rtcp-fb:120 goog-remb
a=rtcp-fb:120 ccm fir
a=rtcp-fb:120 nack pli
a=rtcp-fb:120 nack
a=rtpmap:121 VP9/90000
a=fmtp:121 max-fr=60;max-fs=12288
a=rtcp-fb:121 goog-remb
a=rtcp-fb:121 ccm fir
a=rtcp-fb:121 nack pli
a=rtcp-fb:121 nack
a=rtpmap:126 H264/90000
a=fmtp:126 packetization-mode=1;level-asymmetry-allowed=1;profile-level-id=42e01f
a=rtcp-fb:126 goog-remb
a=rtcp-fb:126 ccm fir
a=rtcp-fb:126 nack pli
a=rtcp-fb:126 nack
a=rtpmap:97 H264/90000
a=fmtp:97 level-asymmetry-allowed=1;profile-level-id=42e01f
a=rtcp-fb:97 goog-remb
a=rtcp-fb:97 ccm fir
a=rtcp-fb:97 nack pli
a=rtcp-fb:97 nack
a=ssrc:823938224 cname:{ce7fa171-069e-db4f-ba41-cfa4455c1033}
a=ssrc:823938224 msid:{788b64bb-c4fc-b644-89b0-89f69c78f8b0} {a7f87c8d-6002-fd4c-badb-13383c759e48}
</code></pre></div>
</td></tr></table>
<p>And Routr sent the <code>Ringing</code> response code to MongooseIM as soon as the Jitsi app displayed the incoming call window:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>SIP/2.0 180 Ringing
CSeq: 159913767 INVITE
Call-ID: ae602f16-d57d-4452-b83e-36e54bb6d325
From: &quot;xmpp.user&quot; &lt;sip:xmpp.user@xmpp.example&gt;;tag=aVEBue
To: &quot;sip.user&quot; &lt;sip:sip.user@sip.example&gt;;tag=9b4c72a3
Via: SIP/2.0/TCP localhost:5600;rport=54071;branch=z9hG4bK1HMB3o-3mbahM;received=10.152.1.27
Contact: &quot;sip.user&quot; &lt;sip:sip.user@10.152.1.27:53697;transport=tcp;registering_acc=sip_example&gt;
User-Agent: Jitsi2.10.5550Mac OS X
Content-Length: 0
</code></pre></div>
</td></tr></table>
<h2 id="summary">Summary</h2>
<p>The example above showcases how you can use Jingle/SIP switch with the available open source software.
Sonetel, who are this feature's sponsor, operate on a slightly different use case and utilize more of the functionality with their proprietary software.
Current implementation makes following assumptions:</p>
<ul>
<li>The peer-to-peer stream is always encrypted.
  This means that MongooseIM expects element <code>&lt;fingerprint&gt;</code> as described in <a href="https://xmpp.org/extensions/xep-0320.html">XEP-0320: Use of DTLS-SRTP in Jingle Sessions</a> to be in the content description.
  Not every open source XMPP client supporting Jingle supports this encryption.</li>
<li>MongooseIM expects that the <code>200 OK</code> response contains at least one ICE candidate to set the peer-to-peer connection up.</li>
</ul>
<p>This makes the current implementation a bit limited, but on the other hand the basic integration between XMPP and SIP world is already there.
Based on the current state it can be improved and extended if needed.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../iOS_tutorial/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                How to Build an iOS messaging app
              </div>
            </div>
          </a>
        
        
          <a href="../../migrations/3.1.1_3.2.0/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                3.1.1 to 3.2.0
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.fd16492e.min.js"></script>
      <script src="../../assets/javascripts/bundle.7836ba4d.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="../../js/version-select.js"></script>
      
    
  </body>
</html>