
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../../favicon.ico">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.4">
    
    
      
        <title>mod_auth_token - MongooseIM</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.15aa0b43.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.75751829.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../css/custom.css">
    
      <link rel="stylesheet" href="../../css/version-select.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#module-description" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="MongooseIM" class="md-header-nav__button md-logo" aria-label="MongooseIM">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            MongooseIM
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              mod_auth_token
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="MongooseIM" class="md-nav__button md-logo" aria-label="MongooseIM">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    MongooseIM
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      



  <li class="md-nav__item">
    <a href="../.." class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" >
    
    <label class="md-nav__link" for="nav-2">
      User guide
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="User guide" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        User guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../user-guide/ABCs-of-MongooseIM/" class="md-nav__link">
      ABCs of MongooseIM
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../user-guide/MongooseIM-High-level-Architecture/" class="md-nav__link">
      High-level Architecture
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../user-guide/Features-and-supported-standards/" class="md-nav__link">
      Features and supported standards
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../user-guide/Getting-started/" class="md-nav__link">
      Getting started
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../user-guide/release_config/" class="md-nav__link">
      Release/Installation configuration
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../user-guide/Bootstrap-Scripts/" class="md-nav__link">
      Bootstrap scripts
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../user-guide/client-certificate/" class="md-nav__link">
      Client certificate authentication
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" >
    
    <label class="md-nav__link" for="nav-3">
      Tutorials
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Tutorials" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../user-guide/How-to-build/" class="md-nav__link">
      How to Build MongooseIM from source code
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../user-guide/push-notifications/Push-notifications/" class="md-nav__link">
      How to Set up Push Notifications
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../user-guide/push-notifications/Push-notifications-client-side/" class="md-nav__link">
      How to Set up Push Notifications on the client side
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../user-guide/push-notifications/MongoosePush-setup/" class="md-nav__link">
      How to Set up MongoosePush
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../user-guide/ICE_tutorial/" class="md-nav__link">
      How to Set up MongooseICE
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../user-guide/iOS_tutorial/" class="md-nav__link">
      How to Build an iOS messaging app
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../user-guide/Jingle-SIP-setup/" class="md-nav__link">
      How to Set up Jingle/SIP
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" >
    
    <label class="md-nav__link" for="nav-4">
      Migration Guide
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Migration Guide" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        Migration Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../migrations/3.1.1_3.2.0/" class="md-nav__link">
      3.1.1 to 3.2.0
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../migrations/3.3.0_3.4.0/" class="md-nav__link">
      3.3.0 to 3.4.0
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../migrations/3.5.0_3.6.0/" class="md-nav__link">
      3.5.0 to 3.6.0
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../migrations/3.6.0_3.7.0/" class="md-nav__link">
      3.6.0 to 3.7.0
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../migrations/3.7.0_4.0.0/" class="md-nav__link">
      3.7.0 to 4.0.0
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../migrations/4.0.0_4.0.1/" class="md-nav__link">
      4.0.0 to 4.0.1
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../migrations/jid-from-mam-muc-script/" class="md-nav__link">
      MAM MUC migration helper
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" >
    
    <label class="md-nav__link" for="nav-5">
      Platform
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Platform" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon"></span>
        Platform
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../Contributions/" class="md-nav__link">
      Contributions to ecosystem
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../Differentiators/" class="md-nav__link">
      Differentiators
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../History/" class="md-nav__link">
      History
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" >
    
    <label class="md-nav__link" for="nav-6">
      Configuration
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Configuration" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon"></span>
        Configuration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../advanced-configuration/configuration-files/" class="md-nav__link">
      Configuration files
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../advanced-configuration/general/" class="md-nav__link">
      Options: General
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../advanced-configuration/listen/" class="md-nav__link">
      Options: Listen
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../advanced-configuration/auth/" class="md-nav__link">
      Options: Auth
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../advanced-configuration/outgoing-connections/" class="md-nav__link">
      Options: Outgoing connections
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../advanced-configuration/Services/" class="md-nav__link">
      Options: Services
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../advanced-configuration/Modules/" class="md-nav__link">
      Options: Extension Modules
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../advanced-configuration/shaper/" class="md-nav__link">
      Options: Shaper
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../advanced-configuration/acl/" class="md-nav__link">
      Options: Acl
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../advanced-configuration/access/" class="md-nav__link">
      Options: Access
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../advanced-configuration/s2s/" class="md-nav__link">
      Options: S2S
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../advanced-configuration/host_config/" class="md-nav__link">
      Options: Host config
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../advanced-configuration/release-options/" class="md-nav__link">
      Release options
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../advanced-configuration/Erlang-cookie-security/" class="md-nav__link">
      Erlang Cookie Security
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../advanced-configuration/TLS-hardening/" class="md-nav__link">
      TLS hardening
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../advanced-configuration/database-backends-configuration/" class="md-nav__link">
      Database backends configuration
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" >
    
    <label class="md-nav__link" for="nav-7">
      Authentication methods
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Authentication methods" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon"></span>
        Authentication methods
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../authentication-methods/rdbms/" class="md-nav__link">
      RDBMS
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../authentication-methods/external/" class="md-nav__link">
      External
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../authentication-methods/anonymous/" class="md-nav__link">
      Anonymous
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../authentication-methods/ldap/" class="md-nav__link">
      LDAP
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../authentication-methods/jwt/" class="md-nav__link">
      JWT
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../authentication-methods/riak/" class="md-nav__link">
      Riak
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../authentication-methods/http/" class="md-nav__link">
      HTTP
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../authentication-methods/pki/" class="md-nav__link">
      PKI
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../authentication-methods/dummy/" class="md-nav__link">
      Dummy
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8" >
    
    <label class="md-nav__link" for="nav-8">
      MongooseIM open XMPP extensions
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="MongooseIM open XMPP extensions" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        <span class="md-nav__icon md-icon"></span>
        MongooseIM open XMPP extensions
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../open-extensions/muc_light/" class="md-nav__link">
      MUC light
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../open-extensions/token-reconnection/" class="md-nav__link">
      Token-based reconnection
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9" >
    
    <label class="md-nav__link" for="nav-9">
      REST API
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="REST API" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        <span class="md-nav__icon md-icon"></span>
        REST API
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../rest-api/Client-frontend/" class="md-nav__link">
      Client/frontend
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../rest-api/Metrics-backend/" class="md-nav__link">
      Metrics backend
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../rest-api/Administration-backend/" class="md-nav__link">
      Administration backend
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10" >
    
    <label class="md-nav__link" for="nav-10">
      Operation and maintenance
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Operation and maintenance" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        <span class="md-nav__icon md-icon"></span>
        Operation and maintenance
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../operation-and-maintenance/gdpr-considerations/" class="md-nav__link">
      GDPR considerations
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../operation-and-maintenance/Cluster-management-considerations/" class="md-nav__link">
      Cluster management considerations
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../operation-and-maintenance/Cluster-configuration-and-node-management/" class="md-nav__link">
      Cluster configuration and node management
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../operation-and-maintenance/Logging-%26-monitoring/" class="md-nav__link">
      Logging & monitoring
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../operation-and-maintenance/Logging/" class="md-nav__link">
      Logging configuration
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../operation-and-maintenance/Humio/" class="md-nav__link">
      Logging with Humio
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../operation-and-maintenance/Logging-fields/" class="md-nav__link">
      Logging fields
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../operation-and-maintenance/Reloading-configuration-on-a-running-system/" class="md-nav__link">
      Reloading configuration on a running system
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../operation-and-maintenance/MongooseIM-metrics/" class="md-nav__link">
      Metrics
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../operation-and-maintenance/System-Metrics-Privacy-Policy/" class="md-nav__link">
      System Metrics Privacy Policy
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../operation-and-maintenance/tls-distribution/" class="md-nav__link">
      Distribution over TLS
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../operation-and-maintenance/known-issues/" class="md-nav__link">
      Known issues
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11" >
    
    <label class="md-nav__link" for="nav-11">
      Developer's guide
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Developer's guide" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        <span class="md-nav__icon md-icon"></span>
        Developer's guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../developers-guide/Testing-MongooseIM/" class="md-nav__link">
      Testing MongooseIM
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../developers-guide/logging/" class="md-nav__link">
      Logging
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../developers-guide/Hooks-and-handlers/" class="md-nav__link">
      Hooks and Handlers
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../developers-guide/hooks_description/" class="md-nav__link">
      Hooks description
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../developers-guide/Stanza-routing/" class="md-nav__link">
      Stanza routing
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../developers-guide/accumulators/" class="md-nav__link">
      Accumulators
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../developers-guide/flat_options/" class="md-nav__link">
      Flat options format
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../developers-guide/Moving-to-single-app-project-structure/" class="md-nav__link">
      Moving to single app project structure
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../developers-guide/mod_amp_developers_guide/" class="md-nav__link">
      mod_amp development
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../developers-guide/mod_muc_light_developers_guide/" class="md-nav__link">
      mod_muc_light developers doc
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../developers-guide/SCRAM-serialization/" class="md-nav__link">
      SCRAM serialization format
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../developers-guide/xep_tool/" class="md-nav__link">
      xep-tool usage
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../developers-guide/OpenSSL-and-FIPS/" class="md-nav__link">
      FIPS mode
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../developers-guide/Basic-iq-handler/" class="md-nav__link">
      Basic IQ Handler
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../developers-guide/mongoose_wpool/" class="md-nav__link">
      mongoose_wpool
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  


  
  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-12" type="checkbox" id="nav-12" checked>
    
    <label class="md-nav__link" for="nav-12">
      Module index
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Module index" data-md-level="1">
      <label class="md-nav__title" for="nav-12">
        <span class="md-nav__icon md-icon"></span>
        Module index
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_adhoc/" class="md-nav__link">
      mod_adhoc
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_amp/" class="md-nav__link">
      mod_amp
    </a>
  </li>

        
          
          
          


  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        mod_auth_token
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      mod_auth_token
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#module-description" class="md-nav__link">
    Module Description
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#options" class="md-nav__link">
    Options
  </a>
  
    <nav class="md-nav" aria-label="Options">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modulesmod_auth_tokenvalidity_period" class="md-nav__link">
    modules.mod_auth_token.validity_period
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#required-keys" class="md-nav__link">
    Required keys
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#token-types" class="md-nav__link">
    Token types
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#token-serialization-format" class="md-nav__link">
    Token serialization format
  </a>
  
    <nav class="md-nav" aria-label="Token serialization format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#requesting-access-or-refresh-tokens-when-logged-in" class="md-nav__link">
    Requesting access or refresh tokens when logged in
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#token-response-format" class="md-nav__link">
    Token response format
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#login-with-access-or-refresh-token" class="md-nav__link">
    Login with access or refresh token
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#token-revocation-using-command-line-tool" class="md-nav__link">
    Token revocation using command line tool
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-configuration" class="md-nav__link">
    Example configuration
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_blocking/" class="md-nav__link">
      mod_blocking
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_bosh/" class="md-nav__link">
      mod_bosh
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_caps/" class="md-nav__link">
      mod_caps
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_carboncopy/" class="md-nav__link">
      mod_carboncopy
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_commands/" class="md-nav__link">
      mod_commands
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_csi/" class="md-nav__link">
      mod_csi
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_disco/" class="md-nav__link">
      mod_disco
    </a>
  </li>

        
          
          
          



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-12-11" type="checkbox" id="nav-12-11" >
    
    <label class="md-nav__link" for="nav-12-11">
      mod_event_pusher
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="mod_event_pusher" data-md-level="2">
      <label class="md-nav__title" for="nav-12-11">
        <span class="md-nav__icon md-icon"></span>
        mod_event_pusher
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_event_pusher/" class="md-nav__link">
      mod_event_pusher
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_event_pusher_http/" class="md-nav__link">
      HTTP backend
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_event_pusher_push/" class="md-nav__link">
      Push backend
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_event_pusher_sns/" class="md-nav__link">
      SNS backend
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_event_pusher_rabbit/" class="md-nav__link">
      RabbitMQ backend
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_extdisco/" class="md-nav__link">
      mod_extdisco
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_global_distrib/" class="md-nav__link">
      mod_global_distrib
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_http_upload/" class="md-nav__link">
      mod_http_upload
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_inbox/" class="md-nav__link">
      mod_inbox
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_jingle_sip/" class="md-nav__link">
      mod_jingle_sip
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_keystore/" class="md-nav__link">
      mod_keystore
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_last/" class="md-nav__link">
      mod_last
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_mam/" class="md-nav__link">
      mod_mam
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_muc/" class="md-nav__link">
      mod_muc
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_muc_commands/" class="md-nav__link">
      mod_muc_commands
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_muc_log/" class="md-nav__link">
      mod_muc_log
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_muc_light/" class="md-nav__link">
      mod_muc_light
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_muc_light_commands/" class="md-nav__link">
      mod_muc_light_commands
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_offline/" class="md-nav__link">
      mod_offline
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_offline_stub/" class="md-nav__link">
      mod_offline_stub
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_ping/" class="md-nav__link">
      mod_ping
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_privacy/" class="md-nav__link">
      mod_privacy
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_private/" class="md-nav__link">
      mod_private
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_pubsub/" class="md-nav__link">
      mod_pubsub
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_push_service_mongoosepush/" class="md-nav__link">
      mod_push_service_mongoosepush
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_register/" class="md-nav__link">
      mod_register
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_roster/" class="md-nav__link">
      mod_roster
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_shared_roster_ldap/" class="md-nav__link">
      mod_shared_roster_ldap
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_sic/" class="md-nav__link">
      mod_sic
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_stream_management/" class="md-nav__link">
      mod_stream_management
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_time/" class="md-nav__link">
      mod_time
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_vcard/" class="md-nav__link">
      mod_vcard
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../mod_version/" class="md-nav__link">
      mod_version
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#module-description" class="md-nav__link">
    Module Description
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#options" class="md-nav__link">
    Options
  </a>
  
    <nav class="md-nav" aria-label="Options">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modulesmod_auth_tokenvalidity_period" class="md-nav__link">
    modules.mod_auth_token.validity_period
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#required-keys" class="md-nav__link">
    Required keys
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#token-types" class="md-nav__link">
    Token types
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#token-serialization-format" class="md-nav__link">
    Token serialization format
  </a>
  
    <nav class="md-nav" aria-label="Token serialization format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#requesting-access-or-refresh-tokens-when-logged-in" class="md-nav__link">
    Requesting access or refresh tokens when logged in
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#token-response-format" class="md-nav__link">
    Token response format
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#login-with-access-or-refresh-token" class="md-nav__link">
    Login with access or refresh token
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#token-revocation-using-command-line-tool" class="md-nav__link">
    Token revocation using command line tool
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-configuration" class="md-nav__link">
    Example configuration
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>mod_auth_token</h1>
                
                <h2 id="module-description">Module Description</h2>
<p>This module implements handling of tokens in an OAuth-like authentication scheme. 
It provides services necessary to:</p>
<ul>
<li>deserialize/serialize binary tokens received and issued by the server,</li>
<li>validate incoming binary tokens, i.e.:<ul>
<li>check integrity using Message Authentication Codes (MAC) with server-side stored user keys,</li>
<li>check validity against the configured validity duration times,</li>
<li>check revocation status,</li>
</ul>
</li>
<li>handle token requests from logged in users.</li>
</ul>
<p>The module itself does not implement protocol related details - these are implemented in <code>cyrsasl.erl</code>.
Generation of keys necessary to sign binary tokens is delegated to module <code>mod_keystore.erl</code>.</p>
<h2 id="options">Options</h2>
<h3 id="modulesmod_auth_tokenvalidity_period"><code>modules.mod_auth_token.validity_period</code></h3>
<ul>
<li><strong>Syntax:</strong> Array of TOML tables with the following keys: <code>token</code>, <code>value</code>, <code>unit</code> and following values: {token = <code>values: "access", "refresh", "provision"</code>, value = <code>non-negative integer</code>, unit = <code>values: "days", "hours", "minutes", "seconds"</code>}.</li>
<li><strong>Default:</strong> <code>[{token = "access", value = 1, unit = "hours"}, {token = "refresh", value = 25, unit = "days"}]</code></li>
<li><strong>Example:</strong> <code>[{token = "access", value = 13, unit = "minutes"}, {token = "refresh", value = 13, unit = "days"}]</code></li>
</ul>
<p>Validity periods of access and refresh tokens can be defined independently.
Validity period configuration for provision tokens happens outside the module since the server does not generate provision tokens - it only validates them.</p>
<h3 id="required-keys">Required keys</h3>
<p>To read more about the keys MongooseIM makes use of, please refer to <a href="../mod_keystore/">mod_keystore</a> documentation.</p>
<h2 id="token-types">Token types</h2>
<p>Three token types are supported:</p>
<ul>
<li>
<p><em>access tokens</em>: These are short lived tokens which grants aren't tracked by the server (i.e. there's no need to store anything in a database).
  Access tokens can be used as a payload for the X-OAUTH authentication mechanism and grant access to the system.
  Access tokens can't be revoked.
  An access token is valid only until its expiry date is reached.</p>
</li>
<li>
<p><em>refresh tokens</em>: These are longer lived tokens which are tracked by the server and therefore require persistent storage (as of now only PostgreSQL is supported).
  Refresh tokens can be used as a payload for the X-OAUTH authentication mechanism and to grant access to the system.
  Also they can result in a new set of tokens being returned upon successful authentication.
  They can be revoked - if a refresh token hasn't been revoked, it is valid until it has expired.
  On revocation, it immediately becomes invalid.
  As the server stores information about granted tokens, it can also persistently mark them as revoked.</p>
</li>
<li>
<p><em>provision tokens</em>: These tokens are generated by a service external to the server. 
   They grant the owner a permission to create an account.
  A provision token may contain information which the server can use to provision the VCard for the newly created account.
  Using a provision token to create an account (and inject VCard data) is done similarly to other token types, i.e. by passing it as payload for the X-OAUTH mechanism.
  The XMPP server has no way of tracking and revoking provision tokens, as they come from an outside source.</p>
</li>
</ul>
<h2 id="token-serialization-format">Token serialization format</h2>
<p>All tokens (access, refresh, provision) are to be exchanged as <em>Base64 encoded</em> binary data.
Serialization format of the token before encoding with Base64 is dependent on its type:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>&#39;access&#39; \0 &lt;BARE_JID&gt; \0 &lt;EXPIRES_AT&gt; \0 &lt;MAC&gt;

&#39;refresh&#39; \0 &lt;BARE_JID&gt; \0 &lt;EXPIRES_AT&gt; \0 &lt;SEQUENCE_NO&gt; \0 &lt;MAC&gt;

&#39;provision&#39; \0 &lt;BARE_JID&gt; \0 &lt;EXPIRES_AT&gt; \0 &lt;VCARD&gt; \0 &lt;MAC&gt;
</code></pre></div>
</td></tr></table>
<p>For example (these tokens are randomly generated, hence field values don't make much sense - line breaks are inserted only for the sake of formatting,<code>&lt;vCard/&gt;</code> inner XML is snipped):</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>&#39;access&#39; \0 Q8@localhost \0 64875466454
    \0 0acd0a66d06934791d046060cf9f1ad3c2abb3274cc7e7d7b2bc7e2ac4453ed774b6c6813b40ebec2bbc3774d59d4087

&#39;refresh&#39; \0 qp@localhost \0 64875466457 \0 6
    \0 8f57cb019cd6dc6e7779be165b9558611baf71ee4a40d03e77b78b069f482f96c9d23b1ac1ef69f64c1a1db3d36a96ad

&#39;provision&#39; \0 Xmi4@localhost \0 64875466458 \0 &lt;vCard&gt;...&lt;/vCard&gt;
    \0 86cd344c98b345390c1961e12cd4005659b4b0b3c7ec475bde9acc9d47eec27e8ddc67003696af582747fb52e578a715
</code></pre></div>
</td></tr></table>
<h3 id="requesting-access-or-refresh-tokens-when-logged-in">Requesting access or refresh tokens when logged in</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nt">&lt;iq</span> <span class="na">type=</span><span class="s">&#39;get&#39;</span> <span class="na">to=</span><span class="s">&#39;john@localhost&#39;</span> <span class="na">id=</span><span class="s">&#39;123&#39;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;query</span> <span class="na">xmlns=</span><span class="s">&#39;erlang-solutions.com:xmpp:token-auth:0&#39;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/iq&gt;</span>
</code></pre></div>
</td></tr></table>
<p>To request access and refresh tokens for the first time a client should send an IQ stanza after they have successfully authenticated for the first time using some other method.</p>
<h2 id="token-response-format">Token response format</h2>
<p>Requested tokens are being returned by the server wrapped in IQ stanza with the following fields:</p>
<ul>
<li><code>id</code>: value taken from the request IQ stanza</li>
<li><code>type</code>: result</li>
<li><code>from</code>: bare user JID</li>
<li><code>to</code>: full user JID</li>
</ul>
<p>Example response (encoded tokens have been truncated in this example):</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nt">&lt;iq</span>  <span class="na">id=</span><span class="s">&#39;123&#39;</span> <span class="na">type=</span><span class="s">&#39;result&#39;</span> <span class="na">from=</span><span class="s">&#39;john@localhost&#39;</span> <span class="na">to=</span><span class="s">&#39;john@localhost/res1&#39;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;items</span> <span class="na">xmlns=</span><span class="s">&#39;erlang-solutions.com:xmpp:token-auth:0&#39;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;access_token&gt;</span>cmVmcmVzaAGQ1Mzk1MmZlYzhkYjhlOTQzM2UxMw==<span class="nt">&lt;/access_token&gt;</span>
        <span class="nt">&lt;refresh_token&gt;</span>cmVmcmVzaAGQ1Mzk1MmZlYzhkYjhlOTQzM2UxMw==<span class="nt">&lt;/refresh_token&gt;</span>
    <span class="nt">&lt;/items&gt;</span>
<span class="nt">&lt;/iq&gt;</span>
</code></pre></div>
</td></tr></table>
<p>Once a client has obtained a token, they may start authenticating using the <code>X-OAUTH</code> SASL mechanism when reaching the authentication phase of an XMPP connection initiation.</p>
<h2 id="login-with-access-or-refresh-token">Login with access or refresh token</h2>
<p>In order to log into the XMPP server using a previously requested token, a client should send the following stanza:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nt">&lt;auth</span> <span class="na">xmlns=</span><span class="s">&quot;urn:ietf:params:xml:ns:xmpp-sasl&quot;</span> <span class="na">mechanism=</span><span class="s">&quot;X-OAUTH&quot;</span><span class="nt">&gt;</span>
cmVmcmVzaAGQ1Mzk1MmZlYzhkYjhlOTQzM2UxMw== 
<span class="nt">&lt;/auth&gt;</span>
</code></pre></div>
</td></tr></table>
<p>The Base64 encoded content is a token obtained prior to authentication.
Authentication will succeed unless the used tokens are expired, revoked, or the keys required for MAC verification could not be found by the server.</p>
<p><strong>When using a refresh token to authenticate with the server</strong>, the server will respond with a new <em>access token</em>:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nt">&lt;success</span> <span class="na">xmlns=</span><span class="s">&quot;urn:ietf:params:xml:ns:xmpp-sasl&quot;</span><span class="nt">&gt;</span>
cmVmcmVzaAGQ1Mzk1MmZlYzhkYjhlOTQzM2UxMw==
<span class="nt">&lt;/success&gt;</span>
</code></pre></div>
</td></tr></table>
<p>The above response is to be expected unless the refresh token used is expired or there were some problems processing the key on the server side.</p>
<h2 id="token-revocation-using-command-line-tool">Token revocation using command line tool</h2>
<p>Refresh tokens issued by the server can be used to:</p>
<ul>
<li>log in a user: as an authentication valet,</li>
<li>request <em>a new access token</em> with refreshed expiry date.</li>
</ul>
<p>An administrator may <em>revoke</em> a refresh token:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>mongooseimctl revoke_token owner@xmpphost
</code></pre></div>
</td></tr></table>
<p>A client can no longer use a revoked token either for authentication or requesting new access tokens.
After a client's token has been revoked, in order to obtain a new refresh token a client has to log in using some other method.</p>
<p><strong>Caveat:</strong> as of now, the user's session is not terminated automatically on token revocation.
Therefore, the user might request a new set of tokens for as long as the session is active, even though their previous token was just revoked (possibly due to a breach / token leak).
Moreover, an access token still kept on a compromised device can be used to establish a new session for as long as it's valid - access tokens can't be revoked.
To alleviate rerequesting tokens by the user, an operator can use <code>mod_admin</code> extension allowing to terminate the user's connection.
Access token validity can't be sidestepped right now.</p>
<h2 id="example-configuration">Example configuration</h2>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">[modules.mod_auth_token]</span>
  <span class="n">validity_period</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="n">token</span> <span class="o">=</span> <span class="s">&quot;access&quot;</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="mi">13</span><span class="p">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="s">&quot;minutes&quot;</span><span class="p">},</span>
    <span class="p">{</span><span class="n">token</span> <span class="o">=</span> <span class="s">&quot;refresh&quot;</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="mi">13</span><span class="p">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="s">&quot;days&quot;</span><span class="p">}</span>
  <span class="p">]</span>
</code></pre></div>
</td></tr></table>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../mod_amp/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                mod_amp
              </div>
            </div>
          </a>
        
        
          <a href="../mod_blocking/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                mod_blocking
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.93c04032.min.js"></script>
      <script src="../../assets/javascripts/bundle.83e5331e.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.8c7e0a7e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="../../js/version-select.js"></script>
      
    
  </body>
</html>