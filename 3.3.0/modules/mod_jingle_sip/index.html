<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../favicon.ico">
  
  <title>mod_jingle_sip - MongooseIM</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  <link href="../../custom.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "mod_jingle_sip";
    var mkdocs_page_input_path = "modules/mod_jingle_sip.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> MongooseIM</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">User guide</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../user-guide/Get-to-know-MongooseIM/">ABCs of MongooseIM</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../user-guide/MongooseIM-High-level-Architecture/">High-level Architecture</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../user-guide/Features-and-supported-standards/">Features and supported standards</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../user-guide/Getting-started/">Getting started</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../user-guide/release_config/">Release/Installation configuration</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Tutorials</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../user-guide/How-to-build/">How to Build MongooseIM from source code</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../user-guide/Push-notifications/">How to Set up MongoosePush</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../user-guide/ICE_tutorial/">How to Set up MongooseICE</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../user-guide/iOS_tutorial/">How to Build an iOS messaging app</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../user-guide/Jingle-SIP-setup/">How to Set up Jingle/SIP</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Migration Guide</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../migrations/3.1.1_3.2.0/">3.1.1 to 3.2.0</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Platform</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Contributions/">Contributions to ecosystem</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../Differentiators/">Differentiators</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../History/">History</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Configuration</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Basic-configuration/">Basic Configuration</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../Advanced-configuration/">Advanced Configuration</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/database-backends-configuration/">Database backends configuration</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/outgoing-connections/">Outgoing connections</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/Modules/">Extension Modules</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/Listener-modules/">Listener Modules</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/acl/">ACL</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/Services/">Services</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Authentication methods</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../authentication-methods/client-certificate/">Client Certificate</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Authentication backends</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../authentication-backends/External-authentication-module/">External Authentication Module</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../authentication-backends/HTTP-authentication-module/">HTTP Authentication Module</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../authentication-backends/JWT-authentication-module/">JWT Authentication Module</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../authentication-backends/LDAP-authentication-module/">LDAP Authentication Module</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../authentication-backends/PKI-authentication-module/">PKI Authentication Module</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">MongooseIM open XMPP extensions</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../open-extensions/muc_light/">MUC light</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../open-extensions/token-reconnection/">Token-based reconnection</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">REST API</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../rest-api/Client-frontend/">Client/frontend</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../rest-api/Metrics-backend/">Metrics backend</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../rest-api/Administration-backend/">Administration backend</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Operation and maintenance</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/Cluster-management-considerations/">Cluster management considerations</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/Cluster-configuration-and-node-management/">Cluster configuration and node management</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/Logging-%26-monitoring/">Logging & monitoring</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/Reloading-configuration-on-a-running-system/">Reloading configuration on a running system</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/Mongoose-metrics/">Metrics</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/tls-distribution/">Distribution over TLS</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Developer's guide</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/Testing-MongooseIM/">Testing MongooseIM</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/logging/">Logging</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/Hooks-and-handlers/">Hooks and Handlers</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/hooks_description/">Hooks description</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/message_routing/">Stanza routing</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/accumulators/">Accumulators</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/flat_options/">Flat options format</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/Moving-to-single-app-project-structure/">Moving to single app project structure</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/mod_amp_developers_guide/">mod_amp development</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/mod_muc_light_developers_guide/">mod_muc_light developers doc</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/SCRAM-serialization/">SCRAM serialization format</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/xep_tool/">xep-tool usage</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/OpenSSL-and-FIPS/">FIPS mode</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/Basic-iq-handler/">Basic IQ Handler</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/mongoose_wpool/">mongoose_wpool</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Module index</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../mod_adhoc/">mod_adhoc</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_amp/">mod_amp</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_auth_token/">mod_auth_token</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_blocking/">mod_blocking</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_bosh/">mod_bosh</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_caps/">mod_caps</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_carboncopy/">mod_carboncopy</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_commands/">mod_commands</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_csi/">mod_csi</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_inbox/">mod_inbox</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_disco/">mod_disco</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_global_distrib/">mod_global_distrib</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">mod_event_pusher</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../mod_event_pusher/">mod_event_pusher</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../mod_event_pusher_http/">HTTP backend</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../mod_event_pusher_push/">Push backend</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../mod_event_pusher_sns/">SNS backend</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../mod_event_pusher_rabbit/">RabbitMQ backend</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_http_upload/">mod_http_upload</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">mod_jingle_sip</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#jingle-to-sip-translation">Jingle to SIP translation</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#ringing-notification">Ringing notification</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#recipient-unavailable">Recipient unavailable</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#other-error-codes">Other error codes</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#non-standard-jingle-stanzas-used-by-jinglejs">Non-standard Jingle stanzas used by jingle.js</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#non-stadard-jingle-existing-session-initiate-stanza">Non-stadard Jingle existing-session-initiate stanza</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_keystore/">mod_keystore</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_last/">mod_last</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_mam/">mod_mam</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_muc/">mod_muc</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_muc_commands/">mod_muc_commands</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_muc_log/">mod_muc_log</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_muc_light/">mod_muc_light</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_muc_light_commands/">mod_muc_light_commands</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_offline/">mod_offline</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_offline_stub/">mod_offline_stub</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_ping/">mod_ping</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_privacy/">mod_privacy</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_private/">mod_private</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_pubsub/">mod_pubsub</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_push_service_mongoosepush/">mod_push_service_mongoosepush</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_register/">mod_register</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_revproxy/">mod_revproxy</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_roster/">mod_roster</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_shared_roster_ldap/">mod_shared_roster_ldap</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_sic/">mod_sic</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_stream_management/">mod_stream_management</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_time/">mod_time</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_vcard/">mod_vcard</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mod_version/">mod_version</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">MongooseIM</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Module index &raquo;</li>
        
      
    
    <li>mod_jingle_sip</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h3 id="module-description">Module Description</h3>
<p>This module enables Jingle to SIP and SIP to Jingle translation.
When this module is enabled, MongooseIM will intercept any Jingle IQ set stanza with action:</p>
<ul>
<li>session-initiate</li>
<li>session-terminate</li>
<li>session-accept</li>
<li>transport-info</li>
</ul>
<p>and translate it to SIP messages with appropriate SDP content based on the details in the Jingle stanza.</p>
<p>The translation back from SIP to Jingle is done for the following SIP requests:</p>
<ul>
<li><code>INVITE</code></li>
<li><code>re-INVITE</code> - <code>INVITE</code> message sent for an accepted session</li>
<li><code>CANCEL</code></li>
<li><code>BYE</code></li>
<li><code>INFO</code></li>
</ul>
<p>and following responses to the INVITE request:</p>
<ul>
<li><code>200</code> when the call invite was accepted</li>
<li><code>180</code> and <code>183</code> to indicate that the invitation was sent to the device</li>
<li><code>486</code> when the call's recipient rejects it</li>
<li>from <code>400</code> to <code>600</code> - other error codes indicating session termination</li>
</ul>
<h4 id="jingle-to-sip-translation">Jingle to SIP translation</h4>
<p>The table below summarises the bilateral translation for standard Jingle and SIP messages:</p>
<table>
<thead>
<tr>
<th>Jingle action</th>
<th>SIP message</th>
<th>comment</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>session-initiate</code></td>
<td><code>INVITE</code> request</td>
<td></td>
</tr>
<tr>
<td><code>session-accept</code></td>
<td><code>200 OK</code> response</td>
<td></td>
</tr>
<tr>
<td><code>session-terminate</code> with reason <code>success</code></td>
<td><code>BYE</code> request</td>
<td>Only for accepted session</td>
</tr>
<tr>
<td><code>session-terminate</code> with reason <code>decline</code></td>
<td><code>CANCEL</code> request</td>
<td>When sent by call's initiator</td>
</tr>
<tr>
<td><code>session-terminate</code> with reason <code>decline</code></td>
<td><code>486 Busy Here</code> response</td>
<td>When sent by the invite user</td>
</tr>
<tr>
<td><code>transport-info</code></td>
<td><code>INFO</code> request</td>
<td></td>
</tr>
</tbody>
</table>
<h5 id="ringing-notification">Ringing notification</h5>
<p>Both Jingle and SIP have the <code>ringing</code> notification.
It's generated as a response code <code>180 Ringing</code> by a SIP entity when the INVITE is sent to the device.
In SIP world a <code>183 Session Progress</code> response code is also generated in some cases.
Both <code>180</code> and <code>183</code> codes are translated as <code>session-info</code> Jingle stanza with <code>ringing</code> sub element.
MongooseIM generates only <code>180 Ringing</code> response code the <code>INVITE</code> request, if the recipient's online.
If the recipient is online, MongooseIM generates the <code>180 Ringing</code> response code to the <code>INVITE</code> request.</p>
<h5 id="recipient-unavailable">Recipient unavailable</h5>
<p>When MongooseIM receives a SIP <code>INVITE</code> request addressed to an offline user,
it replies with a <code>480 Temporarily Unavailable</code> code.
The same code is expected from the SIP Proxy when MongooseIM sends the <code>INVITE</code> request.</p>
<h5 id="other-error-codes">Other error codes</h5>
<p>When an error response to the <code>INVITE</code> request is from the range <code>400</code> to <code>699</code> but not <code>486</code>,
MongooseIM will send a Jingle <code>session-terminate</code> stanza to the call's initiator.
The stanza has reason <code>general-error</code> with the SIP error code in the <code>sip-error</code> sub element.</p>
<h5 id="non-standard-jingle-stanzas-used-by-jinglejs">Non-standard Jingle stanzas used by jingle.js</h5>
<p>The following non-standard Jingle stanzas were integrated with https://github.com/softwarehutpl/jingle.js</p>
<ul>
<li><code>source-remove</code></li>
<li><code>source-add</code></li>
<li><code>source-update</code></li>
</ul>
<p>When MongooseIM observes the above Jingle stanzas, it will translate them to a SIP in-dialog <code>INVITE</code> request.
In the SDP content of the request, there will be a custom attribute <code>a=jingle-action</code>.
The value of the custom attribute is one of the three presented above.</p>
<p>Similarly when MongooseIM gets a SIP in-dialog <code>INVITE</code> request,
it will check if there is a custom attribute and use it as the <code>action</code> attribute of the Jingle stanza sent to the user.
If there is no such attribute, the action will be set to regular Jingle <code>transport-info</code>.</p>
<h5 id="non-stadard-jingle-existing-session-initiate-stanza">Non-stadard Jingle existing-session-initiate stanza</h5>
<p>MongooseIM allows a user to ask for an unanswered <code>session-initiate</code> request.
This may be useful in web applications when there is a need to handle the call in a new browser window.</p>
<p>In order to get the <code>session-initiate</code>, which was not answered yet, the user can send a <code>get</code> Jingle stanza to self with action set to <code>existing-session-initiate</code>.
As a result, MongooseIM will resend the original <code>session-initiate</code> request to the device which sent the query.</p>
<h3 id="prerequisites">Prerequisites</h3>
<p>By default, MongooseIM is built without SIP support.
In order to build the server with SIP support, please use <code>tools/configure</code> script before the release generation.
You may either pick only certain drivers (with SIP included) or simply use <code>with-all</code> option. Examples:</p>
<pre><code>tools/configure with-mysql with-jingle-sip
tools/configure with-all without-odbc
tools/configure with-all
</code></pre>
<p>MongooseIM 2.2.x packages are built with OTP 19.3, so they include Jingle/SIP support.</p>
<h3 id="options">Options</h3>
<ul>
<li><code>proxy_host</code> (default: "localhost") name or IP address of the SIP Proxy to which MongooseIM will send SIP messages</li>
<li><code>proxy_port</code> (default: 5600) port of the SIP Proxy</li>
<li><code>listen_port</code> (default: 5600) the port on which MongooseIM will listen for incomming SIP messages</li>
<li><code>local_host</code> (default: "localhost") value used to create SIP URIs (including VIA headers)</li>
<li><code>sdp_origin</code> (default: "127.0.0.1") value of the <code>c=</code> SDP attribute</li>
</ul>
<p>The simplest configuration is the following:</p>
<pre><code class="language-erlang">{mod_jingle_sip, []}
</code></pre>
<p>With this configuration MongooseIM will try sending SIP messages to a SIP proxy listening on localhost and port 5060.</p>
<h3 id="use-cases-covered-by-tests">Use cases covered by tests</h3>
<p>Currently to test the functionality we use a SIP Proxy mock written in Erlang.
The following scenarios are covered by our tests in <code>big_tests/tests/jingle_SUITE.erl</code></p>
<p>All the sequence diagrams where generated with <a href="https://textart.io/sequence">textart.io/sequence</a>.
The source code is embedded in the markdown file below every diagram inside a comment <code>&lt;!--- ---&gt;</code></p>
<h4 id="1-establishing-a-session-with-another-xmpp-user">1. Establishing a session with another XMPP user</h4>
<p>With the mod_jingle_sip enabled, all Jingle IQ set stanzas listed above are intercepted, translated to SIP packets and sent to a SIP Proxy.
This means that the current implementation will also translate stanzas addressed to a user in the same domain.
This allows the SIP entity to control how the call between XMPP users is established.
Below there are sequence diagrams showing the communication between XMPP users, MongooseIM and SIP Proxy as in our tests.
It's possible that the SIP Proxy or other SIP entity decides that the call needs to be forked
and delivered to the user's phone number instead of generating a corresponding call back to MongooseIM.</p>
<h5 id="11-signaling-session-initiate-to-other-xmpp-user-via-sip-proxy">1.1 Signaling session-initiate to other XMPP user via SIP Proxy</h5>
<pre><code>+-------+                       +-------------+       +-----------+                   +-------+
| UserA |                       | MongooseIM  |       | SIPProxy  |                   | UserB |
+-------+                       +-------------+       +-----------+                   +-------+
    |                                  |                    |                             |
    | session-initiate to UserB        |                    |                             |
    |---------------------------------&gt;|                    |                             |
    | -------------------------\       |                    |                             |
    |-| Jingle stanza          |       |                    |                             |
    | | action:session-initate |       |                    |                             |
    | | sid: 123               |       |                    |                             |
    | |------------------------|       | SIP INVITE         |                             |
    |                                  |-------------------&gt;|                             |
    |                                  | -------------\     |                             |
    |                                  |-| from:UserA |     |                             |
    |                                  | | to:UserB   |     |                             |
    |                                  | | sid: 123   |     |                             |
    |                                  | |------------|     | create new call             |
    |                                  |                    |----------------             |
    |                                  |                    |               |             |
    |                                  |                    |&lt;---------------             |
    |                                  |                    | ------------------------\   |
    |                                  |                    |-| SDP content can be    |   |
    |                                  |                    | | changed for instance  |   |
    |                                  |                    | | to inject a transport |   |
    |                                  |         SIP INVITE | | canidate              |   |
    |                                  |&lt;-------------------| |-----------------------|   |
    |                                  |     -------------\ |                             |
    |                                  |     | from:UserA |-|                             |
    |                                  |     | to:UserB   | |                             |
    |            --------------------\ |     | sid:456    | |                             |
    |            | yes, new SID: 456 |-|     |------------| |                             |
    |            |-------------------| |                    |                             |
    |                                  |                    |                             |
    |                                  | session-initiate to UserB                        |
    |                                  |-------------------------------------------------&gt;|
    |                                  |                    |                             |
</code></pre>
<!---
object UserA MongooseIM SIPProxy UserB
UserA->MongooseIM: session-initiate to UserB
note right of UserA: Jingle stanza \n action:session-initate\nsid: 123
MongooseIM->SIPProxy: SIP INVITE
note right of MongooseIM: from:UserA\nto:UserB\nsid: 123
SIPProxy->SIPProxy: create new call
note right of SIPProxy: SDP content can be\nchanged for instance\n to inject a transport\n canidate
SIPProxy->MongooseIM: SIP INVITE
note left of SIPProxy: from:UserA\nto:UserB\nsid:456
note left of MongooseIM: yes, new SID: 456
MongooseIM->UserB: session-initiate to UserB
-->

<h5 id="12-signaling-session-accept-to-other-xmpp-user-via-sip-proxy">1.2 Signaling session-accept to other XMPP user via SIP Proxy</h5>
<p>When the other user accepts the call invite sent by the first, the following sequence is executed.
This is a continuation of the <a href="#11-signaling-session-initiate-to-other-xmpp-user-via-sip-proxy">previous example</a></p>
<pre><code>+-------+                       +-------------+        +-----------+                   +-------+
| UserA |                       | MongooseIM  |        | SIPProxy  |                   | UserB |
+-------+                       +-------------+        +-----------+                   +-------+
    |                                  |                     |                             |
    |                                  |                     |     session-accpet to UserA |
    |                                  |&lt;--------------------------------------------------|
    |                                  |                     |   ------------------------\ |
    |                                  |                     |   | Jingle stanza         |-|
    |                                  |                     |   | action:session-accept | |
    |                                  |                     |   | sid: 456              | |
    |                                  | 200 OK              |   |-----------------------| |
    |                                  |--------------------&gt;|                             |
    |                                  | --------------\     |                             |
    |                                  |-| from: UserA |     |                             |
    |                                  | | to: UserB   |     |                             |
    |                                  | | sid: 456    |     |                             |
    |                                  | |-------------|     | find corresponding call     |
    |                                  |                     |------------------------     |
    |                                  |                     |                       |     |
    |                                  |                     |&lt;-----------------------     |
    |                                  |                     |                             |
    |                                  |              200 OK |                             |
    |                                  |&lt;--------------------|                             |
    |                                  |     --------------\ |                             |
    |                                  |     | from: UserA |-|                             |
    |                                  |     | to: UserB   | |                             |
    |                                  |     | sid: 123    | |                             |
    |        session-accept from UserB |     |-------------| |                             |
    |&lt;---------------------------------|                     |                             |
    |                                  |                     |                             |
</code></pre>
<!---
object UserA MongooseIM SIPProxy UserB
UserB->MongooseIM: session-accpet to UserA
note left of UserB: Jingle stanza \n action:session-accept\nsid: 456
MongooseIM->SIPProxy: 200 OK
note right of MongooseIM:from: UserA\nto: UserB\nsid: 456
SIPProxy->SIPProxy: find corresponding call
SIPProxy->MongooseIM: 200 OK
note left of SIPProxy: from: UserA\nto: UserB\nsid: 123
MongooseIM->UserA: session-accept from UserB
-->

<h5 id="13-terminating-a-call">1.3 Terminating a call</h5>
<p>Any Jingle session (accepted or not) can be terminated by sending a Jingle stanza with action <code>session-terminate</code> and a reason.
In the SIP world it's more complex.
See the following examples for more information.</p>
<h6 id="131-terminating-an-accepted-call">1.3.1 Terminating an accepted call</h6>
<p>The easiest scenario is when the call was accepted as in <a href="#12-signaling-session-accept-to-other-xmpp-user-via-sip-proxy">1.2</a>.
In this case one of the users sends a <code>session-terminate</code> Jingle action with a reason <code>success</code>.
This is translated to a SIP <code>BYE</code> request with <code>to</code> and <code>from</code> headers set appropriately -
<code>from</code> is the user who wants to terminate the call and <code>to</code> is the user on the other end of the session.
The <code>BYE</code> request is sent to the SIP Proxy and then to the other user in a similar way to session acceptance.</p>
<h6 id="132-terminating-an-unanswered-call-by-initiator">1.3.2 Terminating an unanswered call by initiator</h6>
<p>To terminate the call before it's accepted, the initiator sends a Jingle <code>session-terminate</code> stanza with a reason <code>decline</code>.
Then MongooseIM translates this to a SIP <code>CANCEL</code> request which is sent to the SIP Proxy.</p>
<h6 id="133-rejecting-the-call">1.3.3 Rejecting the call</h6>
<p>When the invitee wants to terminate the call, on the XMPP level this is also a Jingle <code>session-terminate</code> stanza with a reason <code>decline</code>.
MongooseIM translates this to SIP <code>486 Busy Here</code> <strong>Response</strong> (because this is a response to the invite request).</p>
<h4 id="2-establishing-a-session-with-a-sip-user">2. Establishing a session with a SIP user</h4>
<p>Establishing a session with a SIP user (or a SIP entity) works the same as in the previous section.
The only difference is that the SIP Proxy will not call MongooseIM back (as it may happen for call to other XMPP user).
Instead the SIP message sent by MongooseIM to SIP Proxy will be delivered directly to the SIP user's device.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../mod_keystore/" class="btn btn-neutral float-right" title="mod_keystore">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../mod_http_upload/" class="btn btn-neutral" title="mod_http_upload"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../mod_http_upload/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../mod_keystore/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
