<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../favicon.ico">
  
  <title>How to Build an iOS messaging app - MongooseIM</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  <link href="../../custom.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "How to Build an iOS messaging app";
    var mkdocs_page_input_path = "user-guide/iOS_tutorial.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> MongooseIM</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">User guide</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../Get-to-know-MongooseIM/">ABCs of MongooseIM</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../MongooseIM-High-level-Architecture/">High-level Architecture</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Features-and-supported-standards/">Features and supported standards</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Getting-started/">Getting started</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../release_config/">Release/Installation configuration</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Tutorials</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../How-to-build/">How to Build MongooseIM from source code</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Push-notifications/">How to Set up MongoosePush</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../ICE_tutorial/">How to Set up MongooseICE</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">How to Build an iOS messaging app</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#yaxt-yet-another-xmpp-tutorial">YAXT??! Yet another XMPP tutorial?</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#whats-xmpp">What’s XMPP?</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#why-do-we-need-xmpp-why-not-just-rest">Why do we need XMPP? Why not just REST?</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#whats-the-basic-stuff-i-need-to-know-to-get-started">What’s the basic stuff I need to know to get started?</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#whats-a-jid">What’s a JID?</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#whats-a-stanza">What’s a Stanza?</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#message">&lt;message/&gt;</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#presence">&lt;presence/&gt;</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#whats-a-stream">What’s a Stream?</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#are-we-ok-so-far">Are we ok so far?</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#first-steps-installing-the-xmppframework-library">First steps: installing the XMPPFramework library</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#starting-to-build-our-instant-messaging-app">Starting to build our Instant Messaging app</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#getting-a-log-in">Getting a Log In</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#logging">Logging!</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#configuring-cocoalumberjack">Configuring CocoaLumberjack</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#test-time">Test Time!</a>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Jingle-SIP-setup/">How to Set up Jingle/SIP</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Migration Guide</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../migrations/3.1.1_3.2.0/">3.1.1 to 3.2.0</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Platform</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Roadmap/">Roadmap</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../Contributions/">Contributions to ecosystem</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../Differentiators/">Differentiators</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../History/">History</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Configuration</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Basic-configuration/">Basic Configuration</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../Advanced-configuration/">Advanced Configuration</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/database-backends-configuration/">Database backends configuration</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/outgoing-connections/">Outgoing connections</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/Modules/">Extension Modules</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/Listener-modules/">Listener Modules</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/acl/">ACL</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../advanced-configuration/Services/">Services</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Authentication methods</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../authentication-methods/client-certificate/">Client Certificate</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Authentication backends</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../authentication-backends/External-authentication-module/">External Authentication Module</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../authentication-backends/HTTP-authentication-module/">HTTP Authentication Module</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../authentication-backends/JWT-authentication-module/">JWT Authentication Module</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../authentication-backends/LDAP-authentication-module/">LDAP Authentication Module</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../authentication-backends/PKI-authentication-module/">PKI Authentication Module</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">MongooseIM open XMPP extensions</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../open-extensions/muc_light/">MUC light</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../open-extensions/token-reconnection/">Token-based reconnection</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">REST API</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../rest-api/Client-frontend/">Client/frontend</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../rest-api/Metrics-backend/">Metrics backend</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../rest-api/Administration-backend/">Administration backend</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Operation and maintenance</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/Cluster-management-considerations/">Cluster management considerations</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/Cluster-configuration-and-node-management/">Cluster configuration and node management</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/Logging-%26-monitoring/">Logging & monitoring</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/Reloading-configuration-on-a-running-system/">Reloading configuration on a running system</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/Mongoose-metrics/">Metrics</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../operation-and-maintenance/tls-distribution/">Distribution over TLS</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Developer's guide</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/Testing-MongooseIM/">Testing MongooseIM</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/logging/">Logging</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/Hooks-and-handlers/">Hooks and Handlers</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/hooks_description/">Hooks description</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/message_routing/">Stanza routing</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/accumulators/">Accumulators</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/flat_options/">Flat options format</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/Moving-to-single-app-project-structure/">Moving to single app project structure</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/mod_amp_developers_guide/">mod_amp development</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/mod_muc_light_developers_guide/">mod_muc_light developers doc</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/SCRAM-serialization/">SCRAM serialization format</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/xep_tool/">xep-tool usage</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/OpenSSL-and-FIPS/">FIPS mode</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/Basic-iq-handler/">Basic IQ Handler</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../developers-guide/mongoose_wpool/">mongoose_wpool</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Module index</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_adhoc/">mod_adhoc</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_amp/">mod_amp</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_auth_token/">mod_auth_token</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_blocking/">mod_blocking</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_bosh/">mod_bosh</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_caps/">mod_caps</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_carboncopy/">mod_carboncopy</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_commands/">mod_commands</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_csi/">mod_csi</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_inbox/">mod_inbox</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_disco/">mod_disco</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_global_distrib/">mod_global_distrib</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">mod_event_pusher</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../modules/mod_event_pusher/">mod_event_pusher</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../modules/mod_event_pusher_http/">HTTP backend</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../modules/mod_event_pusher_push/">Push backend</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../modules/mod_event_pusher_sns/">SNS backend</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_http_upload/">mod_http_upload</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_jingle_sip/">mod_jingle_sip</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_keystore/">mod_keystore</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_last/">mod_last</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_mam/">mod_mam</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_muc/">mod_muc</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_muc_commands/">mod_muc_commands</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_muc_log/">mod_muc_log</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_muc_light/">mod_muc_light</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_muc_light_commands/">mod_muc_light_commands</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_offline/">mod_offline</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_offline_stub/">mod_offline_stub</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_ping/">mod_ping</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_privacy/">mod_privacy</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_private/">mod_private</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_pubsub/">mod_pubsub</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_push_service_mongoosepush/">mod_push_service_mongoosepush</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_register/">mod_register</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_revproxy/">mod_revproxy</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_roster/">mod_roster</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_shared_roster_ldap/">mod_shared_roster_ldap</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_sic/">mod_sic</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_stream_management/">mod_stream_management</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_time/">mod_time</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_vcard/">mod_vcard</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../modules/mod_version/">mod_version</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">MongooseIM</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Tutorials &raquo;</li>
        
      
    
    <li>How to Build an iOS messaging app</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="build-a-complete-ios-messaging-app-using-xmppframework">Build a complete iOS messaging app using XMPPFramework</h1>
<p>Read our blog posts:
* <a href="https://www.erlang-solutions.com/blog/build-a-complete-ios-messaging-app-using-xmppframework-tutorial-part-1.html">Build a complete iOS messaging app using XMPPFramework - Tutorial Part 1</a>
* <a href="https://www.erlang-solutions.com/blog/build-a-complete-ios-messaging-app-using-xmppframework-part-2.html">Build a complete iOS messaging app using XMPPFramework - Part 2</a></p>
<h2 id="yaxt-yet-another-xmpp-tutorial">YAXT??! Yet another XMPP tutorial?</h2>
<p>Well, this is going to be another tutorial, but I’m going to try to make it a little bit different.
This is an XMPP tutorial from an iOS developer’s perspective.
I’ll try to answer all the questions I had when I started working in this area.
This journey is going to go from no XMPP knowldege at all
to having a fully functional instant messaging iOS appusing this cool protocol.
We are going to be using the super awesome (yet overwhelming at the beginning…) <a href="https://github.com/robbiehanson/XMPPFramework">XMPPFramework</a> library,
and the idea is also to also mix in some iOS concepts that you are going to need for your app.</p>
<h2 id="whats-xmpp">What’s XMPP?</h2>
<p>From <a href="https://en.wikipedia.org/wiki/XMPP">Wikipedia</a>:
Extensible Messaging and Presence Protocol (XMPP) is a communications protocol for message-oriented middleware based on XML.</p>
<p>This basically means XMPP is a protocol for exchanging stuff.
What kind of stuff? Messages and presences.
We all know what messages are, but what about presences?
A presence is just a way of sharing a “status”, that’s it.
You can be ‘online’, 'offline’, 'having lunch’, or whatever you want.
Also there’s another important word: Extensible meaning it can grow.
It started as an instant messaging protocol
and it has grown into multiple fields for example IoT (Internet of Things).
And last, but not least:
every piece of information we are going to exchange under this protocol is going to be XML.
I can heard you complaining but…
Come on, it’s not that bad!</p>
<h2 id="why-do-we-need-xmpp-why-not-just-rest">Why do we need XMPP? Why not just REST?</h2>
<p>Well what other options do we have?
On the one hand, a custom solution means building everything from scratch, that takes time.
On the other hand, we have XMPP, a super tested technology broadly used by millions of people every day,
so we can say that’s an advantage over a custom approach.</p>
<p>Everytime I talk about XMPP, someone asks me 'Why not just REST?’.
Well, there is a misconception here.
REST is not a protocol, it’s just a way of architecting a networked application;
it’s just a standarized way of doing something (that I love btw).
So let’s change the question to something that makes more sense:
“Why not just build a custom REST chat application?”.
The first thing that comes to my mind is what I already explained in the previous paragraph,
but there is something else.
How do I know when someone has sent me a message?
For XMPP this is trivial:
we have an open connection all the time so,
as soon as a message arrives to the server,
it will send us the message.
We have a full-duplex.
On the other hand, the only solution with REST is polling.
We will need to ask the server for new messages from time to time to see if there is something new for us.
That sucks.
So, we will have to add a mechanism that allows us to receive the messages as soon as they are created,
like SSE or WebSockets.</p>
<p>There is one more XMPP advantage over a custom REST chat application.
REST uses HTTP, an application level protocol that is built on top of a transport level protocol: TCP.
So everytime you want to use your REST solution,
you will need HTTP,
a protocol that is not always available everywhere (maybe you need to embed this in a cheap piece of hardware?).
Besides, we have XMPP built on top of TCP that’s going to be always available.</p>
<h2 id="whats-the-basic-stuff-i-need-to-know-to-get-started">What’s the basic stuff I need to know to get started?</h2>
<p>Well, you know a lot already but let’s make a list. Lists are always good:</p>
<ul>
<li>XMPP is built on top of TCP. It keeps an open connection all the time.</li>
<li>Client/Server architecture. Messages always go through a server.</li>
<li>Everything we send and receive is going to be XML and it’s called Stanza.</li>
<li>We have three different types of stanzas: iq, message and presence.</li>
<li>Every individual on the XMPP network is univocally identified by a JID (Jabber ID).</li>
<li>All the stanzas are cointained in a Stream. Let’s imagine the Stream as a white canvas where you and the server write the stanzas.</li>
<li>Stream, iq, message and presence are the core of XMPP. You can find everything perfectly detailed in RFC6120
XMPP can be extended to accomplish different stuff. Each extension is called XEP (XMPP Extension Protocol).</li>
</ul>
<h2 id="whats-a-jid">What’s a JID?</h2>
<p>Jabber ID (JID) is how we univocally identify each individual in XMPP.
It is the address to where we are going to send our stanzas.</p>
<p>This is how a JID looks like:</p>
<p><img alt="This is how a JID looks like" src="../content_jid.png" /></p>
<ul>
<li><strong>localpart</strong>: This is your username.</li>
<li><strong>domainpart</strong>: Server name where the <strong>localpart</strong> resides.</li>
<li><strong>resourcepart</strong>: This is optional, and it identifies a particular client for the user. For example: I can be logged in with <code>andres@erlang-solutions.com</code> on my iPhone, on my Android and on my mac at the same time… So all these will be the same <strong>localpart</strong> + <strong>domainpart</strong> but different <strong>resourcepart</strong></li>
</ul>
<p>I’m sure you have already noticed how similar the JID looks to a standard email address.
This is because you can connect multiple servers together and the messages are rooted to the right user in the right server,
just as email works.
Pretty cool, right?</p>
<p>Sometimes you will see we have a JID with just the domain part.
Why?!
Because it’s also possible to send stanzas to a service instead of a user.
A service?
What’s a service?!
Services are different pieces of an XMPP server that offer you some special functionality,
but don’t worry about this right now, just remember: you can have JIDs without a localpart.</p>
<h2 id="whats-a-stanza">What’s a Stanza?</h2>
<p>Stanza is the name of the XML pieces that we are going to be sending and receiving.
The defined stanzas are: <code>&lt;message/&gt;</code>, <code>&lt;presence/&gt;</code> and <code>&lt;iq/&gt;</code>.</p>
<h3 id="message"><code>&lt;message/&gt;</code></h3>
<p>This is a basic <code>&lt;message/&gt;</code> stanza.
Everytime you want to send a message to someone (a JID), you will have to send this stanza:</p>
<pre><code class="language-xml">&lt;message from='andres@erlang-solutions.com/iphone' to='juana@erlang-solutions.com' type='chat'&gt;
    &lt;body&gt;Hey there!&lt;/body&gt;
&lt;/message&gt;
 ```

### `&lt;iq/&gt;`

It stands for Info/Query.
It’s a query-action mechanism, you send an `iq` and you will get a response to that query.
You can pair the `iq-query` with the `iq-response` using the stanza id.

For example, we send an `iq` to the server to do something
(don’t pay attention to what we want to do… you just need to know there is an `iq` stanza and how the mechanism works):

```xml
&lt;iq to='erlang-solutions.com' type='get' id='1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'/&gt;
&lt;/iq&gt;
</code></pre>
<p>And we get back another <code>iq</code> with the same id with the result of the previous query:</p>
<pre><code class="language-xml">&lt;iq from='erlang-solutions.com' to='ramabit@erlang-solutions.com/Andress-MacBook-Air' id='1' type='result'&gt;
    &lt;query xmlns='http://jabber.org/protocol/disco#items'&gt;
        &lt;item jid='muc.erlang-solutions.com'/&gt;
        &lt;item jid='muclight.erlang-solutions.com'/&gt;
        &lt;item jid='pubsub.erlang-solutions.com'/&gt;
    &lt;/query&gt;
&lt;/iq&gt;
</code></pre>
<h3 id="presence"><code>&lt;presence/&gt;</code></h3>
<p>Used to exchange presence information, as you could have imagined.
Usually presences are sent from the client to the server and broadcasted by it.
The most basic, yet valid presence, to indicate to the server that a user is avaiable is:</p>
<pre><code class="language-xml">&lt;presence/&gt;
</code></pre>
<p>After a sucessfull connection,
you are not going to receive any <code>&lt;message/&gt;</code> until you make yourself available sending the previous presence.</p>
<p>If you want to make yourself unavailable, you just have to send:</p>
<pre><code class="language-xml">&lt;presence type=&quot;unavailable&quot;&gt;&lt;/presence&gt;
</code></pre>
<p>If we want to make the presences more useful, we can send something like this:</p>
<pre><code class="language-xml">&lt;presence&gt;
      &lt;status&gt;On vacation&lt;/status&gt;
&lt;/presence&gt;
</code></pre>
<h2 id="whats-a-stream">What’s a Stream?</h2>
<p>Before answering this, let’s refresh our mind.
What’s a Unix socket?
From Wikipedia: A socket is a special file used for inter-process communication.
These allows communication between two processes.
So a socket is a file that can be written by two processes
(in the same computer or in different computers in the same network).
So the client is going to write to this file and server too.</p>
<p>Ok, but how is a socket related to a Stream?
Well, we are going to be connected to a server using a socket,
therefore we are going to have a 'shared file’ between the client and the server.
This shared file is a white canvas where we are going to start writting our XML stanzas.
The first thing we are going to write to this file is an opening <code>&lt;stream&gt;</code> tag! 
And there you go… that’s our stream.</p>
<p>Perfect, I understand what a stream is, but I still don’t understand how to send a message to the server.
Well, the only thing we need to do to send a message is writting a <message/> stanza in our shared file.
But what happens when the server wants to send me a message?
Simple: it will write the message in the 'shared file’.</p>
<h2 id="are-we-ok-so-far">Are we ok so far?</h2>
<p>I’m sure at this point you have questions like:</p>
<ul>
<li>“What?! An active TCP connection open all the time? I’m used to REST! How am I going to do that?!” </li>
<li>Easy, you don’t have to care about that any more! That’s why we are going to use the library, and it will take care of that.</li>
<li>“You said nothing about how to connect to the server!”</li>
<li>Believe me, you don’t have to care about this either. If we start adding all this info, we are going to get crazy. Trust me, I’ve been there.</li>
<li>“What about encrypted messages? We need security! How are we going to handle this?”</li>
<li>Again, you don’t have to care about this at this point. Baby steps!</li>
</ul>
<p>You just need to be able to answer:
“What’s XMPP?”,
“How do you send a message?”,
“How do you change your status in XMPP?”,
“How do you ask something to the server?”,
“What’s a Stream?”.
If you can answer all that, you are WAY better than me when I started.</p>
<h2 id="first-steps-installing-the-xmppframework-library">First steps: installing the XMPPFramework library</h2>
<p>Let’s create a brand new Xcode project and install the library.
In this tutorial we are going to be using <code>Swift 3</code>.
The easiest way to integrate XMPPFramework to the project is using <a href="https://cocoapods.org/">CocoaPods</a>.</p>
<p>Let’s create our <code>Podfile</code> using the <code>pod init</code> command in the folder where our <code>.xcodeproj</code> lives.
There are thousands of forks but the maintained one is the original: <code>robbiehanson/XMPPFramework</code>.</p>
<p>So let’s add the <code>pod</code> to our <code>Podfile</code> and remember to uncomment the <code>use_frameworks!</code>.</p>
<pre><code>use_frameworks!

target 'CrazyMessages' do
    pod 'XMPPFramework', :git=&gt; 'git@github.com:robbiehanson/XMPPFramework.git', :branch =&gt; 'master'
end
</code></pre>
<p>Then <code>pod install</code> and <code>CocoaPods</code> is going to do its magic and create a <code>.xcworkspace</code> with the library integrated.
Now we just need to <code>import XMPPFramework</code> in the files we want to use the library and that’s it.</p>
<h2 id="starting-to-build-our-instant-messaging-app">Starting to build our Instant Messaging app</h2>
<p>The most important thing in an XMPP application is the stream,
that’s where we are going to “write” our stanzas, so we need an object that is going to hold it.
We are going to create an <code>XMPPController</code> class with an <code>XMPPStream</code>:</p>
<pre><code>import Foundation
import XMPPFramework

class XMPPController: NSObject {
    var xmppStream: XMPPStream

    init() {
        self.xmppStream = XMPPStream()  
    }

}
</code></pre>
<p>We are dealing with a highly asynchronous library here.
For every action we are going to have a response some time in the future.
To handle this <code>XMPPFramework</code> defines the <code>XMPPStreamDelegate</code>.
So implementing that delegate is going to help us answer lots of different questions like:
“How do I know when XMPP has successfully connected?”,
“How do I know if I’m correctly authenticated?”,
“How do I know if I received a message?”.
<code>XMPPStreamDelegate</code> is your friend!</p>
<p>So we have our <code>XMPPController</code> and our <code>XMPPStream</code>,
what do we need to do now?
Configure our stream with the <code>hostName</code>, <code>port</code> and <code>ourJID</code>.
To provide all this info to the controller
we are going to make some changes to the <code>init</code> to be able to receive all these parameters:</p>
<pre><code>enum XMPPControllerError: Error {
    case wrongUserJID
}

class XMPPController: NSObject {
    var xmppStream: XMPPStream

    let hostName: String
    let userJID: XMPPJID
    let hostPort: UInt16
    let password: String

    init(hostName: String, userJIDString: String, hostPort: UInt16 = 5222, password: String) throws {
        guard let userJID = XMPPJID(string: userJIDString) else {
            throw XMPPControllerError.wrongUserJID
        }

        self.hostName = hostName
        self.userJID = userJID
        self.hostPort = hostPort
        self.password = password

        // Stream Configuration
        self.xmppStream = XMPPStream()
        self.xmppStream.hostName = hostName
        self.xmppStream.hostPort = hostPort
        self.xmppStream.startTLSPolicy = XMPPStreamStartTLSPolicy.allowed
        self.xmppStream.myJID = userJID

        super.init()

        self.xmppStream.addDelegate(self, delegateQueue: DispatchQueue.main)
    }
}
</code></pre>
<p>Our next step is going to actually connect to a server and authenticate using our <code>userJID</code> and <code>password</code>,
so we are adding a <code>connect</code> method to our <code>XMPPController</code>.</p>
<pre><code>func connect() {
    if !self.xmppStream.isDisconnected() {
        return
    }

   try! self.xmppStream.connect(withTimeout: XMPPStreamTimeoutNone)
}
</code></pre>
<p>But how do we know we have successfully connected to the server?
As I said earlier, we need to check for a suitable delegate method from <code>XMPPStreamDelegate</code>.
After we connect to the server we need to authenticate so we are going to do the following:</p>
<pre><code>extension XMPPController: XMPPStreamDelegate {

    func xmppStreamDidConnect(_ stream: XMPPStream!) {
        print(&quot;Stream: Connected&quot;)
        try! stream.authenticate(withPassword: self.password)
    }

    func xmppStreamDidAuthenticate(_ sender: XMPPStream!) {
        self.xmppStream.send(XMPPPresence())
        print(&quot;Stream: Authenticated&quot;)
    }
}
</code></pre>
<p>We need to test this.
Let’s just create an instance of <code>XMPPController</code> in the <code>AppDelegate</code> to test how it works:</p>
<pre><code>try! self.xmppController = XMPPController(hostName: &quot;host.com&quot;,
                                     userJIDString: &quot;user@host.com&quot;,
                                          password: &quot;password&quot;)
self.xmppController.connect()
</code></pre>
<p>If everything goes fine we should see two messages in the logs but of course that’s not happening,
we missed something.
We never told to our <code>xmppStream</code> who was the delegate object!
We need to add the following line after the <code>super.init()</code></p>
<pre><code>self.xmppStream.addDelegate(self, delegateQueue: DispatchQueue.main)
</code></pre>
<p>If we run the app again:</p>
<pre><code>Stream: Connected
Stream: Authenticated
</code></pre>
<p>Success! We have our own <code>XMPPController</code> with a fully functional and authenticated stream!</p>
<p>Something that may catch your attention is how we are setting our delegate, we are not doing:</p>
<pre><code>self.xmppStream.delegate = self
</code></pre>
<p>Why not?
Because we can “broadcast” the events to multiple delegates,
we can have 10 different objects implementing those methods.
Also we can tell what’s the thread where we want to receive that call,
in the previous example we want it in the main thread.</p>
<h2 id="getting-a-log-in">Getting a Log In</h2>
<p>Our app is super ugly, let’s put on some makeup!
We have nothing but an <code>XMPPController</code> and a hardcoded call in the <code>AppDelegate</code>.
I’m going to create a <code>ViewController</code> that is going to be presented modally as soon as the app starts,
that <code>ViewController</code> will have the neccesary fields/info to log in to the server.</p>
<p>I’m going to create a <code>LogInViewControllerDelegate</code> that is going to tell to our <code>ViewController</code>
that the <code>Log in</code> button was pressed and that’s it.
In that delegate implementation we are going to create our <code>XMPPController</code>, add the <code>ViewControlleras</code> delegate of the <code>XMPPStream</code> and connect!</p>
<pre><code>extension ViewController: LogInViewControllerDelegate {

    func didTouchLogIn(sender: LogInViewController, userJID: String, userPassword: String, server: String) {
        self.logInViewController = sender

        do {
            try self.xmppController = XMPPController(hostName: server,
                                                     userJIDString: userJID,
                                                     password: userPassword)
            self.xmppController.xmppStream.addDelegate(self, delegateQueue: DispatchQueue.main)
            self.xmppController.connect()
        } catch {
            sender.showErrorMessage(message: &quot;Something went wrong&quot;)
        }
    }
}
</code></pre>
<p>Why are we adding <code>ViewController</code> as a delegate of <code>XMPPStream</code> if our <code>XMPPController</code> alreay has that delegate implemented?
Because we need to know if this connection and authentication was successfull or notin our <code>ViewController</code>
so we are able to dismiss the <code>LogInViewController</code> or show an error message if something failed.
This is why being able to add multiple delegates is so useful.</p>
<p>So as I said I’m going to make <code>ViewController</code> to comform to the <code>XMPPStreamDelegate</code>:</p>
<pre><code>extension ViewController: XMPPStreamDelegate {

    func xmppStreamDidAuthenticate(_ sender: XMPPStream!) {
        self.logInViewController?.dismiss(animated: true, completion: nil)
    }

    func xmppStream(_ sender: XMPPStream!, didNotAuthenticate error: DDXMLElement!) {
        self.logInViewController?.showErrorMessage(message: &quot;Wrong password or username&quot;)
    }

}
</code></pre>
<p>And that’s it! Our app can log in to our server as I’m showing here:</p>
<p><img alt="App connecting and authenticating" src="../content_login.gif" /></p>
<h2 id="logging">Logging!</h2>
<p>We’ve been talking a lot about XMPP, stanzas and streams… but is there a way I can see the stream?
Yes SR! XMPPFramework got us covered!</p>
<p>XMPPFramework ships with <a href="https://github.com/CocoaLumberjack/CocoaLumberjack">CocoaLumberJack</a>,
a pretty well known logging framework.
We just need to configure it, set the logging level we want and that’s it.
Logs are going to start showing up!</p>
<h3 id="configuring-cocoalumberjack">Configuring CocoaLumberjack</h3>
<p>This is a really simple task,
you just need to add to your <code>func application(application: UIApplication, didFinishLaunchingWithOptions ...</code> method the following line (remember to <code>import CocoaLumberjack</code>):</p>
<pre><code>DDLog.add(DDTTYLogger.sharedInstance(), with: DDLogLevel.all)
</code></pre>
<p>I’m not going to paste here all the connection process log
because it makes no sense to try to understand what’s going on at this stage of our learning.
But I think showing what some stanzas look like is a good idea.
To do this I’m going to be sending messages from <a href="https://adium.im/">Adium</a>.</p>
<p>I’m going to send this <code>&lt;message/&gt;</code>:</p>
<pre><code class="language-xml">&lt;message to=&quot;test.user@erlang-solutions.com&quot;&gt;
    &lt;body&gt;This is a message sent from Adium!&lt;/body&gt;
&lt;/message&gt;
</code></pre>
<p>Let’s see how it looks like when it reaches our app:</p>
<pre><code class="language-xml">&lt;message xmlns=&quot;jabber:client&quot; from=&quot;iamadium@erlang-solutions.com/MacBook-Air&quot; to=&quot;test.user@erlang-solutions.com&quot;&gt;
   &lt;body&gt;This is a message sent from Adium!&lt;/body&gt;
&lt;/message&gt;
</code></pre>
<p>Let’s send a <code>&lt;presence/&gt;</code> from Adium:</p>
<pre><code class="language-xml">&lt;presence&gt;
    &lt;status&gt;On vacation&lt;/status&gt;
&lt;/presence&gt;
</code></pre>
<p>We are receiving:</p>
<pre><code class="language-xml">&lt;presence xmlns=&quot;jabber:client&quot; from=&quot;iamadium@erlang-solutions.com/MacBook-Air&quot; to=&quot;test.user@erlang-solutions.com&quot;&gt;
   &lt;status&gt;On vacation&lt;/status&gt;
&lt;/presence&gt;
</code></pre>
<p>No doubts at all right? We send something and we receive it on the other end! That’s it!</p>
<h2 id="test-time">Test Time!</h2>
<p>I want to be sure that you are understanding and following everything
and not just copy and pasting from a tutorial (as I usually do 🙊).
So if you are able to answer these questions you are on a good track!</p>
<ul>
<li>Why am I sending a presence after successfully authenticating? What happens if I don’t send it?</li>
<li>What happens if I write a wrong server URL in the Log In form? How do I fix this problem if there is a problem…</li>
<li>How do I detect if suddenly the stream is disconnected from the server? (maybe a network outage?)</li>
<li>How do I detect if the user/password was wrong?</li>
</ul>
<p>If you need help leave a message!</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../Jingle-SIP-setup/" class="btn btn-neutral float-right" title="How to Set up Jingle/SIP">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../ICE_tutorial/" class="btn btn-neutral" title="How to Set up MongooseICE"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../ICE_tutorial/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../Jingle-SIP-setup/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
